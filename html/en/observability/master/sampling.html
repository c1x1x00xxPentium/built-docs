<!DOCTYPE html>
<html lang="en-us">
  <head>
    
<meta charset="UTF-8">
<title>Transaction sampling | Elastic Observability [master] | Elastic</title>
<meta class="elastic" name="content" content="Transaction sampling | Elastic Observability [master]">

<link rel="home" href="index.html" title="Elastic Observability [master]"/>
<link rel="up" href="features.html" title="Elastic APM features"/>
<link rel="prev" href="apm-rum.html" title="Real User Monitoring (RUM)"/>
<link rel="next" href="log-correlation.html" title="Logging integration"/>
<meta class="elastic" name="product_version" content="master"/>
<meta class="elastic" name="product_name" content="Observability"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Observability/Guide/master"/>
<meta name="DC.subject" content="Observability"/>
<meta name="DC.identifier" content="master"/>
<meta name="robots" content="noindex,nofollow"/>

    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://cdn.optimizely.com/js/18132920325.js"></script>
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/manifest.json">
    <meta name="apple-mobile-web-app-title" content="Elastic">
    <meta name="application-name" content="Elastic">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/mstile-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="naver-site-verification" content="936882c1853b701b3cef3721758d80535413dbfd" />
    <meta name="yandex-verification" content="d8a47e95d0972434" />
    <meta name="localized" content="true" />
    <meta name="st:robots" content="follow,index" />
    <meta property="og:image" content="https://static-www.elastic.co/v3/assets/bltefdd0b53724fa2ce/blt280217a63b82a734/6202d3378b1f312528798412/elastic-logo.svg" />
    <meta property="og:image:width" content="500" />
    <meta property="og:image:height" content="172" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon-precomposed" sizes="64x64" href="/favicon_64x64_16bit.png">
    <link rel="apple-touch-icon-precomposed" sizes="32x32" href="/favicon_32x32.png">
    <link rel="apple-touch-icon-precomposed" sizes="16x16" href="/favicon_16x16.png">
    <!-- Give IE8 a fighting chance -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" type="text/css" href="/guide/static/styles.css" />
  </head>

  <!--© 2015-2022 Elasticsearch B.V. -->
  <!-- All Elastic documentation is licensed under a Creative Commons Attribution-NonCommercial-NoDerivatives 4.0 International License. -->
  <!-- http://creativecommons.org/licenses/by-nc-nd/4.0/ -->

  <body>
    <!-- Google Tag Manager -->
    <script>dataLayer = [];</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-58RLH5" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-58RLH5');</script>
    <!-- End Google Tag Manager -->

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-12395217-16"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-12395217-16');
    </script>

    <!-- Google Tag Manager for GA4 -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-KNJMG2M');</script>
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KNJMG2M" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager for GA4-->

    <div id='elastic-nav' style="display:none;"></div>
    <script src='https://www.elastic.co/elastic-nav.js'></script>

    <div class="main-container">
      <section id="content" >
        <div class="content-wrapper">

          <section id="guide" lang="en">
            <div class="container-fluid">
              <div class="row pb-3">
                <div class="col-12 order-2 col-md-4 order-md-1 col-lg-3 h-almost-full-md sticky-top-md" id="left_col">
                  <!-- The TOC is appended here -->
                </div>

                <div class="col-12 order-1 col-md-8 order-md-2 col-lg-7 order-lg-2 guide-section" id="middle_col">
                  <!-- start body -->
                  <div class="page_header">
You are looking at preliminary documentation for a future release.
Not what you want? See the
<a href="../current/index.html">current release documentation</a>.
</div>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elastic Observability [master]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="apm.html">Application performance monitoring (APM)</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="features.html">Elastic APM features</a></span>
</div>
<div class="navheader">
<span class="prev">
<a href="apm-rum.html">« Real User Monitoring (RUM)</a>
</span>
<span class="next">
<a href="log-correlation.html">Logging integration »</a>
</span>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="sampling"></a>Transaction sampling<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/apm-server/sampling.asciidoc">edit</a></h3>
</div></div></div>
<p>Distributed tracing can generate a substantial amount of data.
More data can mean higher costs and more noise.
Sampling aims to lower the amount of data ingested and the effort required to analyze that data&#8201;&#8212;&#8201;all while still making it easy to find anomalous patterns in your applications, detect outages, track errors,
and lower mean time to recovery (MTTR).</p>
<p>Elastic APM supports two types of sampling:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a class="xref" href="sampling.html#head-based-sampling" title="Head-based sampling">Head-based sampling</a>
</li>
<li class="listitem">
<a class="xref" href="sampling.html#tail-based-sampling" title="Tail-based sampling">Tail-based sampling</a>
</li>
</ul>
</div>
<h5><a id="head-based-sampling"></a>Head-based sampling<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/apm-server/sampling.asciidoc">edit</a></h5>
<p>In head-based sampling, the sampling decision for each trace is made when the trace is initiated.
Each trace has a defined and equal probability of being sampled.</p>
<p>For example, a sampling value of <code class="literal">.2</code> indicates a transaction sample rate of <code class="literal">20%</code>.
This means that only <code class="literal">20%</code> of traces will send and retain all of their associated information.
The remaining traces will drop contextual information to reduce the transfer and storage size of the trace.</p>
<p>Head-based sampling is quick and easy to set up.
Its downside is that it&#8217;s entirely random&#8201;&#8212;&#8201;interesting
data might be discarded purely due to chance.</p>
<p>See <a class="xref" href="sampling.html#configure-head-based-sampling" title="Configure head-based sampling">Configure head-based sampling</a> to get started.</p>
<p><span class="strong strong"><strong>Distributed tracing with head-based sampling</strong></span></p>
<p>In a distributed trace, the sampling decision is still made when the trace is initiated.
Each subsequent service respects the initial service&#8217;s sampling decision, regardless of its configured sample rate;
the result is a sampling percentage that matches the initiating service.</p>
<p>In this example, <code class="literal">Service A</code> initiates four transactions and has sample rate of <code class="literal">.5</code> (<code class="literal">50%</code>).
The sample rates of <code class="literal">Service B</code> and <code class="literal">Service C</code> are ignored.</p>
<div class="imageblock">
<div class="content">
<img src="./images/dt-sampling-example-1.png" alt="Distributed tracing and head based sampling example one">
</div>
</div>
<p>In this example, <code class="literal">Service A</code> initiates four transactions and has a sample rate of <code class="literal">1</code> (<code class="literal">100%</code>).
Again, the sample rates of <code class="literal">Service B</code> and <code class="literal">Service C</code> are ignored.</p>
<div class="imageblock">
<div class="content">
<img src="./images/dt-sampling-example-2.png" alt="Distributed tracing and head based sampling example two">
</div>
</div>
<p><span class="strong strong"><strong>OpenTelemetry with head-based sampling</strong></span></p>
<p>Head-based sampling is implemented directly in the APM agents and SDKs.
The sample rate must be propagated between services and the managed intake service in order to produce accurate metrics.</p>
<p>OpenTelemetry offers multiple samplers. However, most samplers do not propagate the sample rate.
This results in inaccurate span-based metrics, like APM throughput, latency, and error metrics.</p>
<p>For accurate span-based metrics when using head-based sampling with OpenTelemetry, you must use
a [consistent probability sampler](<a href="https://opentelemetry.io/docs/specs/otel/trace/tracestate-probability-sampling/" class="ulink" target="_top">https://opentelemetry.io/docs/specs/otel/trace/tracestate-probability-sampling/</a>).
These samplers propagate the sample rate between services and the managed intake service, resulting in accurate metrics.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>OpenTelemetry does not offer consistent probability samplers in all languanges.
OpenTelemetry users should consider using tail-based sampling instead.</p>
</div>
</div>
<p>+
Refer to the documentation of your favorite OpenTelemetry agent or SDK for more information on the availability of consistent probability samplers.</p>
<h5><a id="tail-based-sampling"></a>Tail-based sampling<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/apm-server/sampling.asciidoc">edit</a></h5>
<p>In tail-based sampling, the sampling decision for each trace is made after the trace has completed.
This means all traces will be analyzed against a set of rules, or policies, which will determine the rate at which they are sampled.</p>
<p>Unlike head-based sampling, each trace does not have an equal probability of being sampled.
Because slower traces are more interesting than faster ones, tail-based sampling uses weighted random sampling&#8201;&#8212;&#8201;so
traces with a longer root transaction duration are more likely to be sampled than traces with a fast root transaction duration.</p>
<p>A downside of tail-based sampling is that it results in more data being sent from APM agents to the APM Server.
The APM Server will therefore use more CPU, memory, and disk than with head-based sampling.
However, because the tail-based sampling decision happens in APM Server, there is less data to transfer from APM Server to Elasticsearch.
So running APM Server close to your instrumented services can reduce any increase in transfer costs that tail-based sampling brings.</p>
<p>See <a class="xref" href="sampling.html#configure-tail-based-sampling" title="Configure tail-based sampling">Configure tail-based sampling</a> to get started.</p>
<p><span class="strong strong"><strong>Distributed tracing with tail-based sampling</strong></span></p>
<p>With tail-based sampling, all traces are observed and a sampling decision is only made once a trace completes.</p>
<p>In this example, <code class="literal">Service A</code> initiates four transactions.
If our sample rate is <code class="literal">.5</code> (<code class="literal">50%</code>) for traces with a <code class="literal">success</code> outcome,
and <code class="literal">1</code> (<code class="literal">100%</code>) for traces with a <code class="literal">failure</code> outcome,
the sampled traces would look something like this:</p>
<div class="imageblock">
<div class="content">
<img src="./images/dt-sampling-example-3.png" alt="Distributed tracing and tail based sampling example one">
</div>
</div>
<p><span class="strong strong"><strong>OpenTelemetry with tail-based sampling</strong></span></p>
<p>Tail-based sampling is implemented entirely in APM Server,
and will work with traces sent by either Elastic APM agents or OpenTelemetry SDKs.</p>
<h4><a id="_sampled_data_and_visualizations"></a>Sampled data and visualizations<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/apm-server/sampling.asciidoc">edit</a></h4>
<p>A sampled trace retains all data associated with it.
A non-sampled trace drops all <a class="xref" href="data-model-spans.html" title="Spans">span</a> and <a class="xref" href="data-model-transactions.html" title="Transactions">transaction</a> data<sup>1</sup>.
Regardless of the sampling decision, all traces retain <a class="xref" href="data-model-errors.html" title="Errors">error</a> data.</p>
<p>Some visualizations in the APM app, like latency, are powered by aggregated transaction and span <a class="xref" href="data-model-metrics.html" title="Metrics">metrics</a>.
Metrics are based on sampled traces and weighted by the inverse sampling rate.
For example, if you sample at 5%, each trace is counted as 20.
As a result, as the variance of latency increases, or the sampling rate decreases, your level of error will increase.</p>
<p><sup>1</sup> Real User Monitoring (RUM) traces are an exception to this rule.
The Kibana apps that utilize RUM data depend on transaction events,
so non-sampled RUM traces retain transaction data&#8201;&#8212;&#8201;only span data is dropped.</p>
<h4><a id="_sample_rates"></a>Sample rates<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/apm-server/sampling.asciidoc">edit</a></h4>
<p>What&#8217;s the best sampling rate? Unfortunately, there isn&#8217;t one.
Sampling is dependent on your data, the throughput of your application, data retention policies, and other factors.
A sampling rate from <code class="literal">.1%</code> to <code class="literal">100%</code> would all be considered normal.
You&#8217;ll likely decide on a unique sample rate for different scenarios.
Here are some examples:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Services with considerably more traffic than others might be safe to sample at lower rates
</li>
<li class="listitem">
Routes that are more important than others might be sampled at higher rates
</li>
<li class="listitem">
A production service environment might warrant a higher sampling rate than a development environment
</li>
<li class="listitem">
Failed trace outcomes might be more interesting than successful traces&#8201;&#8212;&#8201;thus requiring a higher sample rate
</li>
</ul>
</div>
<p>Regardless of the above, cost conscious customers are likely to be fine with a lower sample rate.</p>
<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="configure-head-based-sampling"></a>Configure head-based sampling<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/apm-server/sampling.asciidoc">edit</a></h4>
</div></div></div>
<p>There are three ways to adjust the head-based sampling rate of your APM agents:</p>
<div class="section">
<div class="titlepage"><div><div>
<h5 class="title"><a id="_dynamic_configuration"></a>Dynamic configuration<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/apm-server/sampling.asciidoc">edit</a></h5>
</div></div></div>
<p>The transaction sample rate can be changed dynamically (no redeployment necessary) on a per-service and per-environment
basis with <a href="/guide/en/kibana/master/agent-configuration.html" class="ulink" target="_top">APM agent Configuration</a> in Kibana.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h5 class="title"><a id="_kibana_api_configuration"></a>Kibana API configuration<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/apm-server/sampling.asciidoc">edit</a></h5>
</div></div></div>
<p>APM agent configuration exposes an API that can be used to programmatically change
your agents' sampling rate.
An example is provided in the <a href="/guide/en/kibana/master/agent-config-api.html" class="ulink" target="_top">Agent configuration API reference</a>.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h5 class="title"><a id="_apm_agent_configuration"></a>APM agent configuration<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/apm-server/sampling.asciidoc">edit</a></h5>
</div></div></div>
<p>Each agent provides a configuration value used to set the transaction sample rate.
See the relevant agent&#8217;s documentation for more details:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Go: <a href="/guide/en/apm/agent/go/2.x/configuration.html#config-transaction-sample-rate" class="ulink" target="_top"><code class="literal">ELASTIC_APM_TRANSACTION_SAMPLE_RATE</code></a>
</li>
<li class="listitem">
Java: <a href="/guide/en/apm/agent/java/1.x/config-core.html#config-transaction-sample-rate" class="ulink" target="_top"><code class="literal">transaction_sample_rate</code></a>
</li>
<li class="listitem">
.NET: <a href="/guide/en/apm/agent/dotnet/1.x/config-core.html#config-transaction-sample-rate" class="ulink" target="_top"><code class="literal">TransactionSampleRate</code></a>
</li>
<li class="listitem">
Node.js: <a href="/guide/en/apm/agent/nodejs/4.x/configuration.html#transaction-sample-rate" class="ulink" target="_top"><code class="literal">transactionSampleRate</code></a>
</li>
<li class="listitem">
PHP: <a href="/guide/en/apm/agent/php/1.x/configuration-reference.html#config-transaction-sample-rate" class="ulink" target="_top"><code class="literal">transaction_sample_rate</code></a>
</li>
<li class="listitem">
Python: <a href="/guide/en/apm/agent/python/6.x/configuration.html#config-transaction-sample-rate" class="ulink" target="_top"><code class="literal">transaction_sample_rate</code></a>
</li>
<li class="listitem">
Ruby: <a href="/guide/en/apm/agent/ruby/4.x/configuration.html#config-transaction-sample-rate" class="ulink" target="_top"><code class="literal">transaction_sample_rate</code></a>
</li>
</ul>
</div>
</div>

</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="configure-tail-based-sampling"></a>Configure tail-based sampling<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/apm-server/sampling.asciidoc">edit</a></h4>
</div></div></div>
<p>Enable tail-based sampling with <a class="xref" href="tail-based-samling-config.html#sampling-tail-enabled-ref" title="Enable tail-based sampling">Enable tail-based sampling</a>.
When enabled, trace events are mapped to sampling policies.
Each sampling policy must specify a sample rate, and can optionally specify other conditions.
All of the policy conditions must be true for a trace event to match it.</p>
<p>Trace events are matched to policies in the order specified.
Each policy list must conclude with a default policy&#8201;&#8212;&#8201;one that only specifies a sample rate.
This default policy is used to catch remaining trace events that don&#8217;t match a stricter policy.
Requiring this default policy ensures that traces are only dropped intentionally.
If you enable tail-based sampling and send a transaction that does not match any of the policies,
APM Server will reject the transaction with the error <code class="literal">no matching policy</code>.</p>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>Please note that from version <code class="literal">8.3.1</code> APM Server implements a default storage limit of 3GB,
but, due to how the limit is calculated and enforced the actual disk space may still grow slightly
over the limit.</p>
</div>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h5 class="title"><a id="_example_configuration"></a>Example configuration<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/apm-server/sampling.asciidoc">edit</a></h5>
</div></div></div>
<p>This example defines three tail-based sampling polices:</p>
<div class="pre_wrapper lang-yml">
<pre class="programlisting prettyprint lang-yml">- sample_rate: 1 <a id="CO23-1"></a><i class="conum" data-value="1"></i>
  service.environment: production
  trace.name: "GET /very_important_route"
- sample_rate: .01 <a id="CO23-2"></a><i class="conum" data-value="2"></i>
  service.environment: production
  trace.name: "GET /not_important_route"
- sample_rate: .1 <a id="CO23-3"></a><i class="conum" data-value="3"></i></pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO23-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Samples 100% of traces in <code class="literal">production</code> with the trace name <code class="literal">"GET /very_important_route"</code></p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO23-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>Samples 1% of traces in <code class="literal">production</code> with the trace name <code class="literal">"GET /not_important_route"</code></p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO23-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p>Default policy to sample all remaining traces at 10%, e.g. traces in a different environment, like <code class="literal">dev</code>,
or traces with any other name</p>
</td>
</tr>
</table>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h5 class="title"><a id="_configuration_reference"></a>Configuration reference<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/apm-server/sampling.asciidoc">edit</a></h5>
</div></div></div>
<p><span class="strong strong"><strong>Top-level tail-based sampling settings:</strong></span></p>
<h6><a id="sampling-tail-enabled-{input-type}"></a>Enable tail-based sampling<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/apm-server/configure/sampling.asciidoc">edit</a></h6>
<p>Set to <code class="literal">true</code> to enable tail based sampling.
Disabled by default. (bool)</p>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
</colgroup>
<tbody>
<tr>
<td align="left" valign="top"><p>APM Server binary</p></td>
<td align="left" valign="top"><p><code class="literal">sampling.tail.enabled</code></p></td>
</tr>
<tr>
<td align="left" valign="top"><p>Fleet-managed</p></td>
<td align="left" valign="top"><p><code class="literal">Enable tail-based sampling</code></p></td>
</tr>
</tbody>
</table>
</div>
<h6><a id="sampling-tail-interval-{input-type}"></a>Interval<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/apm-server/configure/sampling.asciidoc">edit</a></h6>
<p>Synchronization interval for multiple APM Servers.
Should be in the order of tens of seconds or low minutes.
Default: <code class="literal">1m</code> (1 minute). (duration)</p>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
</colgroup>
<tbody>
<tr>
<td align="left" valign="top"><p>APM Server binary</p></td>
<td align="left" valign="top"><p><code class="literal">sampling.tail.interval</code></p></td>
</tr>
<tr>
<td align="left" valign="top"><p>Fleet-managed</p></td>
<td align="left" valign="top"><p><code class="literal">Interval</code></p></td>
</tr>
</tbody>
</table>
</div>
<h6><a id="sampling-tail-policies-{input-type}"></a>Policies<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/apm-server/configure/sampling.asciidoc">edit</a></h6>
<p>Criteria used to match a root transaction to a sample rate.</p>
<p>Policies map trace events to a sample rate.
Each policy must specify a sample rate.
Trace events are matched to policies in the order specified.
All policy conditions must be true for a trace event to match.
Each policy list should conclude with a policy that only specifies a sample rate.
This final policy is used to catch remaining trace events that don&#8217;t match a stricter policy.
(<code class="literal">[]policy</code>)</p>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
</colgroup>
<tbody>
<tr>
<td align="left" valign="top"><p>APM Server binary</p></td>
<td align="left" valign="top"><p><code class="literal">sampling.tail.policies</code></p></td>
</tr>
<tr>
<td align="left" valign="top"><p>Fleet-managed</p></td>
<td align="left" valign="top"><p><code class="literal">Policies</code></p></td>
</tr>
</tbody>
</table>
</div>
<h6><a id="sampling-tail-storage_limit-{input-type}"></a>Storage limit<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/apm-server/configure/sampling.asciidoc">edit</a></h6>
<p>The amount of storage space allocated for trace events matching tail sampling policies. Caution: Setting this limit higher than the allowed space may cause APM Server to become unhealthy.</p>
<p>If the configured storage limit is insufficient, it logs "configured storage limit reached". The event will bypass sampling and will always be indexed when storage limit is reached.</p>
<p>Default: <code class="literal">3GB</code>. (text)</p>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
</colgroup>
<tbody>
<tr>
<td align="left" valign="top"><p>APM Server binary</p></td>
<td align="left" valign="top"><p><code class="literal">sampling.tail.storage_limit</code></p></td>
</tr>
<tr>
<td align="left" valign="top"><p>Fleet-managed</p></td>
<td align="left" valign="top"><p><code class="literal">Storage limit</code></p></td>
</tr>
</tbody>
</table>
</div>
<p><span class="strong strong"><strong>Policy settings:</strong></span></p>
<h6><a id="sampling-tail-sample-rate-{input-type}"></a>Sample rate<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/apm-server/configure/sampling.asciidoc">edit</a></h6>
<p><span class="strong strong"><strong><code class="literal">sample_rate</code></strong></span></p>
<p>The sample rate to apply to trace events matching this policy.
Required in each policy.</p>
<p>The sample rate must be greater than or equal to <code class="literal">0</code> and less than or equal to <code class="literal">1</code>.
For example, a <code class="literal">sample_rate</code> of <code class="literal">0.01</code> means that 1% of trace events matching the policy will be sampled.
A <code class="literal">sample_rate</code> of <code class="literal">1</code> means that 100% of trace events matching the policy will be sampled. (int)</p>
<h6><a id="sampling-tail-trace-name-{input-type}"></a>Trace name<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/apm-server/configure/sampling.asciidoc">edit</a></h6>
<p><span class="strong strong"><strong><code class="literal">trace.name</code></strong></span></p>
<p>The trace name for events to match a policy.
A match occurs when the configured <code class="literal">trace.name</code> matches the <code class="literal">transaction.name</code> of the root transaction of a trace.
A root transaction is any transaction without a <code class="literal">parent.id</code>. (string)</p>
<h6><a id="sampling-tail-trace-outcome-{input-type}"></a>Trace outcome<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/apm-server/configure/sampling.asciidoc">edit</a></h6>
<p><span class="strong strong"><strong><code class="literal">trace.outcome</code></strong></span></p>
<p>The trace outcome for events to match a policy.
A match occurs when the configured <code class="literal">trace.outcome</code> matches a trace&#8217;s <code class="literal">event.outcome</code> field.
Trace outcome can be <code class="literal">success</code>, <code class="literal">failure</code>, or <code class="literal">unknown</code>. (string)</p>
<h6><a id="sampling-tail-service-name-{input-type}"></a>Service name<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/apm-server/configure/sampling.asciidoc">edit</a></h6>
<p><span class="strong strong"><strong><code class="literal">service.name</code></strong></span></p>
<p>The service name for events to match a policy. (string)</p>
<h6><a id="sampling-tail-service-environment-{input-type}"></a>Service Environment<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/apm-server/configure/sampling.asciidoc">edit</a></h6>
<p><span class="strong strong"><strong><code class="literal">service.environment</code></strong></span></p>
<p>The service environment for events to match a policy. (string)</p>
</div>

</div>

</div>
<div class="navfooter">
<span class="prev">
<a href="apm-rum.html">« Real User Monitoring (RUM)</a>
</span>
<span class="next">
<a href="log-correlation.html">Logging integration »</a>
</span>
</div>
</div>

                  <!-- end body -->
                </div>

                <div class="col-12 order-3 col-lg-2 order-lg-3 h-almost-full-lg sticky-top-lg" id="right_col">
                  <div id="sticky_content">
                    <!-- The OTP is appended here -->
                    <div class="row">
                      <div class="col-0 col-md-4 col-lg-0" id="bottom_left_col"></div>
                      <div class="col-12 col-md-8 col-lg-12">
                        <div id="rtpcontainer">
                          <div class="mktg-promo" id="most-popular">
                            <p class="aside-heading">Most Popular</p>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-elasticsearch?page=docs&placement=top-video">
                                <p class="mb-0">Get Started with Elasticsearch</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-kibana?page=docs&placement=top-video">
                                <p class="mb-0">Intro to Kibana</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/introduction-elk-stack?page=docs&placement=top-video">
                                <p class="mb-0">ELK for Logs & Metrics</p>
                              </a>
                            </div>
                          </div>
                        </div>

                        <!-- Feedback widget -->
                        <div id="feedbackWidgetContainer"></div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

        </div>


        <div id='elastic-footer'></div>
        <script src='https://www.elastic.co/elastic-footer.js'></script>
        <!-- Footer Section end-->

      </section>
    </div>

    <!-- Feedback modal -->
    <div id="feedbackModalContainer"></div>

    <script src="/guide/static/jquery.js"></script>
    <script type="text/javascript" src="/guide/static/docs.js"></script>
    <script type="text/javascript">
  window.initial_state = {}</script>
  </body>
</html>
