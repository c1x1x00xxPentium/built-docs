<!DOCTYPE html>
<html lang="en-us">
  <head>
    
<meta charset="UTF-8">
<title>Data security | Elastic Observability [master] | Elastic</title>
<meta class="elastic" name="content" content="Data security | Elastic Observability [master]">

<link rel="home" href="index.html" title="Elastic Observability [master]"/>
<link rel="up" href="features.html" title="Elastic APM features"/>
<link rel="prev" href="features.html" title="Elastic APM features"/>
<link rel="next" href="apm-distributed-tracing.html" title="Distributed tracing"/>
<meta class="elastic" name="product_version" content="master"/>
<meta class="elastic" name="product_name" content="Observability"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Observability/Guide/master"/>
<meta name="DC.subject" content="Observability"/>
<meta name="DC.identifier" content="master"/>
<meta name="robots" content="noindex,nofollow"/>

    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://cdn.optimizely.com/js/18132920325.js"></script>
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/manifest.json">
    <meta name="apple-mobile-web-app-title" content="Elastic">
    <meta name="application-name" content="Elastic">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/mstile-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="naver-site-verification" content="936882c1853b701b3cef3721758d80535413dbfd" />
    <meta name="yandex-verification" content="d8a47e95d0972434" />
    <meta name="localized" content="true" />
    <meta name="st:robots" content="follow,index" />
    <meta property="og:image" content="https://static-www.elastic.co/v3/assets/bltefdd0b53724fa2ce/blt280217a63b82a734/6202d3378b1f312528798412/elastic-logo.svg" />
    <meta property="og:image:width" content="500" />
    <meta property="og:image:height" content="172" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon-precomposed" sizes="64x64" href="/favicon_64x64_16bit.png">
    <link rel="apple-touch-icon-precomposed" sizes="32x32" href="/favicon_32x32.png">
    <link rel="apple-touch-icon-precomposed" sizes="16x16" href="/favicon_16x16.png">
    <!-- Give IE8 a fighting chance -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" type="text/css" href="/guide/static/styles.css" />
  </head>

  <!--© 2015-2022 Elasticsearch B.V. -->
  <!-- All Elastic documentation is licensed under a Creative Commons Attribution-NonCommercial-NoDerivatives 4.0 International License. -->
  <!-- http://creativecommons.org/licenses/by-nc-nd/4.0/ -->

  <body>
    <!-- Google Tag Manager -->
    <script>dataLayer = [];</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-58RLH5" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-58RLH5');</script>
    <!-- End Google Tag Manager -->

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-12395217-16"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-12395217-16');
    </script>

    <!-- Google Tag Manager for GA4 -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-KNJMG2M');</script>
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KNJMG2M" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager for GA4-->

    <div id='elastic-nav' style="display:none;"></div>
    <script src='https://www.elastic.co/elastic-nav.js'></script>

    <div class="main-container">
      <section id="content" >
        <div class="content-wrapper">

          <section id="guide" lang="en">
            <div class="container-fluid">
              <div class="row pb-3">
                <div class="col-12 order-2 col-md-4 order-md-1 col-lg-3 h-almost-full-md sticky-top-md" id="left_col">
                  <!-- The TOC is appended here -->
                </div>

                <div class="col-12 order-1 col-md-8 order-md-2 col-lg-7 order-lg-2 guide-section" id="middle_col">
                  <!-- start body -->
                  <div class="page_header">
You are looking at preliminary documentation for a future release.
Not what you want? See the
<a href="../current/index.html">current release documentation</a>.
</div>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elastic Observability [master]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="apm.html">Application performance monitoring (APM)</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="features.html">Elastic APM features</a></span>
</div>
<div class="navheader">
<span class="prev">
<a href="features.html">« Elastic APM features</a>
</span>
<span class="next">
<a href="apm-distributed-tracing.html">Distributed tracing »</a>
</span>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="apm-data-security"></a>Data security<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/apm-server/apm-data-security.asciidoc">edit</a></h3>
</div></div></div>
<p>When setting up Elastic APM, it&#8217;s essential to review all captured data carefully to ensure
it doesn&#8217;t contain sensitive information like passwords, credit card numbers, or health data.
In addition, you may wish to filter out other identifiable information, like IP addresses, user agent information,
or form field data.</p>
<p>Depending on the type of data, we offer several different ways to filter, manipulate,
or obfuscate sensitive information during or before ingestion:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a class="xref" href="apm-data-security.html#built-in-data-filters" title="Built-in data filters">Built-in data filters</a>
</li>
<li class="listitem">
<a class="xref" href="apm-data-security.html#custom-data-filters" title="Custom filters">Custom filters</a>
</li>
</ul>
</div>
<p>In addition to utilizing filters, you should regularly review the <a class="xref" href="apm-data-security.html#sensitive-fields" title="Sensitive fields">sensitive fields</a> table to ensure
sensitive data is not being ingested. If it is, it&#8217;s possible to remove or redact it.
See <a class="xref" href="apm-data-security.html#data-security-delete" title="Delete sensitive data">Delete sensitive data</a> for more information.</p>
<h5><a id="built-in-data-filters"></a>Built-in data filters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/apm-server/apm-data-security.asciidoc">edit</a></h5>
<p>Built-in data filters allow you to filter or turn off ingestion of the following types of data:</p>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Data type</th>
<th align="left" valign="top">Common sensitive data</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p><a class="xref" href="apm-data-security.html#filters-http-header" title="HTTP headers">HTTP headers</a></p></td>
<td align="left" valign="top"><p>Passwords, credit card numbers, authorization, etc.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><a class="xref" href="apm-data-security.html#filters-http-body" title="HTTP bodies">HTTP bodies</a></p></td>
<td align="left" valign="top"><p>Passwords, credit card numbers, etc.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><a class="xref" href="apm-data-security.html#filters-personal-data" title="Personal data">Personal data</a></p></td>
<td align="left" valign="top"><p>Client IP address and user agent.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><a class="xref" href="apm-data-security.html#filters-real-user-data" title="Real user monitoring data">Real user monitoring data</a></p></td>
<td align="left" valign="top"><p>URLs visited, click events, user browser errors, resources used, etc.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><a class="xref" href="apm-data-security.html#filters-database-statements" title="Database statements">Database statements</a></p></td>
<td align="left" valign="top"><p>Sensitive user or business information</p></td>
</tr>
</tbody>
</table>
</div>
<h5><a id="custom-data-filters"></a>Custom filters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/apm-server/apm-data-security.asciidoc">edit</a></h5>
<p>Custom filters allow you to filter or redact other types of APM data on ingestion:</p>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
</colgroup>
<tbody>
<tr>
<td align="left" valign="top"><p><a class="xref" href="apm-data-security.html#filters-ingest-pipeline" title="Create an ingest pipeline filter">Ingest pipelines</a></p></td>
<td align="left" valign="top"><p>Applied at ingestion time.
All agents and fields are supported. Data leaves the instrumented service.
There are no performance overhead implications on the instrumented service.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><a class="xref" href="apm-data-security.html#filters-in-agent" title="APM agent filters">APM agent filters</a></p></td>
<td align="left" valign="top"><p>Not supported by all agents.
Data is sanitized before leaving the instrumented service.
Potential overhead implications on the instrumented service</p></td>
</tr>
</tbody>
</table>
</div>
<h5><a id="sensitive-fields"></a>Sensitive fields<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/apm-server/apm-data-security.asciidoc">edit</a></h5>
<p>You should review the following fields regularly to ensure sensitive data is not being captured:</p>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Field</th>
<th align="left" valign="top">Description</th>
<th align="left" valign="top">Remedy</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p><code class="literal">client.ip</code></p></td>
<td align="left" valign="top"><p>The client IP address, as forwarded by proxy.</p></td>
<td align="left" valign="top"><p><a class="xref" href="apm-data-security.html#filters-personal-data" title="Personal data">Personal data</a></p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">http.request.body.original</code></p></td>
<td align="left" valign="top"><p>The body of the monitored HTTP request.</p></td>
<td align="left" valign="top"><p><a class="xref" href="apm-data-security.html#filters-http-body" title="HTTP bodies">HTTP bodies</a></p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">http.request.headers</code></p></td>
<td align="left" valign="top"><p>The canonical headers of the monitored HTTP request.</p></td>
<td align="left" valign="top"><p><a class="xref" href="apm-data-security.html#filters-http-header" title="HTTP headers">HTTP headers</a></p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">http.request.socket.remote_address</code></p></td>
<td align="left" valign="top"><p>The address of the last proxy or end-user (if no proxy).</p></td>
<td align="left" valign="top"><p><a class="xref" href="apm-data-security.html#custom-filter" title="Custom filters">Custom filters</a></p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">http.response.headers</code></p></td>
<td align="left" valign="top"><p>The canonical headers of the monitored HTTP response.</p></td>
<td align="left" valign="top"><p><a class="xref" href="apm-data-security.html#filters-http-header" title="HTTP headers">HTTP headers</a></p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">process.args</code></p></td>
<td align="left" valign="top"><p>Process arguments.</p></td>
<td align="left" valign="top"><p><a class="xref" href="apm-data-security.html#filters-database-statements" title="Database statements">Database statements</a></p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">span.db.statement</code></p></td>
<td align="left" valign="top"><p>Database statement.</p></td>
<td align="left" valign="top"><p><a class="xref" href="apm-data-security.html#filters-database-statements" title="Database statements">Database statements</a></p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">stacktrace.vars</code></p></td>
<td align="left" valign="top"><p>A flat mapping of local variables captured in the stack frame</p></td>
<td align="left" valign="top"><p><a class="xref" href="apm-data-security.html#custom-filter" title="Custom filters">Custom filters</a></p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">url.query</code></p></td>
<td align="left" valign="top"><p>The query string of the request, e.g. <code class="literal">?pass=hunter2</code>.</p></td>
<td align="left" valign="top"><p><a class="xref" href="apm-data-security.html#custom-filter" title="Custom filters">Custom filters</a></p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">user.*</code></p></td>
<td align="left" valign="top"><p>Logged-in user information.</p></td>
<td align="left" valign="top"><p><a class="xref" href="apm-data-security.html#custom-filter" title="Custom filters">Custom filters</a></p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">user_agent.*</code></p></td>
<td align="left" valign="top"><p>Device and version making the network request.</p></td>
<td align="left" valign="top"><p><a class="xref" href="apm-data-security.html#filters-personal-data" title="Personal data">Personal data</a></p></td>
</tr>
</tbody>
</table>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="filtering"></a>Built-in data filters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/apm-server/apm-data-security.asciidoc">edit</a></h4>
</div></div></div>
<p>Built-in data filters allow you to filter or turn off ingestion of the following types of data:</p>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Data type</th>
<th align="left" valign="top">Common sensitive data</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p><a class="xref" href="apm-data-security.html#filters-http-header" title="HTTP headers">HTTP headers</a></p></td>
<td align="left" valign="top"><p>Passwords, credit card numbers, authorization, etc.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><a class="xref" href="apm-data-security.html#filters-http-body" title="HTTP bodies">HTTP bodies</a></p></td>
<td align="left" valign="top"><p>Passwords, credit card numbers, etc.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><a class="xref" href="apm-data-security.html#filters-personal-data" title="Personal data">Personal data</a></p></td>
<td align="left" valign="top"><p>Client IP address and user agent.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><a class="xref" href="apm-data-security.html#filters-real-user-data" title="Real user monitoring data">Real user monitoring data</a></p></td>
<td align="left" valign="top"><p>URLs visited, click events, user browser errors, resources used, etc.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><a class="xref" href="apm-data-security.html#filters-database-statements" title="Database statements">Database statements</a></p></td>
<td align="left" valign="top"><p>Sensitive user or business information</p></td>
</tr>
</tbody>
</table>
</div>
<h5><a id="filters-http-header"></a>HTTP headers<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/apm-server/apm-data-security.asciidoc">edit</a></h5>
<p>By default, APM agents capture HTTP request and response headers (including cookies).
Most Elastic APM agents provide the ability to sanitize HTTP header fields,
including cookies and <code class="literal">application/x-www-form-urlencoded</code> data (POST form fields).
Query string and captured request bodies, like <code class="literal">application/json</code> data, are not sanitized.</p>
<p>The default list of sanitized fields attempts to target common field names for data relating to
passwords, credit card numbers, authorization, etc., but can be customized to fit your data.
This sensitive data never leaves the instrumented service.</p>
<p>This setting supports <a href="/guide/en/kibana/master/agent-configuration.html" class="ulink" target="_top">Central configuration</a>,
which means the list of sanitized fields can be updated without needing to redeploy your services:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Go: <a href="/guide/en/apm/agent/go/2.x/configuration.html#config-sanitize-field-names" class="ulink" target="_top"><code class="literal">ELASTIC_APM_SANITIZE_FIELD_NAMES</code></a>
</li>
<li class="listitem">
Java: <a href="/guide/en/apm/agent/java/1.x/config-core.html#config-sanitize-field-names" class="ulink" target="_top"><code class="literal">sanitize_field_names</code></a>
</li>
<li class="listitem">
.NET: <a href="/guide/en/apm/agent/dotnet/1.x/config-core.html#config-sanitize-field-names" class="ulink" target="_top"><code class="literal">sanitizeFieldNames</code></a>
</li>
<li class="listitem">
Node.js: <a href="/guide/en/apm/agent/nodejs/4.x/configuration.html#sanitize-field-names" class="ulink" target="_top"><code class="literal">sanitizeFieldNames</code></a>
</li>
<li class="listitem">
Python: <a href="/guide/en/apm/agent/python/6.x/configuration.html#config-sanitize-field-names" class="ulink" target="_top"><code class="literal">sanitize_field_names</code></a>
</li>
<li class="listitem">
Ruby: <a href="/guide/en/apm/agent/ruby/4.x/configuration.html#config-sanitize-field-names" class="ulink" target="_top"><code class="literal">sanitize_field_names</code></a>
</li>
</ul>
</div>
<p>Alternatively, you can completely disable the capturing of HTTP headers.
This setting also supports <a href="/guide/en/kibana/master/agent-configuration.html" class="ulink" target="_top">Central configuration</a>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Go: <a href="/guide/en/apm/agent/go/2.x/configuration.html#config-capture-headers" class="ulink" target="_top"><code class="literal">ELASTIC_APM_CAPTURE_HEADERS</code></a>
</li>
<li class="listitem">
Java: <a href="/guide/en/apm/agent/java/1.x/config-core.html#config-capture-headers" class="ulink" target="_top"><code class="literal">capture_headers</code></a>
</li>
<li class="listitem">
.NET: <a href="/guide/en/apm/agent/dotnet/1.x/config-http.html#config-capture-headers" class="ulink" target="_top"><code class="literal">CaptureHeaders</code></a>
</li>
<li class="listitem">
Node.js: <a href="/guide/en/apm/agent/nodejs/4.x/configuration.html#capture-headers" class="ulink" target="_top"><code class="literal">captureHeaders</code></a>
</li>
<li class="listitem">
Python: <a href="/guide/en/apm/agent/python/6.x/configuration.html#config-capture-headers" class="ulink" target="_top"><code class="literal">capture_headers</code></a>
</li>
<li class="listitem">
Ruby: <a href="/guide/en/apm/agent/ruby/4.x/configuration.html#config-capture-headers" class="ulink" target="_top"><code class="literal">capture_headers</code></a>
</li>
</ul>
</div>
<h5><a id="filters-http-body"></a>HTTP bodies<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/apm-server/apm-data-security.asciidoc">edit</a></h5>
<p>By default, the body of HTTP requests is not recorded.
Request bodies often contain sensitive data like passwords or credit card numbers,
so use care when enabling this feature.</p>
<p>This setting supports <a href="/guide/en/kibana/master/agent-configuration.html" class="ulink" target="_top">Central configuration</a>,
which means the list of sanitized fields can be updated without needing to redeploy your services:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Go: <a href="/guide/en/apm/agent/go/2.x/configuration.html#config-capture-body" class="ulink" target="_top"><code class="literal">ELASTIC_APM_CAPTURE_BODY</code></a>
</li>
<li class="listitem">
Java: <a href="/guide/en/apm/agent/java/1.x/config-core.html#config-capture-body" class="ulink" target="_top"><code class="literal">capture_body</code></a>
</li>
<li class="listitem">
.NET: <a href="/guide/en/apm/agent/dotnet/1.x/config-http.html#config-capture-body" class="ulink" target="_top"><code class="literal">CaptureBody</code></a>
</li>
<li class="listitem">
Node.js: <a href="/guide/en/apm/agent/nodejs/4.x/configuration.html#capture-body" class="ulink" target="_top"><code class="literal">captureBody</code></a>
</li>
<li class="listitem">
Python: <a href="/guide/en/apm/agent/python/6.x/configuration.html#config-capture-body" class="ulink" target="_top"><code class="literal">capture_body</code></a>
</li>
<li class="listitem">
Ruby: <a href="/guide/en/apm/agent/ruby/4.x/configuration.html#config-capture-body" class="ulink" target="_top"><code class="literal">capture_body</code></a>
</li>
</ul>
</div>
<h5><a id="filters-personal-data"></a>Personal data<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/apm-server/apm-data-security.asciidoc">edit</a></h5>
<p>By default, the APM Server captures some personal data associated with trace events:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">client.ip</code>: The client&#8217;s IP address. Typically derived from the HTTP headers of incoming requests.
<code class="literal">client.ip</code> is also used in conjunction with the <a href="/guide/en/elasticsearch/reference/master/geoip-processor.html" class="ulink" target="_top"><code class="literal">geoip</code> processor</a> to assign
geographical information to trace events. To learn more about how <code class="literal">client.ip</code> is derived,
see <a class="xref" href="secure-agent-communication.html#derive-client-ip" title="Deriving an incoming request&#8217;s client.ip address">Deriving an incoming request&#8217;s <code class="literal">client.ip</code> address</a>.
</li>
<li class="listitem">
<code class="literal">user_agent</code>: User agent data, including the client operating system, device name, vendor, and version.
</li>
</ul>
</div>
<p>The capturing of this data can be turned off by setting
<span class="strong strong"><strong>Capture personal data</strong></span> to <code class="literal">false</code>.</p>
<h5><a id="filters-real-user-data"></a>Real user monitoring data<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/apm-server/apm-data-security.asciidoc">edit</a></h5>
<p>Protecting user data is important.
For that reason, individual RUM instrumentations can be disabled in the RUM agent with the
<a href="/guide/en/apm/agent/rum-js/5.x/configuration.html#disable-instrumentations" class="ulink" target="_top"><code class="literal">disableInstrumentations</code></a> configuration variable.
Disabled instrumentations produce no spans or transactions.</p>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Disable</th>
<th align="left" valign="top">Configuration value</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p>HTTP requests</p></td>
<td align="left" valign="top"><p><code class="literal">fetch</code> and <code class="literal">xmlhttprequest</code></p></td>
</tr>
<tr>
<td align="left" valign="top"><p>Page load metrics including static resources</p></td>
<td align="left" valign="top"><p><code class="literal">page-load</code></p></td>
</tr>
<tr>
<td align="left" valign="top"><p>JavaScript errors on the browser</p></td>
<td align="left" valign="top"><p><code class="literal">error</code></p></td>
</tr>
<tr>
<td align="left" valign="top"><p>User click events including URLs visited, mouse clicks, and navigation events</p></td>
<td align="left" valign="top"><p><code class="literal">eventtarget</code></p></td>
</tr>
<tr>
<td align="left" valign="top"><p>Single page application route changes</p></td>
<td align="left" valign="top"><p><code class="literal">history</code></p></td>
</tr>
</tbody>
</table>
</div>
<h5><a id="filters-database-statements"></a>Database statements<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/apm-server/apm-data-security.asciidoc">edit</a></h5>
<p>For SQL databases, APM agents do not capture the parameters of prepared statements.
Note that Elastic APM currently does not make an effort to strip parameters of regular statements.
Not using prepared statements makes your code vulnerable to SQL injection attacks,
so be sure to use prepared statements.</p>
<p>For non-SQL data stores, such as Elasticsearch or MongoDB,
Elastic APM captures the full statement for queries.
For inserts or updates, the full document is not stored.
To filter or obfuscate data in non-SQL database statements,
or to remove the statement entirely,
you can set up an ingest node pipeline.</p>
<h5><a id="filters-agent-specific"></a>Agent-specific options<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/apm-server/apm-data-security.asciidoc">edit</a></h5>
<p>Certain agents offer additional filtering and obfuscating options:</p>
<p><span class="strong strong"><strong>Agent configuration options</strong></span></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
(Node.js) Remove errors raised by the server-side process:
disable with <a href="/guide/en/apm/agent/nodejs/4.x/configuration.html#capture-exceptions" class="ulink" target="_top">captureExceptions</a>.
</li>
<li class="listitem">
(Java) Remove process arguments from transactions:
disabled by default with <a href="/guide/en/apm/agent/java/1.x/config-reporter.html#config-include-process-args" class="ulink" target="_top"><code class="literal">include_process_args</code></a>.
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="custom-filter"></a>Custom filters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/apm-server/apm-data-security.asciidoc">edit</a></h4>
</div></div></div>
<p>Custom filters allow you to filter or redact other types of APM data on ingestion:</p>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
</colgroup>
<tbody>
<tr>
<td align="left" valign="top"><p><a class="xref" href="apm-data-security.html#filters-ingest-pipeline" title="Create an ingest pipeline filter">Ingest pipelines</a></p></td>
<td align="left" valign="top"><p>Applied at ingestion time.
All agents and fields are supported. Data leaves the instrumented service.
There are no performance overhead implications on the instrumented service.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><a class="xref" href="apm-data-security.html#filters-in-agent" title="APM agent filters">APM agent filters</a></p></td>
<td align="left" valign="top"><p>Not supported by all agents.
Data is sanitized before leaving the instrumented service.
Potential overhead implications on the instrumented service</p></td>
</tr>
</tbody>
</table>
</div>
<h5><a id="filters-ingest-pipeline"></a>Create an ingest pipeline filter<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/apm-server/apm-data-security.asciidoc">edit</a></h5>
<p>Ingest node pipelines specify a series of processors that transform data in a specific way.
Transformation happens prior to indexing&#8212;&#8203;inflicting no performance overhead on the monitored application.
Pipelines are a flexible and easy way to filter or obfuscate Elastic APM data.</p>
<h6><a id="filters-ingest-pipeline-tutorial"></a>Tutorial: redact sensitive information<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/apm-server/apm-data-security.asciidoc">edit</a></h6>
<p>Say you decide to <a class="xref" href="apm-data-security.html#filters-http-body" title="HTTP bodies">capture HTTP request bodies</a>
but quickly notice that sensitive information is being collected in the
<code class="literal">http.request.body.original</code> field:</p>
<div class="pre_wrapper lang-json">
<pre class="programlisting prettyprint lang-json">{
  "email": "test@abc.com",
  "password": "hunter2"
}</pre>
</div>
<p><span class="strong strong"><strong>Create a pipeline</strong></span></p>
<p>To obfuscate the passwords stored in the request body,
you can use a series of <a href="/guide/en/elasticsearch/reference/master/processors.html" class="ulink" target="_top">ingest processors</a>.
To start, create a pipeline with a simple description and an empty array of processors:</p>
<div class="pre_wrapper lang-json">
<pre class="programlisting prettyprint lang-json">{
  "pipeline": {
    "description": "redact http.request.body.original.password",
    "processors": [] <a id="CO8-1"></a><i class="conum" data-value="1"></i>
  }
}</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO8-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>The processors defined below will go in this array</p>
</td>
</tr>
</table>
</div>
<p><span class="strong strong"><strong>Add a JSON processor</strong></span></p>
<p>Add your first processor to the processors array.
Because the agent captures the request body as a string, use the
<a href="/guide/en/elasticsearch/reference/master/json-processor.html" class="ulink" target="_top">JSON processor</a> to convert the original field value into a structured JSON object.
Save this JSON object in a new field:</p>
<div class="pre_wrapper lang-json">
<pre class="programlisting prettyprint lang-json">{
  "json": {
    "field": "http.request.body.original",
    "target_field": "http.request.body.original_json",
    "ignore_failure": true
  }
}</pre>
</div>
<p><span class="strong strong"><strong>Add a set processor</strong></span></p>
<p>If <code class="literal">body.original_json</code> is not <code class="literal">null</code>, i.e., it exists, we&#8217;ll redact the <code class="literal">password</code> with the <a href="/guide/en/elasticsearch/reference/master/set-processor.html" class="ulink" target="_top">set processor</a>,
by setting the value of <code class="literal">body.original_json.password</code> to <code class="literal">"redacted"</code>:</p>
<div class="pre_wrapper lang-json">
<pre class="programlisting prettyprint lang-json">{
  "set": {
    "field": "http.request.body.original_json.password",
    "value": "redacted",
    "if": "ctx?.http?.request?.body?.original_json != null"
  }
}</pre>
</div>
<p><span class="strong strong"><strong>Add a convert processor</strong></span></p>
<p>Use the <a href="/guide/en/elasticsearch/reference/master/convert-processor.html" class="ulink" target="_top">convert processor</a> to convert the JSON value of <code class="literal">body.original_json</code> to a string and set it as the <code class="literal">body.original</code> value:</p>
<div class="pre_wrapper lang-json">
<pre class="programlisting prettyprint lang-json">{
  "convert": {
    "field": "http.request.body.original_json",
    "target_field": "http.request.body.original",
    "type": "string",
    "if": "ctx?.http?.request?.body?.original_json != null",
    "ignore_failure": true
  }
}</pre>
</div>
<p><span class="strong strong"><strong>Add a remove processor</strong></span></p>
<p>Finally, use the <a href="/guide/en/elasticsearch/reference/master/remove-processor.html" class="ulink" target="_top">remove processor</a> to remove the <code class="literal">body.original_json</code> field:</p>
<div class="pre_wrapper lang-json">
<pre class="programlisting prettyprint lang-json">{
  "remove": {
    "field": "http.request.body.original",
    "if": "ctx?.http?.request?.body?.original_json != null",
    "ignore_failure": true
  }
}</pre>
</div>
<p><span class="strong strong"><strong>Register the pipeline</strong></span></p>
<p>Now we&#8217;ll put it all together.
Use the <a href="/guide/en/elasticsearch/reference/master/put-pipeline-api.html" class="ulink" target="_top">create or update pipeline API</a> to register the new pipeline in Elasticsearch.
Name the pipeline <code class="literal">apm_redacted_body_password</code>:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">PUT _ingest/pipeline/apm_redacted_body_password
{
  "description": "redact http.request.body.original.password",
  "processors": [
    {
      "json": {
        "field": "http.request.body.original",
        "target_field": "http.request.body.original_json",
        "ignore_failure": true
      }
    },
    {
      "set": {
        "field": "http.request.body.original_json.password",
        "value": "redacted",
        "if": "ctx?.http?.request?.body?.original_json != null"
      }
    },
    {
      "convert": {
        "field": "http.request.body.original_json",
        "target_field": "http.request.body.original",
        "type": "string",
        "if": "ctx?.http?.request?.body?.original_json != null",
        "ignore_failure": true
      }
    },
    {
      "remove": {
        "field": "http.request.body.original_json",
        "if": "ctx?.http?.request?.body?.original_json != null",
        "ignore_failure": true
      }
    }
  ]
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2.console"></div>
<p><span class="strong strong"><strong>Test the pipeline</strong></span></p>
<p>Prior to enabling this new pipeline, you can test it with the <a href="/guide/en/elasticsearch/reference/master/simulate-pipeline-api.html" class="ulink" target="_top">simulate pipeline API</a>.
This API allows you to run multiple documents through a pipeline to ensure it is working correctly.</p>
<p>The request below simulates running three different documents through the pipeline:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST _ingest/pipeline/apm_redacted_body_password/_simulate
{
  "docs": [
    {
      "_source": { <a id="CO9-1"></a><i class="conum" data-value="1"></i>
        "http": {
          "request": {
            "body": {
              "original": """{"email": "test@abc.com", "password": "hunter2"}"""
            }
          }
        }
      }
    },
    {
      "_source": { <a id="CO9-2"></a><i class="conum" data-value="2"></i>
        "some-other-field": true
      }
    },
    {
      "_source": { <a id="CO9-3"></a><i class="conum" data-value="3"></i>
        "http": {
          "request": {
            "body": {
              "original": """["invalid json" """
            }
          }
        }
      }
    }
  ]
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/3.console"></div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO9-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>This document features the same sensitive data from the original example above</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO9-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>This document only contains an unrelated field</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO9-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p>This document contains invalid JSON</p>
</td>
</tr>
</table>
</div>
<p>The API response should be similar to this:</p>
<div class="pre_wrapper lang-json">
<pre class="programlisting prettyprint lang-json">{
  "docs" : [
    {
      "doc" : {
        "_source" : {
          "http" : {
            "request" : {
              "body" : {
                "original" : {
                  "password" : "redacted",
                  "email" : "test@abc.com"
                }
              }
            }
          }
        }
      }
    },
    {
      "doc" : {
        "_source" : {
          "nobody" : true
        }
      }
    },
    {
      "doc" : {
        "_source" : {
          "http" : {
            "request" : {
              "body" : {
                "original" : """["invalid json" """
              }
            }
          }
        }
      }
    }
  ]
}</pre>
</div>
<p>As expected, only the first simulated document has a redacted password field.
All other documents are unaffected.</p>
<p><span class="strong strong"><strong>Create an <code class="literal">@custom</code> pipeline</strong></span></p>
<p>The final step in this process is to call the newly created <code class="literal">apm_redacted_body_password</code> pipeline
from the <code class="literal">@custom</code> pipeline of the data stream you wish to edit.</p>
<p><code class="literal">@custom</code> pipelines are specific to each data stream and follow a similar naming convention: <code class="literal">&lt;type&gt;-&lt;dataset&gt;@custom</code>.
As a reminder, the default APM data streams are:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Application traces: <code class="literal">traces-apm-&lt;namespace&gt;</code>
</li>
<li class="listitem">
RUM and iOS agent application traces: <code class="literal">traces-apm.rum-&lt;namespace&gt;</code>
</li>
<li class="listitem">
APM internal metrics: <code class="literal">metrics-apm.internal-&lt;namespace&gt;</code>
</li>
<li class="listitem">
APM transaction metrics: <code class="literal">metrics-apm.transaction.&lt;metricset.interval&gt;-&lt;namespace&gt;</code>
</li>
<li class="listitem">
APM service destination metrics: <code class="literal">metrics-apm.service_destination.&lt;metricset.interval&gt;-&lt;namespace&gt;</code>
</li>
<li class="listitem">
APM service transaction metrics: <code class="literal">metrics-apm.service_transaction.&lt;metricset.interval&gt;-&lt;namespace&gt;</code>
</li>
<li class="listitem">
APM service summary metrics: <code class="literal">metrics-apm.service_summary.&lt;metricset.interval&gt;-&lt;namespace&gt;</code>
</li>
<li class="listitem">
Application metrics: <code class="literal">metrics-apm.app.&lt;service.name&gt;-&lt;namespace&gt;</code>
</li>
<li class="listitem">
APM error/exception logging: <code class="literal">logs-apm.error-&lt;namespace&gt;</code>
</li>
<li class="listitem">
APM app logging: <code class="literal">logs-apm.app.&lt;service.name&gt;-&lt;namespace&gt;</code>
</li>
</ul>
</div>
<p>To match a custom ingest pipeline with a data stream, follow the <code class="literal">&lt;type&gt;-&lt;dataset&gt;@custom</code> template,
or replace <code class="literal">-namespace</code> with <code class="literal">@custom</code> in the table above.
For example, to target application traces, you&#8217;d create a pipeline named <code class="literal">traces-apm@custom</code>.</p>
<p>Use the <a href="/guide/en/elasticsearch/reference/master/put-pipeline-api.html" class="ulink" target="_top">create or update pipeline API</a> to register the new pipeline in Elasticsearch.
Name the pipeline <code class="literal">traces-apm@custom</code>:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">PUT _ingest/pipeline/traces-apm@custom
{
  "processors": [
    {
      "pipeline": {
        "name": "apm_redacted_body_password" <a id="CO10-1"></a><i class="conum" data-value="1"></i>
      }
    }
  ]
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/4.console"></div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO10-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>The name of the pipeline we previously created</p>
</td>
</tr>
</table>
</div>
<div class="tip admon">
<div class="icon"></div>
<div class="admon_content">
<p>If you prefer using a GUI, you can instead open Kibana and navigate to
<span class="strong strong"><strong>Stack Management</strong></span> &#8594; <span class="strong strong"><strong>Ingest Pipelines</strong></span> &#8594; <span class="strong strong"><strong>Create pipeline</strong></span>.
Use the same naming convention explained previously to ensure your new pipeline matches the correct APM data stream.</p>
</div>
</div>
<p>That&#8217;s it! Passwords will now be redacted from your APM HTTP body data.</p>
<p>To learn more about ingest pipelines, see <a class="xref" href="custom-index-template.html" title="View the Elasticsearch index template">View the Elasticsearch index template</a>.</p>
<h5><a id="filters-in-agent"></a>APM agent filters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/apm-server/apm-data-security.asciidoc">edit</a></h5>
<p>Some APM agents offer a way to manipulate or drop APM events <em>before</em> they are sent to the APM Server.
Please see the relevant agent&#8217;s documentation for more information and examples:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
.NET: <a href="/guide/en/apm/agent/dotnet/1.x/public-api.html#filter-api" class="ulink" target="_top">Filter API</a>.
</li>
<li class="listitem">
Node.js: <a href="/guide/en/apm/agent/nodejs/4.x/agent-api.html#apm-add-filter" class="ulink" target="_top"><code class="literal">addFilter()</code></a>.
</li>
<li class="listitem">
Python: <a href="/guide/en/apm/agent/python/6.x/sanitizing-data.html" class="ulink" target="_top">custom processors</a>.
</li>
<li class="listitem">
Ruby: <a href="/guide/en/apm/agent/ruby/4.x/api.html#api-agent-add-filter" class="ulink" target="_top"><code class="literal">add_filter()</code></a>.
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="data-security-delete"></a>Delete sensitive data<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/apm-server/apm-data-security.asciidoc">edit</a></h4>
</div></div></div>
<p>If you accidentally ingest sensitive data, follow these steps to remove or redact the offending data:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Stop collecting the sensitive data.
Use the <span class="strong strong"><strong>remedy</strong></span> column of the <a class="xref" href="apm-data-security.html#sensitive-fields" title="Sensitive fields">sensitive fields</a> table to determine how to stop collecting
the offending data.
</li>
<li class="listitem">
<p>Delete or redact the ingested data. With data collection fixed, you can now delete or redact the offending data:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a class="xref" href="apm-data-security.html#redact-field-data" title="Redact specific fields">Redact specific fields</a>
</li>
<li class="listitem">
<a class="xref" href="apm-data-security.html#delete-doc-data" title="Delete Elasticsearch documents">Delete Elasticsearch documents</a>
</li>
</ul>
</div>
</li>
</ol>
</div>
<h6><a id="redact-field-data"></a>Redact specific fields<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/apm-server/apm-data-security.asciidoc">edit</a></h6>
<p>To redact sensitive data in a specific field, use the <a href="/guide/en/elasticsearch/reference/master/docs-update-by-query.html" class="ulink" target="_top">update by query API</a>.</p>
<p>For example, the following query removes the <code class="literal">client.ip</code> address
from APM documents in the <code class="literal">logs-apm.error-default</code> data stream:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST /logs-apm.error-default/_update_by_query
{
  "query": {
    "exists": {
      "field": "client.ip"
    }
  }
  "script": {
    "source": "ctx._source.client.ip = params.redacted",
    "params": {
      "redacted": "[redacted]"
    }
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/5.console"></div>
<p>Or, perhaps you only want to redact IP addresses from European users:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST /logs-apm.error-default/_update_by_query
{
  "query": {
    "term": {
      "client.geo.continent_name": {
        "value": "Europe"
      }
    }
  },
  "script": {
    "source": "ctx._source.client.ip = params.redacted",
    "params": {
      "redacted": "[redacted]"
    }
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/6.console"></div>
<p>See <a href="/guide/en/elasticsearch/reference/master/docs-update-by-query.html" class="ulink" target="_top">update by query API</a> for more information and examples.</p>
<h6><a id="delete-doc-data"></a>Delete Elasticsearch documents<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/apm-server/apm-data-security.asciidoc">edit</a></h6>
<div class="warning admon">
<div class="icon"></div>
<div class="admon_content">
<p>This will permanently delete your data.
You should test your queries with the <a href="/guide/en/elasticsearch/reference/master/search-search.html" class="ulink" target="_top">search API</a> prior to deleting data.</p>
</div>
</div>
<p>To delete an Elasticsearch document,
you can use the <a href="/guide/en/elasticsearch/reference/master/docs-delete-by-query.html" class="ulink" target="_top">delete by query API</a>.</p>
<p>For example, to delete all documents in the <code class="literal">apm-traces-*</code> data stream with a <code class="literal">user.email</code> value, run the following query:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST /apm-traces-*/_delete_by_query
{
  "query": {
    "exists": {
      "field": "user.email"
    }
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/7.console"></div>
<p>See <a href="/guide/en/elasticsearch/reference/master/docs-delete-by-query.html" class="ulink" target="_top">delete by query API</a> for more information and examples.</p>
</div>

</div>
<div class="navfooter">
<span class="prev">
<a href="features.html">« Elastic APM features</a>
</span>
<span class="next">
<a href="apm-distributed-tracing.html">Distributed tracing »</a>
</span>
</div>
</div>

                  <!-- end body -->
                </div>

                <div class="col-12 order-3 col-lg-2 order-lg-3 h-almost-full-lg sticky-top-lg" id="right_col">
                  <div id="sticky_content">
                    <!-- The OTP is appended here -->
                    <div class="row">
                      <div class="col-0 col-md-4 col-lg-0" id="bottom_left_col"></div>
                      <div class="col-12 col-md-8 col-lg-12">
                        <div id="rtpcontainer">
                          <div class="mktg-promo" id="most-popular">
                            <p class="aside-heading">Most Popular</p>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-elasticsearch?page=docs&placement=top-video">
                                <p class="mb-0">Get Started with Elasticsearch</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-kibana?page=docs&placement=top-video">
                                <p class="mb-0">Intro to Kibana</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/introduction-elk-stack?page=docs&placement=top-video">
                                <p class="mb-0">ELK for Logs & Metrics</p>
                              </a>
                            </div>
                          </div>
                        </div>

                        <!-- Feedback widget -->
                        <div id="feedbackWidgetContainer"></div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

        </div>


        <div id='elastic-footer'></div>
        <script src='https://www.elastic.co/elastic-footer.js'></script>
        <!-- Footer Section end-->

      </section>
    </div>

    <!-- Feedback modal -->
    <div id="feedbackModalContainer"></div>

    <script src="/guide/static/jquery.js"></script>
    <script type="text/javascript" src="/guide/static/docs.js"></script>
    <script type="text/javascript">
  window.initial_state = {}</script>
  </body>
</html>
