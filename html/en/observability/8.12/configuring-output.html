<!DOCTYPE html>
<html lang="en-us">
  <head>
    
<meta charset="UTF-8">
<title>Configure the output | Elastic Observability [8.12] | Elastic</title>
<meta class="elastic" name="content" content="Configure the output | Elastic Observability [8.12]">

<link rel="home" href="index.html" title="Elastic Observability [8.12]"/>
<link rel="up" href="configuring-howto-apm-server.html" title="Configure"/>
<link rel="prev" href="configuration-logging.html" title="Configure logging"/>
<link rel="next" href="configuration-path.html" title="Configure project paths"/>
<meta class="elastic" name="product_version" content="8.12"/>
<meta class="elastic" name="product_name" content="Observability"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Observability/Guide/8.12"/>
<meta name="DC.subject" content="Observability"/>
<meta name="DC.identifier" content="8.12"/>
<meta name="robots" content="noindex,nofollow"/>

    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://cdn.optimizely.com/js/18132920325.js"></script>
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/manifest.json">
    <meta name="apple-mobile-web-app-title" content="Elastic">
    <meta name="application-name" content="Elastic">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/mstile-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="naver-site-verification" content="936882c1853b701b3cef3721758d80535413dbfd" />
    <meta name="yandex-verification" content="d8a47e95d0972434" />
    <meta name="localized" content="true" />
    <meta name="st:robots" content="follow,index" />
    <meta property="og:image" content="https://static-www.elastic.co/v3/assets/bltefdd0b53724fa2ce/blt280217a63b82a734/6202d3378b1f312528798412/elastic-logo.svg" />
    <meta property="og:image:width" content="500" />
    <meta property="og:image:height" content="172" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon-precomposed" sizes="64x64" href="/favicon_64x64_16bit.png">
    <link rel="apple-touch-icon-precomposed" sizes="32x32" href="/favicon_32x32.png">
    <link rel="apple-touch-icon-precomposed" sizes="16x16" href="/favicon_16x16.png">
    <!-- Give IE8 a fighting chance -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" type="text/css" href="/guide/static/styles.css" />
  </head>

  <!--© 2015-2022 Elasticsearch B.V. -->
  <!-- All Elastic documentation is licensed under a Creative Commons Attribution-NonCommercial-NoDerivatives 4.0 International License. -->
  <!-- http://creativecommons.org/licenses/by-nc-nd/4.0/ -->

  <body>
    <!-- Google Tag Manager -->
    <script>dataLayer = [];</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-58RLH5" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-58RLH5');</script>
    <!-- End Google Tag Manager -->

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-12395217-16"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-12395217-16');
    </script>

    <!-- Google Tag Manager for GA4 -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-KNJMG2M');</script>
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KNJMG2M" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager for GA4-->

    <div id='elastic-nav' style="display:none;"></div>
    <script src='https://www.elastic.co/elastic-nav.js'></script>

    <div class="main-container">
      <section id="content" >
        <div class="content-wrapper">

          <section id="guide" lang="en">
            <div class="container-fluid">
              <div class="row pb-3">
                <div class="col-12 order-2 col-md-4 order-md-1 col-lg-3 h-almost-full-md sticky-top-md" id="left_col">
                  <!-- The TOC is appended here -->
                </div>

                <div class="col-12 order-1 col-md-8 order-md-2 col-lg-7 order-lg-2 guide-section" id="middle_col">
                  <!-- start body -->
                  <div class="page_header">
You are looking at preliminary documentation for a future release.
Not what you want? See the
<a href="../current/index.html">current release documentation</a>.
</div>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elastic Observability [8.12]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="apm.html">Application performance monitoring (APM)</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="configuring-howto-apm-server.html">Configure</a></span>
</div>
<div class="navheader">
<span class="prev">
<a href="configuration-logging.html">« Configure logging</a>
</span>
<span class="next">
<a href="configuration-path.html">Configure project paths »</a>
</span>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="configuring-output"></a>Configure the output<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.12/docs/en/apm-server/configure/output.asciidoc">edit</a></h3>
</div></div></div>

<p>Output configuration options.</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a class="xref" href="configuring-output.html#configure-cloud-id" title="Configure the output for Elasticsearch Service on Elastic Cloud">Elasticsearch Service</a>
</li>
<li class="listitem">
<a class="xref" href="configuring-output.html#elasticsearch-output" title="Configure the Elasticsearch output">Elasticsearch</a>
</li>
<li class="listitem">
<a class="xref" href="configuring-output.html#logstash-output" title="Configure the Logstash output">Logstash</a>
</li>
<li class="listitem">
<a class="xref" href="configuring-output.html#kafka-output" title="Configure the Kafka output">Kafka</a>
</li>
<li class="listitem">
<a class="xref" href="configuring-output.html#redis-output" title="Configure the Redis output">Redis</a>
</li>
<li class="listitem">
<a class="xref" href="configuring-output.html#console-output" title="Configure the Console output">Console</a>
</li>
</ul>
</div>
<h5><a id="sourcemap-output"></a>Source maps<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.12/docs/en/apm-server/configure/output.asciidoc">edit</a></h5>
<p>Source maps can be uploaded through all outputs but must eventually be stored in Elasticsearch.
When using outputs other than Elasticsearch, <code class="literal">source_mapping.elasticsearch</code> must be set for source maps to be applied.
Be sure to update <code class="literal">source_mapping.index_pattern</code> if source maps are stored in the non-default location.
See <a class="xref" href="configuration-rum.html#config-sourcemapping-elasticsearch" title="source_mapping.elasticsearch"><code class="literal">source_mapping.elasticsearch</code></a> for more details.</p>
<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="configure-cloud-id"></a>Configure the output for Elasticsearch Service on Elastic Cloud<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.12/docs/en/apm-server/configure/outputs/output-cloud.asciidoc">edit</a></h4>
</div></div></div>

<div class="sidebar">
<div class="titlepage"></div>
<p><span class="image"><img src="./binary-yes-fm-no.svg" alt="supported deployment methods"></span></p>
<p>This documentation only applies to APM Server binary users.</p>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>This page refers to using a separate instance of APM Server with an existing
<a href="/cloud/elasticsearch-service?page=docs&amp;placement=docs-body" class="ulink" target="_top">Elasticsearch Service deployment</a>.
If you want to use APM on Elasticsearch Service, see:
<a href="/guide/en/cloud/current/ec-create-deployment.html" class="ulink" target="_top">Create your deployment</a> and
<a href="/guide/en/cloud/current/ec-manage-apm-settings.html" class="ulink" target="_top">Add APM user settings</a>.</p>
</div>
</div>
<p>APM Server comes with two settings that simplify the output configuration
when used together with <a href="/cloud/elasticsearch-service?page=docs&amp;placement=docs-body" class="ulink" target="_top">Elasticsearch Service</a>. When defined,
these setting overwrite settings from other parts in the configuration.</p>
<p>Example:</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">cloud.id: "staging:dXMtZWFzdC0xLmF3cy5mb3VuZC5pbyRjZWM2ZjI2MWE3NGJmMjRjZTMzYmI4ODExYjg0Mjk0ZiRjNmMyY2E2ZDA0MjI0OWFmMGNjN2Q3YTllOTYyNTc0Mw=="
cloud.auth: "elastic:YOUR_PASSWORD"</pre>
</div>
<p>These settings can be also specified at the command line, like this:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">apm-server -e -E cloud.id="&lt;cloud-id&gt;" -E cloud.auth="&lt;cloud.auth&gt;"</pre>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h5 class="title"><a id="_cloud_id"></a><code class="literal">cloud.id</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.12/docs/en/apm-server/configure/outputs/output-cloud.asciidoc">edit</a></h5>
</div></div></div>
<p>The Cloud ID, which can be found in the Elasticsearch Service web console, is used by
APM Server to resolve the Elasticsearch and Kibana URLs. This setting
overwrites the <code class="literal">output.elasticsearch.hosts</code> and <code class="literal">setup.kibana.host</code> settings.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h5 class="title"><a id="_cloud_auth"></a><code class="literal">cloud.auth</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.12/docs/en/apm-server/configure/outputs/output-cloud.asciidoc">edit</a></h5>
</div></div></div>
<p>When specified, the <code class="literal">cloud.auth</code> overwrites the <code class="literal">output.elasticsearch.username</code> and
<code class="literal">output.elasticsearch.password</code> settings. Because the Kibana settings inherit
the username and password from the Elasticsearch output, this can also be used
to set the <code class="literal">setup.kibana.username</code> and <code class="literal">setup.kibana.password</code> options.</p>
</div>

</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="elasticsearch-output"></a>Configure the Elasticsearch output<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.12/docs/en/apm-server/configure/outputs/elasticsearch.asciidoc">edit</a></h4>
</div></div></div>

<div class="sidebar">
<div class="titlepage"></div>
<p><span class="image"><img src="./binary-yes-fm-no.svg" alt="supported deployment methods"></span></p>
<p>This documentation only applies to APM Server binary users.
Fleet-managed users should see <a href="/guide/en/fleet/8.12/elasticsearch-output.html" class="ulink" target="_top">Configure the Elasticsearch output</a>.</p>
</div>
<p>The Elasticsearch output sends events directly to Elasticsearch using the Elasticsearch HTTP API.</p>
<p>Example configuration:</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">output.elasticsearch:
  hosts: ["https://myEShost:9200"] <a id="CO33-1"></a><i class="conum" data-value="1"></i></pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO33-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>To enable SSL, add <code class="literal">https</code> to all URLs defined under <em>hosts</em>.</p>
</td>
</tr>
</table>
</div>
<p>When sending data to a secured cluster through the <code class="literal">elasticsearch</code>
output, APM Server can use any of the following authentication methods:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Basic authentication credentials (username and password).
</li>
<li class="listitem">
Token-based (API key) authentication.
</li>
<li class="listitem">
Public Key Infrastructure (PKI) certificates.
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Basic authentication:</strong></span></p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">output.elasticsearch:
  hosts: ["https://myEShost:9200"]
  username: "apm_writer"
  password: "YOUR_PASSWORD"</pre>
</div>
<p><span class="strong strong"><strong>API key authentication:</strong></span></p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">output.elasticsearch:
  hosts: ["https://myEShost:9200"]
  api_key: "ZCV7VnwBgnX0T19fN8Qe:KnR6yE41RrSowb0kQ0HWoA"</pre>
</div>
<p><span class="strong strong"><strong>PKI certificate authentication:</strong></span></p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">output.elasticsearch:
  hosts: ["https://myEShost:9200"]
  ssl.certificate: "/etc/pki/client/cert.pem"
  ssl.key: "/etc/pki/client/cert.key"</pre>
</div>
<p>See <a class="xref" href="configuring-output.html#securing-communication-elasticsearch" title="Secure communication with Elasticsearch">Secure communication with Elasticsearch</a> for details on each authentication method.</p>
<div class="section">
<div class="titlepage"><div><div>
<h5 class="title"><a id="_compatibility"></a>Compatibility<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.12/docs/en/apm-server/configure/outputs/elasticsearch.asciidoc">edit</a></h5>
</div></div></div>
<p>This output works with all compatible versions of Elasticsearch. See the
<a href="/support/matrix#matrix_compatibility" class="ulink" target="_top">Elastic Support
Matrix</a>.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h5 class="title"><a id="_configuration_options_3"></a>Configuration options<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.12/docs/en/apm-server/configure/outputs/elasticsearch.asciidoc">edit</a></h5>
</div></div></div>
<p>You can specify the following options in the <code class="literal">elasticsearch</code> section of the <code class="literal">apm-server.yml</code> config file:</p>
<div class="section">
<div class="titlepage"><div><div>
<h6 class="title"><a id="_enabled_2"></a><code class="literal">enabled</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.12/docs/en/apm-server/configure/outputs/elasticsearch.asciidoc">edit</a></h6>
</div></div></div>
<p>The enabled config is a boolean setting to enable or disable the output. If set
to <code class="literal">false</code>, the output is disabled.</p>
<p>The default value is <code class="literal">true</code>.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h6 class="title"><a id="hosts-option"></a><code class="literal">hosts</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.12/docs/en/apm-server/configure/outputs/elasticsearch.asciidoc">edit</a></h6>
</div></div></div>
<p>The list of Elasticsearch nodes to connect to. The events are distributed to
these nodes in round robin order. If one node becomes unreachable, the event is
automatically sent to another node. Each Elasticsearch node can be defined as a <code class="literal">URL</code> or <code class="literal">IP:PORT</code>.
For example: <code class="literal">http://192.15.3.2</code>, <code class="literal">https://es.found.io:9230</code> or <code class="literal">192.24.3.2:9300</code>.
If no port is specified, <code class="literal">9200</code> is used.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>When a node is defined as an <code class="literal">IP:PORT</code>, the <em>scheme</em> and <em>path</em> are taken from the
<a class="xref" href="configuring-output.html#protocol-option" title="protocol"><code class="literal">protocol</code></a> and <a class="xref" href="configuring-output.html#path-option" title="path"><code class="literal">path</code></a> config options.</p>
</div>
</div>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">output.elasticsearch:
  hosts: ["10.45.3.2:9220", "10.45.3.1:9230"] <a id="CO34-1"></a><i class="conum" data-value="1"></i>
  protocol: https
  path: /elasticsearch</pre>
</div>
<p>In the previous example, the Elasticsearch nodes are available at <code class="literal">https://10.45.3.2:9220/elasticsearch</code> and
<code class="literal">https://10.45.3.1:9230/elasticsearch</code>.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h6 class="title"><a id="_compression_level"></a><code class="literal">compression_level</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.12/docs/en/apm-server/configure/outputs/elasticsearch.asciidoc">edit</a></h6>
</div></div></div>
<p>The gzip compression level. Setting this value to <code class="literal">0</code> disables compression.
The compression level must be in the range of <code class="literal">1</code> (best speed) to <code class="literal">9</code> (best compression).</p>
<p>Increasing the compression level will reduce the network usage but will increase the CPU usage.</p>
<p>The default value is <code class="literal">0</code>.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h6 class="title"><a id="_escape_html"></a><code class="literal">escape_html</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.12/docs/en/apm-server/configure/outputs/elasticsearch.asciidoc">edit</a></h6>
</div></div></div>
<p>Configure escaping of HTML in strings. Set to <code class="literal">true</code> to enable escaping.</p>
<p>The default value is <code class="literal">false</code>.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h6 class="title"><a id="_api_key_2"></a><code class="literal">api_key</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.12/docs/en/apm-server/configure/outputs/elasticsearch.asciidoc">edit</a></h6>
</div></div></div>
<p>Instead of using a username and password, you can use API keys to secure communication
with Elasticsearch. The value must be the ID of the API key and the API key joined by a colon: <code class="literal">id:api_key</code>.</p>
<p>See <a class="xref" href="secure-comms-stack.html#beats-api-keys" title="Grant access using API keys">Grant access using API keys</a> for more information.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h6 class="title"><a id="_username"></a><code class="literal">username</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.12/docs/en/apm-server/configure/outputs/elasticsearch.asciidoc">edit</a></h6>
</div></div></div>
<p>The basic authentication username for connecting to Elasticsearch.</p>
<p>This user needs the privileges required to publish events to Elasticsearch.
To create a user like this, see <a class="xref" href="secure-comms-stack.html#privileges-to-publish-events" title="Grant privileges and roles needed for writing events">Create a <em>writer</em> user</a>.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h6 class="title"><a id="_password"></a><code class="literal">password</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.12/docs/en/apm-server/configure/outputs/elasticsearch.asciidoc">edit</a></h6>
</div></div></div>
<p>The basic authentication password for connecting to Elasticsearch.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h6 class="title"><a id="_parameters"></a><code class="literal">parameters</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.12/docs/en/apm-server/configure/outputs/elasticsearch.asciidoc">edit</a></h6>
</div></div></div>
<p>Dictionary of HTTP parameters to pass within the URL with index operations.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h6 class="title"><a id="protocol-option"></a><code class="literal">protocol</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.12/docs/en/apm-server/configure/outputs/elasticsearch.asciidoc">edit</a></h6>
</div></div></div>
<p>The name of the protocol Elasticsearch is reachable on. The options are:
<code class="literal">http</code> or <code class="literal">https</code>. The default is <code class="literal">http</code>. However, if you specify a URL for
<a class="xref" href="configuring-output.html#hosts-option" title="hosts"><code class="literal">hosts</code></a>, the value of <code class="literal">protocol</code> is overridden by whatever scheme you
specify in the URL.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h6 class="title"><a id="path-option"></a><code class="literal">path</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.12/docs/en/apm-server/configure/outputs/elasticsearch.asciidoc">edit</a></h6>
</div></div></div>
<p>An HTTP path prefix that is prepended to the HTTP API calls. This is useful for
the cases where Elasticsearch listens behind an HTTP reverse proxy that exports
the API under a custom prefix.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h6 class="title"><a id="_headers"></a><code class="literal">headers</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.12/docs/en/apm-server/configure/outputs/elasticsearch.asciidoc">edit</a></h6>
</div></div></div>
<p>Custom HTTP headers to add to each request created by the Elasticsearch output.
Example:</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">output.elasticsearch.headers:
  X-My-Header: Header contents</pre>
</div>
<p>It is possible to specify multiple header values for the same header
name by separating them with a comma.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h6 class="title"><a id="_proxy_url"></a><code class="literal">proxy_url</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.12/docs/en/apm-server/configure/outputs/elasticsearch.asciidoc">edit</a></h6>
</div></div></div>
<p>The URL of the proxy to use when connecting to the Elasticsearch servers. The
value may be either a complete URL or a "host[:port]", in which case the "http"
scheme is assumed. If a value is not specified through the configuration file
then proxy environment variables are used. See the
<a href="https://golang.org/pkg/net/http/#ProxyFromEnvironment" class="ulink" target="_top">Go documentation</a>
for more information about the environment variables.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h6 class="title"><a id="_max_retries"></a><code class="literal">max_retries</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.12/docs/en/apm-server/configure/outputs/elasticsearch.asciidoc">edit</a></h6>
</div></div></div>
<p>The number of times to retry publishing an event after a publishing failure.
After the specified number of retries, the events are typically dropped.</p>
<p>Set <code class="literal">max_retries</code> to a value less than 0 to retry until all events are published.</p>
<p>The default is 3.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h6 class="title"><a id="_flush_bytes"></a><code class="literal">flush_bytes</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.12/docs/en/apm-server/configure/outputs/elasticsearch.asciidoc">edit</a></h6>
</div></div></div>
<p>The bulk request size threshold, in bytes, before flushing to Elasticsearch.
The value must have a suffix, e.g. <code class="literal">"2MB"</code>. The default is <code class="literal">1MB</code>.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h6 class="title"><a id="_flush_interval"></a><code class="literal">flush_interval</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.12/docs/en/apm-server/configure/outputs/elasticsearch.asciidoc">edit</a></h6>
</div></div></div>
<p>The maximum duration to accumulate events for a bulk request before being flushed to Elasticsearch.
The value must have a duration suffix, e.g. <code class="literal">"5s"</code>. The default is <code class="literal">1s</code>.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h6 class="title"><a id="_backoff_init"></a><code class="literal">backoff.init</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.12/docs/en/apm-server/configure/outputs/elasticsearch.asciidoc">edit</a></h6>
</div></div></div>
<p>The number of seconds to wait before trying to reconnect to Elasticsearch after
a network error. After waiting <code class="literal">backoff.init</code> seconds, APM Server tries to
reconnect. If the attempt fails, the backoff timer is increased exponentially up
to <code class="literal">backoff.max</code>. After a successful connection, the backoff timer is reset. The
default is <code class="literal">1s</code>.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h6 class="title"><a id="_backoff_max"></a><code class="literal">backoff.max</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.12/docs/en/apm-server/configure/outputs/elasticsearch.asciidoc">edit</a></h6>
</div></div></div>
<p>The maximum number of seconds to wait before attempting to connect to
Elasticsearch after a network error. The default is <code class="literal">60s</code>.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h6 class="title"><a id="_timeout"></a><code class="literal">timeout</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.12/docs/en/apm-server/configure/outputs/elasticsearch.asciidoc">edit</a></h6>
</div></div></div>
<p>The HTTP request timeout in seconds for the Elasticsearch request. The default is 90.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h6 class="title"><a id="_ssl"></a><code class="literal">ssl</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.12/docs/en/apm-server/configure/outputs/elasticsearch.asciidoc">edit</a></h6>
</div></div></div>
<p>Configuration options for SSL parameters like the certificate authority to use
for HTTPS-based connections. If the <code class="literal">ssl</code> section is missing, the host CAs are used for HTTPS connections to
Elasticsearch.</p>
<p>See the <a class="xref" href="configuring-output.html#securing-communication-elasticsearch" title="Secure communication with Elasticsearch">secure communication with Elasticsearch</a> guide
or <a class="xref" href="configuration-ssl-landing.html#configuration-ssl" title="SSL/TLS output settings">SSL configuration reference</a> for more information.</p>
<h5><a id="securing-communication-elasticsearch"></a>Secure communication with Elasticsearch<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.12/docs/en/apm-server/https.asciidoc">edit</a></h5>
<p>When sending data to a secured cluster through the <code class="literal">elasticsearch</code>
output, APM Server can use any of the following authentication methods:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Basic authentication credentials (username and password).
</li>
<li class="listitem">
Token-based API authentication.
</li>
<li class="listitem">
A client certificate.
</li>
</ul>
</div>
<p>Authentication is specified in the APM Server configuration file:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>To use <span class="strong strong"><strong>basic authentication</strong></span>, specify the <code class="literal">username</code> and <code class="literal">password</code> settings under <code class="literal">output.elasticsearch</code>.
For example:</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">output.elasticsearch:
  hosts: ["https://myEShost:9200"]
  username: "apm_writer" <a id="CO34-2"></a><i class="conum" data-value="1"></i>
  password: "YOUR_PASSWORD"</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO34-1"><i class="conum" data-value="1"></i></a><a href="#CO34-2"></a></p>
</td>
<td align="left" valign="top">
<p>This user needs the privileges required to publish events to Elasticsearch.
To create a user like this, see <a class="xref" href="secure-comms-stack.html#privileges-to-publish-events" title="Grant privileges and roles needed for writing events">Create a <em>writer</em> user</a>.</p>
</td>
</tr>
</table>
</div>
</li>
<li class="listitem">
<p>To use token-based <span class="strong strong"><strong>API key authentication</strong></span>, specify the <code class="literal">api_key</code> under <code class="literal">output.elasticsearch</code>.
For example:</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">output.elasticsearch:
  hosts: ["https://myEShost:9200"]
  api_key: "KnR6yE41RrSowb0kQ0HWoA" <a id="CO35-1"></a><i class="conum" data-value="1"></i></pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO35-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>This API key must have the privileges required to publish events to Elasticsearch.
To create an API key like this, see <a class="xref" href="secure-comms-stack.html#beats-api-keys" title="Grant access using API keys">Grant access using API keys</a>.</p>
</td>
</tr>
</table>
</div>
</li>
</ul>
</div>
<div id="beats-tls" class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>To use <span class="strong strong"><strong>Public Key Infrastructure (PKI) certificates</strong></span> to authenticate users,
specify the <code class="literal">certificate</code> and <code class="literal">key</code> settings under <code class="literal">output.elasticsearch</code>.
For example:</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">output.elasticsearch:
  hosts: ["https://myEShost:9200"]
  ssl.certificate: "/etc/pki/client/cert.pem" <a id="CO36-1"></a><i class="conum" data-value="1"></i>
  ssl.key: "/etc/pki/client/cert.key" <a id="CO36-2"></a><i class="conum" data-value="2"></i></pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO36-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>The path to the certificate for SSL client authentication</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO36-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>The client certificate key</p>
</td>
</tr>
</table>
</div>
<p>These settings assume that the
distinguished name (DN) in the certificate is mapped to the appropriate roles in
the <code class="literal">role_mapping.yml</code> file on each node in the Elasticsearch cluster. For more
information, see <a href="/guide/en/elasticsearch/reference/8.12/mapping-roles.html#mapping-roles-file" class="ulink" target="_top">Using role
mapping files</a>.</p>
<p>By default, APM Server uses the list of trusted certificate authorities (CA) from the
operating system where APM Server is running. If the certificate authority that signed your node certificates
is not in the host system&#8217;s trusted certificate authorities list, you need
to add the path to the <code class="literal">.pem</code> file that contains your CA&#8217;s certificate to the
APM Server configuration. This will configure APM Server to use a specific list of
CA certificates instead of the default list from the OS.</p>
<p>Here is an example configuration:</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">output.elasticsearch:
  hosts: ["https://myEShost:9200"]
  ssl.certificate_authorities: <a id="CO37-1"></a><i class="conum" data-value="1"></i>
    - /etc/pki/my_root_ca.pem
    - /etc/pki/my_other_ca.pem
  ssl.certificate: "/etc/pki/client.pem" <a id="CO37-2"></a><i class="conum" data-value="2"></i>
  ssl.key: "/etc/pki/key.pem" <a id="CO37-3"></a><i class="conum" data-value="3"></i></pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO37-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Specify the path to the local <code class="literal">.pem</code> file that contains your Certificate
Authority&#8217;s certificate. This is needed if you use your own CA to sign your node certificates.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO37-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>The path to the certificate for SSL client authentication</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO37-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p>The client certificate key</p>
</td>
</tr>
</table>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>For any given connection, the SSL/TLS certificates must have a subject
that matches the value specified for <code class="literal">hosts</code>, or the SSL handshake fails.
For example, if you specify <code class="literal">hosts: ["foobar:9200"]</code>, the certificate MUST
include <code class="literal">foobar</code> in the subject (<code class="literal">CN=foobar</code>) or as a subject alternative name
(SAN). Make sure the hostname resolves to the correct IP address. If no DNS is available, then
you can associate the IP address with your hostname in <code class="literal">/etc/hosts</code>
(on Unix) or <code class="literal">C:\Windows\System32\drivers\etc\hosts</code> (on Windows).</p>
</div>
</div>
</li>
</ul>
</div>

<h6 class="xpack"><a id="securing-communication-learn-more"></a>Learn more about secure communication<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.12/docs/en/apm-server/https.asciidoc">edit</a></h6>
<p>More information on sending data to a secured cluster is available in the configuration reference:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a class="xref" href="configuring-output.html#elasticsearch-output" title="Configure the Elasticsearch output">Elasticsearch</a>
</li>
<li class="listitem">
<a class="xref" href="configuration-ssl-landing.html#configuration-ssl" title="SSL/TLS output settings">SSL/TLS output settings</a>
</li>
</ul>
</div>
</div>

</div>

</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="logstash-output"></a>Configure the Logstash output<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.12/docs/en/apm-server/configure/outputs/logstash.asciidoc">edit</a></h4>
</div></div></div>

<div class="sidebar">
<div class="titlepage"></div>
<p><span class="image"><img src="./binary-yes-fm-no.svg" alt="supported deployment methods"></span></p>
<p>The Logstash output is not yet supported by Fleet-managed APM Server.</p>
</div>
<p>Logstash allows for additional processing and routing of APM events.
The Logstash output sends events directly to Logstash using the lumberjack
protocol, which runs over TCP.</p>
<h5><a id="_send_events_to_logstash"></a>Send events to Logstash<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.12/docs/en/apm-server/configure/outputs/logstash.asciidoc">edit</a></h5>
<p>To send events to Logstash, you must:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<a class="xref" href="configuring-output.html#ls-output-config" title="Logstash output configuration">Enable the Logstash output in APM Server</a>
</li>
<li class="listitem">
<a class="xref" href="configuring-output.html#ls-kib-config" title="Kibana endpoint configuration">Enable the Kibana endpoint in APM Server</a>
</li>
<li class="listitem">
<a class="xref" href="configuring-output.html#ls-config-pipeline" title="Logstash configuration pipeline">Create a Logstash configuration pipeline in Logstash</a>
</li>
</ol>
</div>
<h6><a id="ls-output-config"></a>Logstash output configuration<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.12/docs/en/apm-server/configure/outputs/logstash.asciidoc">edit</a></h6>
<p>To enable the Logstash output in APM Server,
edit the <code class="literal">apm-server.yml</code> file to:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Disable the Elasticsearch output by commenting it out and
</li>
<li class="listitem">
<p>Enable the Logstash output by uncommenting the Logstash section and setting <code class="literal">enabled</code> to <code class="literal">true</code>:</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">output.logstash:
  enabled: true
  hosts: ["localhost:5044"] <a id="CO38-1"></a><i class="conum" data-value="1"></i></pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO38-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>The <code class="literal">hosts</code> option specifies the Logstash server and the port (<code class="literal">5044</code>) where Logstash is configured to listen for incoming
APM Server connections.</p>
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
<h6><a id="ls-kib-config"></a>Kibana endpoint configuration<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.12/docs/en/apm-server/configure/outputs/logstash.asciidoc">edit</a></h6>
<p>APM Server uses the APM integration to set up and manage APM templates, policies, and pipelines.
To confirm the integration is installed, APM Server polls either Elasticsearch or Kibana on startup.
When using a non-Elasticsearch output, APM Server requires access to Kibana via the
<a class="xref" href="setup-kibana-endpoint.html" title="Configure the Kibana endpoint">Kibana endpoint</a>.</p>
<p>Example configuration:</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">apm-server:
  kibana:
    enabled: true
    host: "https://..."
    username: "elastic"
    password: "xxx"</pre>
</div>
<h6><a id="ls-config-pipeline"></a>Logstash configuration pipeline<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.12/docs/en/apm-server/configure/outputs/logstash.asciidoc">edit</a></h6>
<p>Finally, you must create a Logstash configuration pipeline that listens for incoming
APM Server connections and indexes received events into Elasticsearch.</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>Use the <a href="/guide/en/logstash/8.12/plugins-inputs-elastic_agent.html" class="ulink" target="_top">Elastic Agent input plugin</a> to configure
Logstash to receive events from the APM Server. A minimal <code class="literal">input</code> config might look like this:</p>
<div class="pre_wrapper lang-conf">
<pre class="programlisting prettyprint lang-conf">input {
  elastic_agent {
    port =&gt; 5044
  }
}</pre>
</div>
</li>
<li class="listitem">
<p>Use the <a href="/guide/en/logstash/8.12/plugins-outputs-elasticsearch.html" class="ulink" target="_top">Elasticsearch output plugin</a> to send
events to Elasticsearch for indexing. A minimal <code class="literal">output</code> config might look like this:</p>
<div class="pre_wrapper lang-conf">
<pre class="programlisting prettyprint lang-conf">output {
  elasticsearch {
    data_stream =&gt; "true" <a id="CO39-1"></a><i class="conum" data-value="1"></i>
    cloud_id =&gt; "YOUR_CLOUD_ID_HERE" <a id="CO39-2"></a><i class="conum" data-value="2"></i>
    cloud_auth =&gt; "YOUR_CLOUD_AUTH_HERE" <a id="CO39-3"></a><i class="conum" data-value="2"></i>
  }
}</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO39-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Enables indexing into Elasticsearch data streams.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO39-2"><i class="conum" data-value="2"></i></a><a href="#CO39-3"></a></p>
</td>
<td align="left" valign="top">
<p>This example assumes you&#8217;re sending data to Elastic Cloud. If you&#8217;re using a self-hosted version of Elasticsearch, use <code class="literal">hosts</code> instead. See <a href="/guide/en/logstash/8.12/plugins-outputs-elasticsearch.html" class="ulink" target="_top">Elasticsearch output plugin</a> for more information.</p>
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
<p>Here&#8217;s what your basic Logstash configuration file will look like when we put everything together:</p>
<div class="pre_wrapper lang-conf">
<pre class="programlisting prettyprint lang-conf">input {
  elastic_agent {
    port =&gt; 5044
  }
}

output {
  elasticsearch {
    data_stream =&gt; "true"
    cloud_id =&gt; "YOUR_CLOUD_ID_HERE"
    cloud_auth =&gt; "YOUR_CLOUD_AUTH_HERE"
  }
}</pre>
</div>
<h5><a id="_accessing_the_metadata_field"></a>Accessing the @metadata field<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.12/docs/en/apm-server/configure/outputs/logstash.asciidoc">edit</a></h5>
<p>Every event sent to Logstash contains a special field called
<a href="/guide/en/logstash/8.12/event-dependent-configuration.html#metadata" class="ulink" target="_top"><code class="literal">@metadata</code></a> that you can
use in Logstash for conditionals, filtering, indexing and more.
APM Server sends the following <code class="literal">@metadata</code> to Logstash:</p>
<div class="pre_wrapper lang-json">
<pre class="programlisting prettyprint lang-json">{
    ...
    "@metadata": {
      "beat": "apm-server", <a id="CO40-1"></a><i class="conum" data-value="1"></i>
      "version": "8.12.0" <a id="CO40-2"></a><i class="conum" data-value="2"></i>
    }
}</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO40-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>To change the default <code class="literal">apm-server</code> value, set the
<a class="xref" href="configuring-output.html#logstash-index" title="index"><code class="literal">index</code></a> option in the APM Server config file.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO40-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>The current version of APM Server.</p>
</td>
</tr>
</table>
</div>
<p>In addition to <code class="literal">@metadata</code>, APM Server provides other potentially useful fields, like the
<code class="literal">data_stream</code> field, which can be used to conditionally operate on
<a href="/guide/en/apm/guide/8.12/data-model.html" class="ulink" target="_top">event types</a>, namespaces, or datasets.</p>
<p>As an example, you might want to use Logstash to route all <code class="literal">metric</code> events to the same custom metrics data stream,
rather than to service-specific data streams:</p>
<div class="pre_wrapper lang-json">
<pre class="programlisting prettyprint lang-json">output {
  if [@metadata][beat] == "apm-server" { <a id="CO41-1"></a><i class="conum" data-value="1"></i>
    if [data_stream][type] == "metrics" { <a id="CO41-2"></a><i class="conum" data-value="2"></i>
      elasticsearch {
        index =&gt; "%{[data_stream][type]}-custom-%{[data_stream][namespace]}" <a id="CO41-3"></a><i class="conum" data-value="3"></i>
        action =&gt; "create" <a id="CO41-4"></a><i class="conum" data-value="4"></i>
        cloud_id =&gt; "${CLOUD_ID}" <a id="CO41-5"></a><i class="conum" data-value="5"></i>
        cloud_auth =&gt; "${CLOUD_AUTH}" <a id="CO41-6"></a><i class="conum" data-value="5"></i>
      }
    } else {
      elasticsearch {
        data_stream =&gt; "true" <a id="CO41-7"></a><i class="conum" data-value="6"></i>
        cloud_id =&gt; "${CLOUD_ID}"
        cloud_auth =&gt; "${CLOUD_AUTH}"
      }
    }
  }
}</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO41-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Only apply this output if the data is being sent from the APM Server</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO41-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>Determine if the event type is <code class="literal">metric</code></p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO41-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p>If the event type is <code class="literal">metric</code>, output to a custom data stream: <code class="literal">metrics-custom-&lt;YOUR_NAMESPACE&gt;</code></p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO41-4"><i class="conum" data-value="4"></i></a></p>
</td>
<td align="left" valign="top">
<p>You must explicitly set <code class="literal">action</code> to `create when using Logstash to output an index to a data stream</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO41-5"><i class="conum" data-value="5"></i></a><a href="#CO41-6"></a></p>
</td>
<td align="left" valign="top">
<p>In this example, <code class="literal">cloud_id</code> and <code class="literal">cloud_auth</code> are stored as <a href="/guide/en/logstash/8.12/environment-variables.html" class="ulink" target="_top">environment variables</a></p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO41-7"><i class="conum" data-value="6"></i></a></p>
</td>
<td align="left" valign="top">
<p>For all other event types, index data directly into the predefined APM data steams</p>
</td>
</tr>
</table>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h5 class="title"><a id="_compatibility_2"></a>Compatibility<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.12/docs/en/apm-server/configure/outputs/logstash.asciidoc">edit</a></h5>
</div></div></div>
<p>This output works with all compatible versions of Logstash. See the
<a href="/support/matrix#matrix_compatibility" class="ulink" target="_top">Elastic Support
Matrix</a>.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h5 class="title"><a id="_configuration_options_4"></a>Configuration options<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.12/docs/en/apm-server/configure/outputs/logstash.asciidoc">edit</a></h5>
</div></div></div>
<p>You can specify the following options in the <code class="literal">logstash</code> section of the
<code class="literal">apm-server.yml</code> config file:</p>
<div class="section">
<div class="titlepage"><div><div>
<h6 class="title"><a id="_enabled_3"></a><code class="literal">enabled</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.12/docs/en/apm-server/configure/outputs/logstash.asciidoc">edit</a></h6>
</div></div></div>
<p>The enabled config is a boolean setting to enable or disable the output. If set
to false, the output is disabled.</p>
<p>The default value is <code class="literal">false</code>.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h6 class="title"><a id="hosts"></a><code class="literal">hosts</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.12/docs/en/apm-server/configure/outputs/logstash.asciidoc">edit</a></h6>
</div></div></div>
<p>The list of known Logstash servers to connect to. If load balancing is disabled, but
multiple hosts are configured, one host is selected randomly (there is no precedence).
If one host becomes unreachable, another one is selected randomly.</p>
<p>All entries in this list can contain a port number. The default port number 5044 will be used if no number is given.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h6 class="title"><a id="_compression_level_2"></a><code class="literal">compression_level</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.12/docs/en/apm-server/configure/outputs/logstash.asciidoc">edit</a></h6>
</div></div></div>
<p>The gzip compression level. Setting this value to 0 disables compression.
The compression level must be in the range of 1 (best speed) to 9 (best compression).</p>
<p>Increasing the compression level will reduce the network usage but will increase the CPU usage.</p>
<p>The default value is 3.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h6 class="title"><a id="_escape_html_2"></a><code class="literal">escape_html</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.12/docs/en/apm-server/configure/outputs/logstash.asciidoc">edit</a></h6>
</div></div></div>
<p>Configure escaping of HTML in strings. Set to <code class="literal">true</code> to enable escaping.</p>
<p>The default value is <code class="literal">false</code>.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h6 class="title"><a id="_worker"></a><code class="literal">worker</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.12/docs/en/apm-server/configure/outputs/logstash.asciidoc">edit</a></h6>
</div></div></div>
<p>The number of workers per configured host publishing events to Logstash. This
is best used with load balancing mode enabled. Example: If you have 2 hosts and
3 workers, in total 6 workers are started (3 for each host).</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h6 class="title"><a id="loadbalance"></a><code class="literal">loadbalance</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.12/docs/en/apm-server/configure/outputs/logstash.asciidoc">edit</a></h6>
</div></div></div>
<p>If set to true and multiple Logstash hosts are configured, the output plugin
load balances published events onto all Logstash hosts. If set to false,
the output plugin sends all events to only one host (determined at random) and
will switch to another host if the selected one becomes unresponsive. The default value is false.</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">output.logstash:
  hosts: ["localhost:5044", "localhost:5045"]
  loadbalance: true
  index: apm-server</pre>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h6 class="title"><a id="_ttl"></a><code class="literal">ttl</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.12/docs/en/apm-server/configure/outputs/logstash.asciidoc">edit</a></h6>
</div></div></div>
<p>Time to live for a connection to Logstash after which the connection will be re-established.
Useful when Logstash hosts represent load balancers. Since the connections to Logstash hosts
are sticky, operating behind load balancers can lead to uneven load distribution between the instances.
Specifying a TTL on the connection allows to achieve equal connection distribution between the
instances.  Specifying a TTL of 0 will disable this feature.</p>
<p>The default value is 0.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>The "ttl" option is not yet supported on an asynchronous Logstash client (one with the "pipelining" option set).</p>
</div>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h6 class="title"><a id="_pipelining"></a><code class="literal">pipelining</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.12/docs/en/apm-server/configure/outputs/logstash.asciidoc">edit</a></h6>
</div></div></div>
<p>Configures the number of batches to be sent asynchronously to Logstash while waiting
for ACK from Logstash. Output only becomes blocking once number of <code class="literal">pipelining</code>
batches have been written. Pipelining is disabled if a value of 0 is
configured. The default value is 2.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h6 class="title"><a id="_proxy_url_2"></a><code class="literal">proxy_url</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.12/docs/en/apm-server/configure/outputs/logstash.asciidoc">edit</a></h6>
</div></div></div>
<p>The URL of the SOCKS5 proxy to use when connecting to the Logstash servers. The
value must be a URL with a scheme of <code class="literal">socks5://</code>. The protocol used to
communicate to Logstash is not based on HTTP so a web-proxy cannot be used.</p>
<p>If the SOCKS5 proxy server requires client authentication, then a username and
password can be embedded in the URL as shown in the example.</p>
<p>When using a proxy, hostnames are resolved on the proxy server instead of on the
client. You can change this behavior by setting the
<a class="xref" href="configuring-output.html#logstash-proxy-use-local-resolver" title="proxy_use_local_resolver"><code class="literal">proxy_use_local_resolver</code></a> option.</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">output.logstash:
  hosts: ["remote-host:5044"]
  proxy_url: socks5://user:password@socks5-proxy:2233</pre>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h6 class="title"><a id="logstash-proxy-use-local-resolver"></a><code class="literal">proxy_use_local_resolver</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.12/docs/en/apm-server/configure/outputs/logstash.asciidoc">edit</a></h6>
</div></div></div>
<p>The <code class="literal">proxy_use_local_resolver</code> option determines if Logstash hostnames are
resolved locally when using a proxy. The default value is false, which means
that when a proxy is used the name resolution occurs on the proxy server.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h6 class="title"><a id="logstash-index"></a><code class="literal">index</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.12/docs/en/apm-server/configure/outputs/logstash.asciidoc">edit</a></h6>
</div></div></div>
<p>The index root name to write events to. The default is <code class="literal">apm-server</code>. For
example <code class="literal">"apm"</code> generates <code class="literal">"[apm-]8.12.0-YYYY.MM.DD"</code>
indices (for example, <code class="literal">"apm-8.12.0-2017.04.26"</code>).</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>This parameter&#8217;s value will be assigned to the <code class="literal">metadata.beat</code> field. It
can then be accessed in Logstash&#8217;s output section as <code class="literal">%{[@metadata][beat]}</code>.</p>
</div>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h6 class="title"><a id="_ssl_2"></a><code class="literal">ssl</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.12/docs/en/apm-server/configure/outputs/logstash.asciidoc">edit</a></h6>
</div></div></div>
<p>Configuration options for SSL parameters like the root CA for Logstash connections. See
<a class="xref" href="configuration-ssl-landing.html#configuration-ssl" title="SSL/TLS output settings">SSL/TLS output settings</a> for more information. To use SSL, you must also configure the
<a href="/guide/en/logstash/8.12/plugins-inputs-beats.html" class="ulink" target="_top">Beats input plugin for Logstash</a> to use SSL/TLS.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h6 class="title"><a id="_timeout_2"></a><code class="literal">timeout</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.12/docs/en/apm-server/configure/outputs/logstash.asciidoc">edit</a></h6>
</div></div></div>
<p>The number of seconds to wait for responses from the Logstash server before timing out. The default is 30 (seconds).</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h6 class="title"><a id="_max_retries_2"></a><code class="literal">max_retries</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.12/docs/en/apm-server/configure/outputs/logstash.asciidoc">edit</a></h6>
</div></div></div>
<p>The number of times to retry publishing an event after a publishing failure.
After the specified number of retries, the events are typically dropped.</p>
<p>Set <code class="literal">max_retries</code> to a value less than 0 to retry until all events are published.</p>
<p>The default is 3.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h6 class="title"><a id="_bulk_max_size"></a><code class="literal">bulk_max_size</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.12/docs/en/apm-server/configure/outputs/logstash.asciidoc">edit</a></h6>
</div></div></div>
<p>The maximum number of events to bulk in a single Logstash request. The default is 2048.</p>
<p>If the Beat sends single events, the events are collected into batches. If the Beat publishes
a large batch of events (larger than the value specified by <code class="literal">bulk_max_size</code>), the batch is
split.</p>
<p>Specifying a larger batch size can improve performance by lowering the overhead of sending events.
However big batch sizes can also increase processing times, which might result in
API errors, killed connections, timed-out publishing requests, and, ultimately, lower
throughput.</p>
<p>Setting <code class="literal">bulk_max_size</code> to values less than or equal to 0 disables the
splitting of batches. When splitting is disabled, the queue decides on the
number of events to be contained in a batch.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h6 class="title"><a id="_slow_start"></a><code class="literal">slow_start</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.12/docs/en/apm-server/configure/outputs/logstash.asciidoc">edit</a></h6>
</div></div></div>
<p>If enabled, only a subset of events in a batch of events is transferred per transaction.
The number of events to be sent increases up to <code class="literal">bulk_max_size</code> if no error is encountered.
On error, the number of events per transaction is reduced again.</p>
<p>The default is <code class="literal">false</code>.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h6 class="title"><a id="_backoff_init_2"></a><code class="literal">backoff.init</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.12/docs/en/apm-server/configure/outputs/logstash.asciidoc">edit</a></h6>
</div></div></div>
<p>The number of seconds to wait before trying to reconnect to Logstash after
a network error. After waiting <code class="literal">backoff.init</code> seconds, APM Server tries to
reconnect. If the attempt fails, the backoff timer is increased exponentially up
to <code class="literal">backoff.max</code>. After a successful connection, the backoff timer is reset. The
default is <code class="literal">1s</code>.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h6 class="title"><a id="_backoff_max_2"></a><code class="literal">backoff.max</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.12/docs/en/apm-server/configure/outputs/logstash.asciidoc">edit</a></h6>
</div></div></div>
<p>The maximum number of seconds to wait before attempting to connect to
Logstash after a network error. The default is <code class="literal">60s</code>.</p>
<h5><a id="configuring-ssl-logstash"></a>Secure communication with Logstash<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.12/docs/en/apm-server/shared-ssl-logstash-config.asciidoc">edit</a></h5>
<p>You can use SSL mutual authentication to secure connections between APM Server and Logstash. This ensures that
APM Server sends encrypted data to trusted Logstash servers only, and that the Logstash server receives data from
trusted APM Server clients only.</p>
<p>To use SSL mutual authentication:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>Create a certificate authority (CA) and use it to sign the certificates that you plan to use for
APM Server and Logstash. Creating a correct SSL/TLS infrastructure is outside the scope of this
document. There are many online resources available that describe how to create certificates.</p>
<div class="tip admon">
<div class="icon"></div>
<div class="admon_content">
<p>If you are using security features, you can use the
<a href="/guide/en/elasticsearch/reference/8.12/certutil.html" class="ulink" target="_top"><code class="literal">elasticsearch-certutil</code> tool</a> to generate certificates.</p>
</div>
</div>
</li>
<li class="listitem">
<p>Configure APM Server to use SSL. In the <code class="literal">apm-server.yml</code> config file, specify the following settings under
<code class="literal">ssl</code>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">certificate_authorities</code>: Configures APM Server to trust any certificates signed by the specified CA. If
<code class="literal">certificate_authorities</code> is empty or not set, the trusted certificate authorities of the host system are used.
</li>
<li class="listitem">
<p><code class="literal">certificate</code> and <code class="literal">key</code>: Specifies the certificate and key that APM Server uses to authenticate with
Logstash.</p>
<p>For example:</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">output.logstash:
  hosts: ["logs.mycompany.com:5044"]
  ssl.certificate_authorities: ["/etc/ca.crt"]
  ssl.certificate: "/etc/client.crt"
  ssl.key: "/etc/client.key"</pre>
</div>
<p>For more information about these configuration options, see <a class="xref" href="configuration-ssl-landing.html#configuration-ssl" title="SSL/TLS output settings">SSL/TLS output settings</a>.</p>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Configure Logstash to use SSL. In the Logstash config file, specify the following settings for the <a href="/guide/en/logstash/current/plugins-inputs-beats.html" class="ulink" target="_top">Beats input plugin for Logstash</a>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">ssl</code>: When set to true, enables Logstash to use SSL/TLS.
</li>
<li class="listitem">
<code class="literal">ssl_certificate_authorities</code>: Configures Logstash to trust any certificates signed by the specified CA.
</li>
<li class="listitem">
<code class="literal">ssl_certificate</code> and <code class="literal">ssl_key</code>: Specify the certificate and key that Logstash uses to authenticate with the client.
</li>
<li class="listitem">
<p><code class="literal">ssl_verify_mode</code>: Specifies whether the Logstash server verifies the client certificate against the CA. You
need to specify either <code class="literal">peer</code> or <code class="literal">force_peer</code> to make the server ask for the certificate and validate it. If you
specify <code class="literal">force_peer</code>, and APM Server doesn&#8217;t provide a certificate, the Logstash connection will be closed. If you choose not to use <a href="/guide/en/elasticsearch/reference/8.12/certutil.html" class="ulink" target="_top"><code class="literal">certutil</code></a>, the certificates that you obtain must allow for both <code class="literal">clientAuth</code> and <code class="literal">serverAuth</code> if the extended key usage extension is present.</p>
<p>For example:</p>
<div class="pre_wrapper lang-json">
<pre class="programlisting prettyprint lang-json">input {
  beats {
    port =&gt; 5044
    ssl =&gt; true
    ssl_certificate_authorities =&gt; ["/etc/ca.crt"]
    ssl_certificate =&gt; "/etc/server.crt"
    ssl_key =&gt; "/etc/server.key"
    ssl_verify_mode =&gt; "force_peer"
  }
}</pre>
</div>
<p>For more information about these options, see the
<a href="/guide/en/logstash/current/plugins-inputs-beats.html" class="ulink" target="_top">documentation for the Beats input plugin</a>.</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<h6><a id="testing-ssl-logstash"></a>Validate the Logstash server&#8217;s certificate<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.12/docs/en/apm-server/shared-ssl-logstash-config.asciidoc">edit</a></h6>
<p>Before running APM Server, you should validate the Logstash server&#8217;s certificate. You can use <code class="literal">curl</code> to validate the certificate even though the protocol used to communicate with Logstash is not based on HTTP. For example:</p>
<div class="pre_wrapper lang-shell">
<pre class="programlisting prettyprint lang-shell">curl -v --cacert ca.crt https://logs.mycompany.com:5044</pre>
</div>
<p>If the test is successful, you&#8217;ll receive an empty response error:</p>
<div class="pre_wrapper lang-shell">
<pre class="programlisting prettyprint lang-shell">* Rebuilt URL to: https://logs.mycompany.com:5044/
*   Trying 192.168.99.100...
* Connected to logs.mycompany.com (192.168.99.100) port 5044 (#0)
* TLS 1.2 connection using TLS_DHE_RSA_WITH_AES_256_CBC_SHA
* Server certificate: logs.mycompany.com
* Server certificate: mycompany.com
&gt; GET / HTTP/1.1
&gt; Host: logs.mycompany.com:5044
&gt; User-Agent: curl/7.43.0
&gt; Accept: */*
&gt;
* Empty reply from server
* Connection #0 to host logs.mycompany.com left intact
curl: (52) Empty reply from server</pre>
</div>
<p>The following example uses the IP address rather than the hostname to validate the certificate:</p>
<div class="pre_wrapper lang-shell">
<pre class="programlisting prettyprint lang-shell">curl -v --cacert ca.crt https://192.168.99.100:5044</pre>
</div>
<p>Validation for this test fails because the certificate is not valid for the specified IP address. It&#8217;s only valid for the <code class="literal">logs.mycompany.com</code>, the hostname that appears in the Subject field of the certificate.</p>
<div class="pre_wrapper lang-shell">
<pre class="programlisting prettyprint lang-shell">* Rebuilt URL to: https://192.168.99.100:5044/
*   Trying 192.168.99.100...
* Connected to 192.168.99.100 (192.168.99.100) port 5044 (#0)
* WARNING: using IP address, SNI is being disabled by the OS.
* SSL: certificate verification failed (result: 5)
* Closing connection 0
curl: (51) SSL: certificate verification failed (result: 5)</pre>
</div>
<p>See the <a class="xref" href="common-problems.html#ssl-client-fails" title="SSL client fails to connect">troubleshooting docs</a> for info about resolving this issue.</p>
<h6><a id="_test_the_apm_server_to_logstash_connection"></a>Test the APM Server to Logstash connection<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.12/docs/en/apm-server/shared-ssl-logstash-config.asciidoc">edit</a></h6>
<p>If you have APM Server running as a service, first stop the service. Then test your setup by running APM Server in
the foreground so you can quickly see any errors that occur:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">apm-server -c apm-server.yml -e -v</pre>
</div>
<p>Any errors will be printed to the console. See the <a class="xref" href="common-problems.html#ssl-client-fails" title="SSL client fails to connect">troubleshooting docs</a> for info about
resolving common errors.</p>
</div>

</div>

</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="kafka-output"></a>Configure the Kafka output<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.12/docs/en/apm-server/configure/outputs/kafka.asciidoc">edit</a></h4>
</div></div></div>

<div class="sidebar">
<div class="titlepage"></div>
<p><span class="image"><img src="./binary-yes-fm-no.svg" alt="supported deployment methods"></span></p>
<p>The Kafka output is not yet supported by Fleet-managed APM Server.</p>
</div>
<p>The Kafka output sends events to Apache Kafka.</p>
<p>To use this output, edit the APM Server configuration file to disable the Elasticsearch
output by commenting it out, and enable the Kafka output by uncommenting the
Kafka section.</p>
<p>Example configuration:</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">output.kafka:
  # initial brokers for reading cluster metadata
  hosts: ["kafka1:9092", "kafka2:9092", "kafka3:9092"]

  # message topic selection + partitioning
  topic: '%{[fields.log_topic]}'
  partition.round_robin:
    reachable_only: false

  required_acks: 1
  compression: gzip
  max_message_bytes: 1000000</pre>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>Events bigger than <a class="xref" href="configuring-output.html#kafka-max_message_bytes" title="max_message_bytes"><code class="literal">max_message_bytes</code></a> will be dropped. To avoid this problem, make sure APM Server does not generate events bigger than <a class="xref" href="configuring-output.html#kafka-max_message_bytes" title="max_message_bytes"><code class="literal">max_message_bytes</code></a>.</p>
</div>
</div>
<h6><a id="_kibana_configuration"></a>Kibana configuration<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.12/docs/en/apm-server/configure/outputs/kafka.asciidoc">edit</a></h6>
<p>APM Server uses the APM integration to set up and manage APM templates, policies, and pipelines.
To confirm the integration is installed, APM Server polls either Elasticsearch or Kibana on startup.
When using a non-Elasticsearch output, APM Server requires access to Kibana via the
<a class="xref" href="setup-kibana-endpoint.html" title="Configure the Kibana endpoint">Kibana endpoint</a>.</p>
<p>Example configuration:</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">apm-server:
  kibana:
    enabled: true
    host: "https://..."
    username: "elastic"
    password: "xxx"</pre>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h5 class="title"><a id="kafka-compatibility"></a>Compatibility<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.12/docs/en/apm-server/configure/outputs/kafka.asciidoc">edit</a></h5>
</div></div></div>
<p>This output works with all Kafka versions in between 0.11 and 2.2.2. Older versions
might work as well, but are not supported.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h5 class="title"><a id="_configuration_options_5"></a>Configuration options<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.12/docs/en/apm-server/configure/outputs/kafka.asciidoc">edit</a></h5>
</div></div></div>
<p>You can specify the following options in the <code class="literal">kafka</code> section of the <code class="literal">apm-server.yml</code> config file:</p>
<div class="section">
<div class="titlepage"><div><div>
<h6 class="title"><a id="_enabled_4"></a><code class="literal">enabled</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.12/docs/en/apm-server/configure/outputs/kafka.asciidoc">edit</a></h6>
</div></div></div>
<p>The <code class="literal">enabled</code> config is a boolean setting to enable or disable the output. If set
to false, the output is disabled.</p>
<p>The default value is <code class="literal">false</code>.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h6 class="title"><a id="_hosts_2"></a><code class="literal">hosts</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.12/docs/en/apm-server/configure/outputs/kafka.asciidoc">edit</a></h6>
</div></div></div>
<p>The list of Kafka broker addresses from where to fetch the cluster metadata.
The cluster metadata contain the actual Kafka brokers events are published to.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h6 class="title"><a id="_version"></a><code class="literal">version</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.12/docs/en/apm-server/configure/outputs/kafka.asciidoc">edit</a></h6>
</div></div></div>
<p>Kafka version apm-server is assumed to run against. Defaults to 1.0.0.</p>
<p>Event timestamps will be added, if version 0.10.0.0+ is enabled.</p>
<p>Valid values are all Kafka releases in between <code class="literal">0.8.2.0</code> and <code class="literal">2.0.0</code>.</p>
<p>See <a class="xref" href="configuring-output.html#kafka-compatibility" title="Compatibility">Compatibility</a> for information on supported versions.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h6 class="title"><a id="_username_2"></a><code class="literal">username</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.12/docs/en/apm-server/configure/outputs/kafka.asciidoc">edit</a></h6>
</div></div></div>
<p>The username for connecting to Kafka. If username is configured, the password
must be configured as well.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h6 class="title"><a id="_password_2"></a><code class="literal">password</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.12/docs/en/apm-server/configure/outputs/kafka.asciidoc">edit</a></h6>
</div></div></div>
<p>The password for connecting to Kafka.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h6 class="title"><a id="_sasl_mechanism"></a><code class="literal">sasl.mechanism</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.12/docs/en/apm-server/configure/outputs/kafka.asciidoc">edit</a></h6>
</div></div></div>
<div class="warning admon">
<div class="icon"></div>
<div class="admon_content">
<p>This functionality is in beta and is subject to change. The design and code is less mature than official GA features and is being provided as-is with no warranties. Beta features are not subject to the support SLA of official GA features.</p>
</div>
</div>
<p>The SASL mechanism to use when connecting to Kafka. It can be one of:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">PLAIN</code> for SASL/PLAIN.
</li>
<li class="listitem">
<code class="literal">SCRAM-SHA-256</code> for SCRAM-SHA-256.
</li>
<li class="listitem">
<code class="literal">SCRAM-SHA-512</code> for SCRAM-SHA-512.
</li>
</ul>
</div>
<p>If <code class="literal">sasl.mechanism</code> is not set, <code class="literal">PLAIN</code> is used if <code class="literal">username</code> and <code class="literal">password</code>
are provided. Otherwise, SASL authentication is disabled.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h6 class="title"><a id="topic-option-kafka"></a><code class="literal">topic</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.12/docs/en/apm-server/configure/outputs/kafka.asciidoc">edit</a></h6>
</div></div></div>
<p>The Kafka topic used for produced events.</p>
<p>You can set the topic dynamically by using a format string to access any
event field. For example, this configuration uses a custom field,
<code class="literal">fields.log_topic</code>, to set the topic for each event:</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">topic: '%{[fields.log_topic]}'</pre>
</div>
<p>See the <a class="xref" href="configuring-output.html#topics-option-kafka" title="topics"><code class="literal">topics</code></a> setting for other ways to set the
topic dynamically.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h6 class="title"><a id="topics-option-kafka"></a><code class="literal">topics</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.12/docs/en/apm-server/configure/outputs/kafka.asciidoc">edit</a></h6>
</div></div></div>
<p>An array of topic selector rules. Each rule specifies the <code class="literal">topic</code> to use for
events that match the rule. During publishing, APM Server sets the <code class="literal">topic</code>
for each event based on the first matching rule in the array. Rules
can contain conditionals, format string-based fields, and name mappings. If the
<code class="literal">topics</code> setting is missing or no rule matches, the
<a class="xref" href="configuring-output.html#topic-option-kafka" title="topic"><code class="literal">topic</code></a> field is used.</p>
<p>Rule settings:</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<span class="strong strong"><strong><code class="literal">topic</code></strong></span>
</span>
</dt>
<dd>
The topic format string to use.  If this string contains field
references, such as <code class="literal">%{[fields.name]}</code>, the fields must exist, or the rule
fails.
</dd>
<dt>
<span class="term">
<span class="strong strong"><strong><code class="literal">mappings</code></strong></span>
</span>
</dt>
<dd>
A dictionary that takes the value returned by <code class="literal">topic</code> and maps it
to a new name.
</dd>
<dt>
<span class="term">
<span class="strong strong"><strong><code class="literal">default</code></strong></span>
</span>
</dt>
<dd>
The default string value to use if <code class="literal">mappings</code> does not find a
match.
</dd>
<dt>
<span class="term">
<span class="strong strong"><strong><code class="literal">when</code></strong></span>
</span>
</dt>
<dd>
A condition that must succeed in order to execute the current rule.
</dd>
</dl>
</div>
<p>The following example sets the topic based on whether the message field contains
the specified string:</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">output.kafka:
  hosts: ["localhost:9092"]
  topic: "logs-%{[agent.version]}"
  topics:
    - topic: "critical-%{[agent.version]}"
      when.contains:
        message: "CRITICAL"
    - topic: "error-%{[agent.version]}"
      when.contains:
        message: "ERR"</pre>
</div>
<p>This configuration results in topics named <code class="literal">critical-8.12.0</code>,
<code class="literal">error-8.12.0</code>, and <code class="literal">logs-8.12.0</code>.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h6 class="title"><a id="_key"></a><code class="literal">key</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.12/docs/en/apm-server/configure/outputs/kafka.asciidoc">edit</a></h6>
</div></div></div>
<p>Optional formatted string specifying the Kafka event key. If configured, the
event key can be extracted from the event using a format string.</p>
<p>See the Kafka documentation for the implications of a particular choice of key;
by default, the key is chosen by the Kafka cluster.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h6 class="title"><a id="_partition"></a><code class="literal">partition</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.12/docs/en/apm-server/configure/outputs/kafka.asciidoc">edit</a></h6>
</div></div></div>
<p>Kafka output broker event partitioning strategy. Must be one of <code class="literal">random</code>,
<code class="literal">round_robin</code>, or <code class="literal">hash</code>. By default the <code class="literal">hash</code> partitioner is used.</p>
<p><span class="strong strong"><strong><code class="literal">random.group_events</code></strong></span>: Sets the number of events to be published to the same
 partition, before the partitioner selects a new partition by random. The
 default value is 1 meaning after each event a new partition is picked randomly.</p>
<p><span class="strong strong"><strong><code class="literal">round_robin.group_events</code></strong></span>: Sets the number of events to be published to the
 same partition, before the partitioner selects the next partition. The default
 value is 1 meaning after each event the next partition will be selected.</p>
<p><span class="strong strong"><strong><code class="literal">hash.hash</code></strong></span>: List of fields used to compute the partitioning hash value from.
 If no field is configured, the events <code class="literal">key</code> value will be used.</p>
<p><span class="strong strong"><strong><code class="literal">hash.random</code></strong></span>: Randomly distribute events if no hash or key value can be computed.</p>
<p>All partitioners will try to publish events to all partitions by default. If a
partition&#8217;s leader becomes unreachable for the beat, the output might block. All
partitioners support setting <code class="literal">reachable_only</code> to overwrite this
behavior. If <code class="literal">reachable_only</code> is set to <code class="literal">true</code>, events will be published to
available partitions only.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>Publishing to a subset of available partitions potentially increases resource usage because events may become unevenly distributed.</p>
</div>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h6 class="title"><a id="_client_id"></a><code class="literal">client_id</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.12/docs/en/apm-server/configure/outputs/kafka.asciidoc">edit</a></h6>
</div></div></div>
<p>The configurable client ID used for logging, debugging, and auditing purposes. The default is "beats".</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h6 class="title"><a id="_worker_2"></a><code class="literal">worker</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.12/docs/en/apm-server/configure/outputs/kafka.asciidoc">edit</a></h6>
</div></div></div>
<p>The number of concurrent load-balanced Kafka output workers.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h6 class="title"><a id="_codec"></a><code class="literal">codec</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.12/docs/en/apm-server/configure/outputs/kafka.asciidoc">edit</a></h6>
</div></div></div>
<p>Output codec configuration. If the <code class="literal">codec</code> section is missing, events will be JSON encoded.</p>
<p>See <a class="xref" href="configuring-output.html#configuration-output-codec" title="Change the output codec">Change the output codec</a> for more information.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h6 class="title"><a id="_metadata"></a><code class="literal">metadata</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.12/docs/en/apm-server/configure/outputs/kafka.asciidoc">edit</a></h6>
</div></div></div>
<p>Kafka metadata update settings. The metadata do contain information about
brokers, topics, partition, and active leaders to use for publishing.</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<span class="strong strong"><strong><code class="literal">refresh_frequency</code></strong></span>
</span>
</dt>
<dd>
Metadata refresh interval. Defaults to 10 minutes.
</dd>
<dt>
<span class="term">
<span class="strong strong"><strong><code class="literal">full</code></strong></span>
</span>
</dt>
<dd>
Strategy to use when fetching metadata, when this option is <code class="literal">true</code>, the client will maintain
a full set of metadata for all the available topics, if the this option is set to <code class="literal">false</code> it will only refresh the
metadata for the configured topics. The default is false.
</dd>
<dt>
<span class="term">
<span class="strong strong"><strong><code class="literal">retry.max</code></strong></span>
</span>
</dt>
<dd>
Total number of metadata update retries when cluster is in middle of leader election. The default is 3.
</dd>
<dt>
<span class="term">
<span class="strong strong"><strong><code class="literal">retry.backoff</code></strong></span>
</span>
</dt>
<dd>
Waiting time between retries during leader elections. Default is <code class="literal">250ms</code>.
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h6 class="title"><a id="_max_retries_3"></a><code class="literal">max_retries</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.12/docs/en/apm-server/configure/outputs/kafka.asciidoc">edit</a></h6>
</div></div></div>
<p>The number of times to retry publishing an event after a publishing failure.
After the specified number of retries, the events are typically dropped.</p>
<p>Set <code class="literal">max_retries</code> to a value less than 0 to retry until all events are published.</p>
<p>The default is 3.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h6 class="title"><a id="_backoff_init_3"></a><code class="literal">backoff.init</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.12/docs/en/apm-server/configure/outputs/kafka.asciidoc">edit</a></h6>
</div></div></div>
<p>The number of seconds to wait before trying to republish to Kafka
after a network error. After waiting <code class="literal">backoff.init</code> seconds, APM Server
tries to republish. If the attempt fails, the backoff timer is increased
exponentially up to <code class="literal">backoff.max</code>. After a successful publish, the backoff
timer is reset. The default is <code class="literal">1s</code>.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h6 class="title"><a id="_backoff_max_3"></a><code class="literal">backoff.max</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.12/docs/en/apm-server/configure/outputs/kafka.asciidoc">edit</a></h6>
</div></div></div>
<p>The maximum number of seconds to wait before attempting to republish to
Kafka after a network error. The default is <code class="literal">60s</code>.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h6 class="title"><a id="_bulk_max_size_2"></a><code class="literal">bulk_max_size</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.12/docs/en/apm-server/configure/outputs/kafka.asciidoc">edit</a></h6>
</div></div></div>
<p>The maximum number of events to bulk in a single Kafka request. The default is 2048.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h6 class="title"><a id="_bulk_flush_frequency"></a><code class="literal">bulk_flush_frequency</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.12/docs/en/apm-server/configure/outputs/kafka.asciidoc">edit</a></h6>
</div></div></div>
<p>Duration to wait before sending bulk Kafka request. 0 is no delay. The default is 0.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h6 class="title"><a id="_timeout_3"></a><code class="literal">timeout</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.12/docs/en/apm-server/configure/outputs/kafka.asciidoc">edit</a></h6>
</div></div></div>
<p>The number of seconds to wait for responses from the Kafka brokers before timing
out. The default is 30 (seconds).</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h6 class="title"><a id="_broker_timeout"></a><code class="literal">broker_timeout</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.12/docs/en/apm-server/configure/outputs/kafka.asciidoc">edit</a></h6>
</div></div></div>
<p>The maximum duration a broker will wait for number of required ACKs. The default is <code class="literal">10s</code>.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h6 class="title"><a id="_channel_buffer_size"></a><code class="literal">channel_buffer_size</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.12/docs/en/apm-server/configure/outputs/kafka.asciidoc">edit</a></h6>
</div></div></div>
<p>Per Kafka broker number of messages buffered in output pipeline. The default is 256.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h6 class="title"><a id="_keep_alive"></a><code class="literal">keep_alive</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.12/docs/en/apm-server/configure/outputs/kafka.asciidoc">edit</a></h6>
</div></div></div>
<p>The keep-alive period for an active network connection. If <code class="literal">0s</code>, keep-alives are disabled. The default is <code class="literal">0s</code>.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h6 class="title"><a id="_compression"></a><code class="literal">compression</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.12/docs/en/apm-server/configure/outputs/kafka.asciidoc">edit</a></h6>
</div></div></div>
<p>Sets the output compression codec. Must be one of <code class="literal">none</code>, <code class="literal">snappy</code>, <code class="literal">lz4</code> and <code class="literal">gzip</code>. The default is <code class="literal">gzip</code>.</p>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<h3>Known issue with Azure Event Hub for Kafka</h3>
<p>When targeting Azure Event Hub for Kafka, set <code class="literal">compression</code> to <code class="literal">none</code> as the provided codecs are not supported.</p>
</div>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h6 class="title"><a id="_compression_level_3"></a><code class="literal">compression_level</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.12/docs/en/apm-server/configure/outputs/kafka.asciidoc">edit</a></h6>
</div></div></div>
<p>Sets the compression level used by gzip. Setting this value to 0 disables compression.
The compression level must be in the range of 1 (best speed) to 9 (best compression).</p>
<p>Increasing the compression level will reduce the network usage but will increase the CPU usage.</p>
<p>The default value is 4.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h6 class="title"><a id="kafka-max_message_bytes"></a><code class="literal">max_message_bytes</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.12/docs/en/apm-server/configure/outputs/kafka.asciidoc">edit</a></h6>
</div></div></div>
<p>The maximum permitted size of JSON-encoded messages. Bigger messages will be dropped. The default value is 1000000 (bytes). This value should be equal to or less than the broker&#8217;s <code class="literal">message.max.bytes</code>.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h6 class="title"><a id="_required_acks"></a><code class="literal">required_acks</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.12/docs/en/apm-server/configure/outputs/kafka.asciidoc">edit</a></h6>
</div></div></div>
<p>The ACK reliability level required from broker. 0=no response, 1=wait for local commit, -1=wait for all replicas to commit. The default is 1.</p>
<p>Note: If set to 0, no ACKs are returned by Kafka. Messages might be lost silently on error.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h6 class="title"><a id="_enable_krb5_fast"></a><code class="literal">enable_krb5_fast</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.12/docs/en/apm-server/configure/outputs/kafka.asciidoc">edit</a></h6>
</div></div></div>
<div class="warning admon">
<div class="icon"></div>
<div class="admon_content">
<p>This functionality is in beta and is subject to change. The design and code is less mature than official GA features and is being provided as-is with no warranties. Beta features are not subject to the support SLA of official GA features.</p>
</div>
</div>
<p>Enable Kerberos FAST authentication. This may conflict with some Active Directory installations. It is separate from the standard Kerberos settings because this flag only applies to the Kafka output. The default is <code class="literal">false</code>.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h6 class="title"><a id="_ssl_3"></a><code class="literal">ssl</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.12/docs/en/apm-server/configure/outputs/kafka.asciidoc">edit</a></h6>
</div></div></div>
<p>Configuration options for SSL parameters like the root CA for Kafka connections.
 The Kafka host keystore should be created with the
<code class="literal">-keyalg RSA</code> argument to ensure it uses a cipher supported by
<a href="https://github.com/Shopify/sarama/wiki/Frequently-Asked-Questions#why-cant-sarama-connect-to-my-kafka-cluster-using-ssl" class="ulink" target="_top">Filebeat&#8217;s Kafka library</a>.
See <a class="xref" href="configuration-ssl-landing.html#configuration-ssl" title="SSL/TLS output settings">SSL/TLS output settings</a> for more information.</p>
</div>

</div>

</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="redis-output"></a>Configure the Redis output<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.12/docs/en/apm-server/configure/outputs/redis.asciidoc">edit</a></h4>
</div></div></div>

<div class="sidebar">
<div class="titlepage"></div>
<p><span class="image"><img src="./binary-yes-fm-no.svg" alt="supported deployment methods"></span></p>
<p>The Redis output is not yet supported by Fleet-managed APM Server.</p>
</div>
<p>The Redis output inserts the events into a Redis list or a Redis channel.
This output plugin is compatible with
the <a href="/guide/en/logstash/current/plugins-inputs-redis.html" class="ulink" target="_top">Redis input plugin</a> for Logstash.</p>
<p>To use this output, edit the APM Server configuration file to disable the Elasticsearch
output by commenting it out, and enable the Redis output by adding <code class="literal">output.redis</code>.</p>
<p>Example configuration:</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">output.redis:
  hosts: ["localhost"]
  password: "my_password"
  key: "apm-server"
  db: 0
  timeout: 5</pre>
</div>
<h6><a id="_kibana_configuration_2"></a>Kibana configuration<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.12/docs/en/apm-server/configure/outputs/redis.asciidoc">edit</a></h6>
<p>APM Server uses the APM integration to set up and manage APM templates, policies, and pipelines.
To confirm the integration is installed, APM Server polls either Elasticsearch or Kibana on startup.
When using a non-Elasticsearch output, APM Server requires access to Kibana via the
<a class="xref" href="setup-kibana-endpoint.html" title="Configure the Kibana endpoint">Kibana endpoint</a>.</p>
<p>Example configuration:</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">apm-server:
  kibana:
    enabled: true
    host: "https://..."
    username: "elastic"
    password: "xxx"</pre>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h5 class="title"><a id="_compatibility_3"></a>Compatibility<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.12/docs/en/apm-server/configure/outputs/redis.asciidoc">edit</a></h5>
</div></div></div>
<p>This output is expected to work with all Redis versions between 3.2.4 and 5.0.8. Other versions might work as well,
but are not supported.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h5 class="title"><a id="_configuration_options_6"></a>Configuration options<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.12/docs/en/apm-server/configure/outputs/redis.asciidoc">edit</a></h5>
</div></div></div>
<p>You can specify the following <code class="literal">output.redis</code> options in the <code class="literal">apm-server.yml</code> config file:</p>
<div class="section">
<div class="titlepage"><div><div>
<h6 class="title"><a id="_enabled_5"></a><code class="literal">enabled</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.12/docs/en/apm-server/configure/outputs/redis.asciidoc">edit</a></h6>
</div></div></div>
<p>The enabled config is a boolean setting to enable or disable the output. If set
to false, the output is disabled.</p>
<p>The default value is <code class="literal">true</code>.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h6 class="title"><a id="_hosts_3"></a><code class="literal">hosts</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.12/docs/en/apm-server/configure/outputs/redis.asciidoc">edit</a></h6>
</div></div></div>
<p>The list of Redis servers to connect to. If load balancing is enabled, the events are
distributed to the servers in the list. If one server becomes unreachable, the events are
distributed to the reachable servers only. You can define each Redis server by specifying
<code class="literal">HOST</code> or <code class="literal">HOST:PORT</code>. For example: <code class="literal">"192.15.3.2"</code> or <code class="literal">"test.redis.io:12345"</code>. If you
don&#8217;t specify a port number, the value configured by <code class="literal">port</code> is used.
Configure each Redis server with an <code class="literal">IP:PORT</code> pair or with a <code class="literal">URL</code>. For
example: <code class="literal">redis://localhost:6379</code> or <code class="literal">rediss://localhost:6379</code>.
URLs can include a server-specific password. For example: <code class="literal">redis://:password@localhost:6379</code>.
The <code class="literal">redis</code> scheme will disable the <code class="literal">ssl</code> settings for the host, while <code class="literal">rediss</code>
will enforce TLS.  If <code class="literal">rediss</code> is specified and no <code class="literal">ssl</code> settings are
configured, the output uses the system certificate store.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h6 class="title"><a id="_index"></a><code class="literal">index</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.12/docs/en/apm-server/configure/outputs/redis.asciidoc">edit</a></h6>
</div></div></div>
<p>The index name added to the events metadata for use by Logstash. The default is "apm-server".</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h6 class="title"><a id="key-option-redis"></a><code class="literal">key</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.12/docs/en/apm-server/configure/outputs/redis.asciidoc">edit</a></h6>
</div></div></div>
<p>The name of the Redis list or channel the events are published to. If not
configured, the value of the <code class="literal">index</code> setting is used.</p>
<p>You can set the key dynamically by using a format string to access any event
field. For example, this configuration uses a custom field, <code class="literal">fields.list</code>, to
set the Redis list key. If <code class="literal">fields.list</code> is missing, <code class="literal">fallback</code> is used:</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">output.redis:
  hosts: ["localhost"]
  key: "%{[fields.list]:fallback}"</pre>
</div>
<p>See the <a class="xref" href="configuring-output.html#keys-option-redis" title="keys"><code class="literal">keys</code></a> setting for other ways to set the key
dynamically.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h6 class="title"><a id="keys-option-redis"></a><code class="literal">keys</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.12/docs/en/apm-server/configure/outputs/redis.asciidoc">edit</a></h6>
</div></div></div>
<p>An array of key selector rules. Each rule specifies the <code class="literal">key</code> to use for events
that match the rule. During publishing, APM Server uses the first matching
rule in the array. Rules can contain conditionals, format string-based fields,
and name mappings. If the <code class="literal">keys</code> setting is missing or no rule matches, the
<a class="xref" href="configuring-output.html#key-option-redis" title="key"><code class="literal">key</code></a> setting is used.</p>
<p>Rule settings:</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<span class="strong strong"><strong><code class="literal">index</code></strong></span>
</span>
</dt>
<dd>
The key format string to use. If this string contains field
references, such as <code class="literal">%{[fields.name]}</code>, the fields must exist, or the rule
fails.
</dd>
<dt>
<span class="term">
<span class="strong strong"><strong><code class="literal">mappings</code></strong></span>
</span>
</dt>
<dd>
A dictionary that takes the value returned by <code class="literal">key</code> and maps it to
a new name.
</dd>
<dt>
<span class="term">
<span class="strong strong"><strong><code class="literal">default</code></strong></span>
</span>
</dt>
<dd>
The default string value to use if <code class="literal">mappings</code> does not find a match.
</dd>
<dt>
<span class="term">
<span class="strong strong"><strong><code class="literal">when</code></strong></span>
</span>
</dt>
<dd>
A condition that must succeed in order to execute the current rule.
</dd>
</dl>
</div>
<p>Example <code class="literal">keys</code> settings:</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">output.redis:
  hosts: ["localhost"]
  key: "default_list"
  keys:
    - key: "info_list"   # send to info_list if `message` field contains INFO
      when.contains:
        message: "INFO"
    - key: "debug_list"  # send to debug_list if `message` field contains DEBUG
      when.contains:
        message: "DEBUG"
    - key: "%{[fields.list]}"
      mappings:
        http: "frontend_list"
        nginx: "frontend_list"
        mysql: "backend_list"</pre>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h6 class="title"><a id="_password_3"></a><code class="literal">password</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.12/docs/en/apm-server/configure/outputs/redis.asciidoc">edit</a></h6>
</div></div></div>
<p>The password to authenticate with. The default is no authentication.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h6 class="title"><a id="_db"></a><code class="literal">db</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.12/docs/en/apm-server/configure/outputs/redis.asciidoc">edit</a></h6>
</div></div></div>
<p>The Redis database number where the events are published. The default is 0.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h6 class="title"><a id="_datatype"></a><code class="literal">datatype</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.12/docs/en/apm-server/configure/outputs/redis.asciidoc">edit</a></h6>
</div></div></div>
<p>The Redis data type to use for publishing events.If the data type is <code class="literal">list</code>, the
Redis RPUSH command is used and all events are added to the list with the key defined under <code class="literal">key</code>.
If the data type <code class="literal">channel</code> is used, the Redis <code class="literal">PUBLISH</code> command is used and means that all events
are pushed to the pub/sub mechanism of Redis. The name of the channel is the one defined under <code class="literal">key</code>.
The default value is <code class="literal">list</code>.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h6 class="title"><a id="_codec_2"></a><code class="literal">codec</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.12/docs/en/apm-server/configure/outputs/redis.asciidoc">edit</a></h6>
</div></div></div>
<p>Output codec configuration. If the <code class="literal">codec</code> section is missing, events will be JSON encoded.</p>
<p>See <a class="xref" href="configuring-output.html#configuration-output-codec" title="Change the output codec">Change the output codec</a> for more information.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h6 class="title"><a id="_worker_3"></a><code class="literal">worker</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.12/docs/en/apm-server/configure/outputs/redis.asciidoc">edit</a></h6>
</div></div></div>
<p>The number of workers to use for each host configured to publish events to Redis. Use this setting along with the
<code class="literal">loadbalance</code> option. For example, if you have 2 hosts and 3 workers, in total 6 workers are started (3 for each host).</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h6 class="title"><a id="_loadbalance"></a><code class="literal">loadbalance</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.12/docs/en/apm-server/configure/outputs/redis.asciidoc">edit</a></h6>
</div></div></div>
<p>If set to true and multiple hosts or workers are configured, the output plugin load balances published events onto all
Redis hosts. If set to false, the output plugin sends all events to only one host (determined at random) and will switch
to another host if the currently selected one becomes unreachable. The default value is true.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h6 class="title"><a id="_timeout_4"></a><code class="literal">timeout</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.12/docs/en/apm-server/configure/outputs/redis.asciidoc">edit</a></h6>
</div></div></div>
<p>The Redis connection timeout in seconds. The default is 5 seconds.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h6 class="title"><a id="_backoff_init_4"></a><code class="literal">backoff.init</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.12/docs/en/apm-server/configure/outputs/redis.asciidoc">edit</a></h6>
</div></div></div>
<p>The number of seconds to wait before trying to reconnect to Redis after
a network error. After waiting <code class="literal">backoff.init</code> seconds, APM Server tries to
reconnect. If the attempt fails, the backoff timer is increased exponentially up
to <code class="literal">backoff.max</code>. After a successful connection, the backoff timer is reset. The
default is <code class="literal">1s</code>.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h6 class="title"><a id="_backoff_max_4"></a><code class="literal">backoff.max</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.12/docs/en/apm-server/configure/outputs/redis.asciidoc">edit</a></h6>
</div></div></div>
<p>The maximum number of seconds to wait before attempting to connect to
Redis after a network error. The default is <code class="literal">60s</code>.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h6 class="title"><a id="_max_retries_4"></a><code class="literal">max_retries</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.12/docs/en/apm-server/configure/outputs/redis.asciidoc">edit</a></h6>
</div></div></div>
<p>The number of times to retry publishing an event after a publishing failure.
After the specified number of retries, the events are typically dropped.</p>
<p>Set <code class="literal">max_retries</code> to a value less than 0 to retry until all events are published.</p>
<p>The default is 3.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h6 class="title"><a id="_bulk_max_size_3"></a><code class="literal">bulk_max_size</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.12/docs/en/apm-server/configure/outputs/redis.asciidoc">edit</a></h6>
</div></div></div>
<p>The maximum number of events to bulk in a single Redis request or pipeline. The default is 2048.</p>
<p>If the Beat sends single events, the events are collected into batches. If the
Beat publishes a large batch of events (larger than the value specified by
<code class="literal">bulk_max_size</code>), the batch is split.</p>
<p>Specifying a larger batch size can improve performance by lowering the overhead
of sending events. However big batch sizes can also increase processing times,
which might result in API errors, killed connections, timed-out publishing
requests, and, ultimately, lower throughput.</p>
<p>Setting <code class="literal">bulk_max_size</code> to values less than or equal to 0 disables the
splitting of batches. When splitting is disabled, the queue decides on the
number of events to be contained in a batch.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h6 class="title"><a id="_ssl_4"></a><code class="literal">ssl</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.12/docs/en/apm-server/configure/outputs/redis.asciidoc">edit</a></h6>
</div></div></div>
<p>Configuration options for SSL parameters like the root CA for Redis connections
guarded by SSL proxies (for example <a href="https://www.stunnel.org" class="ulink" target="_top">stunnel</a>). See
<a class="xref" href="configuration-ssl-landing.html#configuration-ssl" title="SSL/TLS output settings">SSL/TLS output settings</a> for more information.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h6 class="title"><a id="_proxy_url_3"></a><code class="literal">proxy_url</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.12/docs/en/apm-server/configure/outputs/redis.asciidoc">edit</a></h6>
</div></div></div>
<p>The URL of the SOCKS5 proxy to use when connecting to the Redis servers. The
value must be a URL with a scheme of <code class="literal">socks5://</code>. You cannot use a web proxy
because the protocol used to communicate with Redis is not based on HTTP.</p>
<p>If the SOCKS5 proxy server requires client authentication, you can embed
a username and password in the URL.</p>
<p>When using a proxy, hostnames are resolved on the proxy server instead of on the
client. You can change this behavior by setting the
<a class="xref" href="configuring-output.html#redis-proxy-use-local-resolver" title="proxy_use_local_resolver"><code class="literal">proxy_use_local_resolver</code></a> option.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h6 class="title"><a id="redis-proxy-use-local-resolver"></a><code class="literal">proxy_use_local_resolver</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.12/docs/en/apm-server/configure/outputs/redis.asciidoc">edit</a></h6>
</div></div></div>
<p>This option determines whether Redis hostnames are resolved locally when using a proxy.
The default value is false, which means that name resolution occurs on the proxy server.</p>
</div>

</div>

</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="console-output"></a>Configure the Console output<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.12/docs/en/apm-server/configure/outputs/console.asciidoc">edit</a></h4>
</div></div></div>

<div class="sidebar">
<div class="titlepage"></div>
<p><span class="image"><img src="./binary-yes-fm-no.svg" alt="supported deployment methods"></span></p>
<p>The Console output is not yet supported by Fleet-managed APM Server.</p>
</div>
<p>The Console output writes events in JSON format to stdout.</p>
<div class="warning admon">
<div class="icon"></div>
<div class="admon_content">
<p>The Console output should be used only for debugging issues as it can produce a large amount of logging data.</p>
</div>
</div>
<p>To use this output, edit the APM Server configuration file to disable the Elasticsearch
output by commenting it out, and enable the console output by adding <code class="literal">output.console</code>.</p>
<p>Example configuration:</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">output.console:
  pretty: true</pre>
</div>
<h6><a id="_kibana_configuration_3"></a>Kibana configuration<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.12/docs/en/apm-server/configure/outputs/console.asciidoc">edit</a></h6>
<p>APM Server uses the APM integration to set up and manage APM templates, policies, and pipelines.
To confirm the integration is installed, APM Server polls either Elasticsearch or Kibana on startup.
When using a non-Elasticsearch output, APM Server requires access to Kibana via the
<a class="xref" href="setup-kibana-endpoint.html" title="Configure the Kibana endpoint">Kibana endpoint</a>.</p>
<p>Example configuration:</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">apm-server:
  kibana:
    enabled: true
    host: "https://..."
    username: "elastic"
    password: "xxx"</pre>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h5 class="title"><a id="_configuration_options_7"></a>Configuration options<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.12/docs/en/apm-server/configure/outputs/console.asciidoc">edit</a></h5>
</div></div></div>
<p>You can specify the following <code class="literal">output.console</code> options in the <code class="literal">apm-server.yml</code> config file:</p>
<div class="section">
<div class="titlepage"><div><div>
<h6 class="title"><a id="_enabled_6"></a><code class="literal">enabled</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.12/docs/en/apm-server/configure/outputs/console.asciidoc">edit</a></h6>
</div></div></div>
<p>The enabled config is a boolean setting to enable or disable the output. If set
to false, the output is disabled.</p>
<p>The default value is <code class="literal">true</code>.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h6 class="title"><a id="_pretty"></a><code class="literal">pretty</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.12/docs/en/apm-server/configure/outputs/console.asciidoc">edit</a></h6>
</div></div></div>
<p>If <code class="literal">pretty</code> is set to true, events written to stdout will be nicely formatted. The default is false.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h6 class="title"><a id="_codec_3"></a><code class="literal">codec</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.12/docs/en/apm-server/configure/outputs/console.asciidoc">edit</a></h6>
</div></div></div>
<p>Output codec configuration. If the <code class="literal">codec</code> section is missing, events will be JSON encoded using the <code class="literal">pretty</code> option.</p>
<p>See <a class="xref" href="configuring-output.html#configuration-output-codec" title="Change the output codec">Change the output codec</a> for more information.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h6 class="title"><a id="_bulk_max_size_4"></a><code class="literal">bulk_max_size</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.12/docs/en/apm-server/configure/outputs/console.asciidoc">edit</a></h6>
</div></div></div>
<p>The maximum number of events to buffer internally during publishing. The default is 2048.</p>
<p>Specifying a larger batch size may add some latency and buffering during publishing. However, for Console output, this
setting does not affect how events are published.</p>
<p>Setting <code class="literal">bulk_max_size</code> to values less than or equal to 0 disables the
splitting of batches. When splitting is disabled, the queue decides on the
number of events to be contained in a batch.</p>
</div>

</div>

<div class="section">
<div class="titlepage"><div><div>
<h5 class="title"><a id="configuration-output-codec"></a>Change the output codec<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.12/docs/en/apm-server/configure/outputs/codec.asciidoc">edit</a></h5>
</div></div></div>
<p>For outputs that do not require a specific encoding, you can change the encoding
by using the codec configuration. You can specify either the <code class="literal">json</code> or <code class="literal">format</code>
codec. By default the <code class="literal">json</code> codec is used.</p>
<p><span class="strong strong"><strong><code class="literal">json.pretty</code></strong></span>: If <code class="literal">pretty</code> is set to true, events will be nicely formatted. The default is false.</p>
<p><span class="strong strong"><strong><code class="literal">json.escape_html</code></strong></span>: If <code class="literal">escape_html</code> is set to true, HTML symbols will be escaped in strings. The default is false.</p>
<p>Example configuration that uses the <code class="literal">json</code> codec with pretty printing enabled to write events to the console:</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">output.console:
  codec.json:
    pretty: true
    escape_html: false</pre>
</div>
<p><span class="strong strong"><strong><code class="literal">format.string</code></strong></span>: Configurable format string used to create a custom formatted message.</p>
<p>Example configurable that uses the <code class="literal">format</code> codec to print the events timestamp and message field to console:</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">output.console:
  codec.format:
    string: '%{[@timestamp]} %{[message]}'</pre>
</div>
</div>

</div>

</div>
<div class="navfooter">
<span class="prev">
<a href="configuration-logging.html">« Configure logging</a>
</span>
<span class="next">
<a href="configuration-path.html">Configure project paths »</a>
</span>
</div>
</div>

                  <!-- end body -->
                </div>

                <div class="col-12 order-3 col-lg-2 order-lg-3 h-almost-full-lg sticky-top-lg" id="right_col">
                  <div id="sticky_content">
                    <!-- The OTP is appended here -->
                    <div class="row">
                      <div class="col-0 col-md-4 col-lg-0" id="bottom_left_col"></div>
                      <div class="col-12 col-md-8 col-lg-12">
                        <div id="rtpcontainer">
                          <div class="mktg-promo" id="most-popular">
                            <p class="aside-heading">Most Popular</p>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-elasticsearch?page=docs&placement=top-video">
                                <p class="mb-0">Get Started with Elasticsearch</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-kibana?page=docs&placement=top-video">
                                <p class="mb-0">Intro to Kibana</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/introduction-elk-stack?page=docs&placement=top-video">
                                <p class="mb-0">ELK for Logs & Metrics</p>
                              </a>
                            </div>
                          </div>
                        </div>

                        <!-- Feedback widget -->
                        <div id="feedbackWidgetContainer"></div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

        </div>


        <div id='elastic-footer'></div>
        <script src='https://www.elastic.co/elastic-footer.js'></script>
        <!-- Footer Section end-->

      </section>
    </div>

    <!-- Feedback modal -->
    <div id="feedbackModalContainer"></div>

    <script src="/guide/static/jquery.js"></script>
    <script type="text/javascript" src="/guide/static/docs.js"></script>
    <script type="text/javascript">
  window.initial_state = {}</script>
  </body>
</html>
