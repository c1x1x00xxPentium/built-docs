<!DOCTYPE html>
<html lang="en-us">
  <head>
    
<meta charset="UTF-8">
<title>AUTO_BUCKET | Elasticsearch Guide [master] | Elastic</title>
<meta class="elastic" name="content" content="AUTO_BUCKET | Elasticsearch Guide [master]">

<link rel="home" href="index.html" title="Elasticsearch Guide [master]"/>
<link rel="up" href="esql-functions.html" title="ES|QL functions"/>
<link rel="prev" href="esql-atan2.html" title="ATAN2"/>
<link rel="next" href="esql-case.html" title="CASE"/>
<meta class="elastic" name="product_version" content="master"/>
<meta class="elastic" name="product_name" content="Elasticsearch"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Elasticsearch/Reference/master"/>
<meta name="DC.subject" content="Elasticsearch"/>
<meta name="DC.identifier" content="master"/>
<meta name="robots" content="noindex,nofollow"/>

    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://cdn.optimizely.com/js/18132920325.js"></script>
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/manifest.json">
    <meta name="apple-mobile-web-app-title" content="Elastic">
    <meta name="application-name" content="Elastic">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/mstile-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="naver-site-verification" content="936882c1853b701b3cef3721758d80535413dbfd" />
    <meta name="yandex-verification" content="d8a47e95d0972434" />
    <meta name="localized" content="true" />
    <meta name="st:robots" content="follow,index" />
    <meta property="og:image" content="https://static-www.elastic.co/v3/assets/bltefdd0b53724fa2ce/blt280217a63b82a734/6202d3378b1f312528798412/elastic-logo.svg" />
    <meta property="og:image:width" content="500" />
    <meta property="og:image:height" content="172" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon-precomposed" sizes="64x64" href="/favicon_64x64_16bit.png">
    <link rel="apple-touch-icon-precomposed" sizes="32x32" href="/favicon_32x32.png">
    <link rel="apple-touch-icon-precomposed" sizes="16x16" href="/favicon_16x16.png">
    <!-- Give IE8 a fighting chance -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" type="text/css" href="/guide/static/styles.css" />
  </head>

  <!--© 2015-2022 Elasticsearch B.V. -->
  <!-- All Elastic documentation is licensed under a Creative Commons Attribution-NonCommercial-NoDerivatives 4.0 International License. -->
  <!-- http://creativecommons.org/licenses/by-nc-nd/4.0/ -->

  <body>
    <!-- Google Tag Manager -->
    <script>dataLayer = [];</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-58RLH5" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-58RLH5');</script>
    <!-- End Google Tag Manager -->

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-12395217-16"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-12395217-16');
    </script>

    <!-- Google Tag Manager for GA4 -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-KNJMG2M');</script>
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KNJMG2M" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager for GA4-->

    <div id='elastic-nav' style="display:none;"></div>
    <script src='https://www.elastic.co/elastic-nav.js'></script>

    <div class="main-container">
      <section id="content" >
        <div class="content-wrapper">

          <section id="guide" lang="en">
            <div class="container-fluid">
              <div class="row pb-3">
                <div class="col-12 order-2 col-md-4 order-md-1 col-lg-3 h-almost-full-md sticky-top-md" id="left_col">
                  <!-- The TOC is appended here -->
                </div>

                <div class="col-12 order-1 col-md-8 order-md-2 col-lg-7 order-lg-2 guide-section" id="middle_col">
                  <!-- start body -->
                  <div class="page_header">
You are looking at preliminary documentation for a future release.
Not what you want? See the
<a href="../current/index.html">current release documentation</a>.
</div>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elasticsearch Guide [master]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="esql.html">ES|QL</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="esql-functions.html">ES|QL functions</a></span>
</div>
<div class="navheader">
<span class="prev">
<a href="esql-atan2.html">« <code class="literal">ATAN2</code></a>
</span>
<span class="next">
<a href="esql-case.html"><code class="literal">CASE</code> »</a>
</span>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="esql-auto_bucket"></a><code class="literal">AUTO_BUCKET</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/esql/functions/auto_bucket.asciidoc">edit</a></h2>
</div></div></div>
<p>Creates human-friendly buckets and returns a <code class="literal">datetime</code> value for each row that
corresponds to the resulting bucket the row falls into. Combine <code class="literal">AUTO_BUCKET</code>
with <a class="xref" href="esql-stats-by.html" title="STATS ... BY"><code class="literal">STATS ... BY</code></a> to create a date histogram.</p>
<p>You provide a target number of buckets, a start date, and an end date, and it
picks an appropriate bucket size to generate the target number of buckets or
fewer. For example, this asks for at most 20 buckets over a whole year, which
picks monthly buckets:</p>
<div class="pre_wrapper lang-esql merge styled">
<pre class="programlisting prettyprint lang-esql merge styled">ROW date=TO_DATETIME("1985-07-09T00:00:00.000Z")
| EVAL bucket=AUTO_BUCKET(date, 20, "1985-01-01T00:00:00Z", "1986-01-01T00:00:00Z")</pre>
</div>
<div class="informaltable">
<table border="1" cellpadding="4px" class="monospaced styled">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">date:datetime</th>
<th align="left" valign="top">bucket:datetime</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p>1985-07-09T00:00:00.000Z</p></td>
<td align="left" valign="top"><p>1985-07-01T00:00:00.000Z</p></td>
</tr>
</tbody>
</table>
</div>
<p>The goal isn&#8217;t to provide <span class="strong strong"><strong>exactly</strong></span> the target number of buckets, it&#8217;s to pick a
range that people are comfortable with that provides at most the target number of
buckets.</p>
<p>If you ask for more buckets then <code class="literal">AUTO_BUCKET</code> can pick a smaller range. For example,
asking for at most 100 buckets in a year will get you week long buckets:</p>
<div class="pre_wrapper lang-esql merge styled">
<pre class="programlisting prettyprint lang-esql merge styled">ROW date=TO_DATETIME("1985-07-09T00:00:00.000Z")
| EVAL bucket=AUTO_BUCKET(date, 100, "1985-01-01T00:00:00Z", "1986-01-01T00:00:00Z")</pre>
</div>
<div class="informaltable">
<table border="1" cellpadding="4px" class="monospaced styled">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">date:datetime</th>
<th align="left" valign="top">bucket:datetime</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p>1985-07-09T00:00:00.000Z</p></td>
<td align="left" valign="top"><p>1985-07-08T00:00:00.000Z</p></td>
</tr>
</tbody>
</table>
</div>
<p><code class="literal">AUTO_BUCKET</code> does not filter any rows. It only uses the provided time range to
pick a good bucket size. For rows with a date outside of the range, it returns a
<code class="literal">datetime</code> that corresponds to a bucket outside the range. Combine <code class="literal">AUTO_BUCKET</code>
with <a class="xref" href="esql-where.html" title="WHERE"><code class="literal">WHERE</code></a> to filter rows.</p>
<p>A more complete example might look like:</p>
<div class="pre_wrapper lang-esql merge styled">
<pre class="programlisting prettyprint lang-esql merge styled">FROM employees
| WHERE hire_date &gt;= "1985-01-01T00:00:00Z" AND hire_date &lt; "1986-01-01T00:00:00Z"
| EVAL bucket = AUTO_BUCKET(hire_date, 20, "1985-01-01T00:00:00Z", "1986-01-01T00:00:00Z")
| STATS AVG(salary) BY bucket
| SORT bucket</pre>
</div>
<div class="informaltable">
<table border="1" cellpadding="4px" class="monospaced styled">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">AVG(salary):double</th>
<th align="left" valign="top">bucket:date</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p>46305.0</p></td>
<td align="left" valign="top"><p>1985-02-01T00:00:00.000Z</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>44817.0</p></td>
<td align="left" valign="top"><p>1985-05-01T00:00:00.000Z</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>62405.0</p></td>
<td align="left" valign="top"><p>1985-07-01T00:00:00.000Z</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>49095.0</p></td>
<td align="left" valign="top"><p>1985-09-01T00:00:00.000Z</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>51532.0</p></td>
<td align="left" valign="top"><p>1985-10-01T00:00:00.000Z</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>54539.75</p></td>
<td align="left" valign="top"><p>1985-11-01T00:00:00.000Z</p></td>
</tr>
</tbody>
</table>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p><code class="literal">AUTO_BUCKET</code> does not create buckets that don&#8217;t match any documents. That&#8217;s
why the example above is missing <code class="literal">1985-02-01</code> and other dates.</p>
</div>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="_numeric_fields"></a>Numeric fields<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/esql/functions/auto_bucket.asciidoc">edit</a></h3>
</div></div></div>
<p><code class="literal">auto_bucket</code> can also operate on numeric fields like this:</p>
<div class="pre_wrapper lang-esql merge styled">
<pre class="programlisting prettyprint lang-esql merge styled">FROM employees
| WHERE hire_date &gt;= "1985-01-01T00:00:00Z" AND hire_date &lt; "1986-01-01T00:00:00Z"
| EVAL bs = auto_bucket(salary, 20, 25324, 74999)
| SORT hire_date
| KEEP hire_date, salary, bs</pre>
</div>
<div class="informaltable">
<table border="1" cellpadding="4px" class="monospaced styled">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">hire_date:date</th>
<th align="left" valign="top">salary:integer</th>
<th align="left" valign="top">bs:double</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p>1985-02-18T00:00:00.000Z</p></td>
<td align="left" valign="top"><p>66174</p></td>
<td align="left" valign="top"><p>65000.0</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>1985-02-24T00:00:00.000Z</p></td>
<td align="left" valign="top"><p>26436</p></td>
<td align="left" valign="top"><p>25000.0</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>1985-05-13T00:00:00.000Z</p></td>
<td align="left" valign="top"><p>44817</p></td>
<td align="left" valign="top"><p>40000.0</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>1985-07-09T00:00:00.000Z</p></td>
<td align="left" valign="top"><p>62405</p></td>
<td align="left" valign="top"><p>60000.0</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>1985-09-17T00:00:00.000Z</p></td>
<td align="left" valign="top"><p>49095</p></td>
<td align="left" valign="top"><p>45000.0</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>1985-10-14T00:00:00.000Z</p></td>
<td align="left" valign="top"><p>54329</p></td>
<td align="left" valign="top"><p>50000.0</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>1985-10-20T00:00:00.000Z</p></td>
<td align="left" valign="top"><p>48735</p></td>
<td align="left" valign="top"><p>45000.0</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>1985-11-19T00:00:00.000Z</p></td>
<td align="left" valign="top"><p>52833</p></td>
<td align="left" valign="top"><p>50000.0</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>1985-11-20T00:00:00.000Z</p></td>
<td align="left" valign="top"><p>74999</p></td>
<td align="left" valign="top"><p>70000.0</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>1985-11-20T00:00:00.000Z</p></td>
<td align="left" valign="top"><p>33956</p></td>
<td align="left" valign="top"><p>30000.0</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>1985-11-21T00:00:00.000Z</p></td>
<td align="left" valign="top"><p>56371</p></td>
<td align="left" valign="top"><p>55000.0</p></td>
</tr>
</tbody>
</table>
</div>
<p>Unlike the example above where you are intentionally filtering on a date range,
you rarely want to filter on a numeric range. So you have find the <code class="literal">min</code> and <code class="literal">max</code>
separately. We don&#8217;t yet have an easy way to do that automatically. Improvements
coming!</p>
</div>

</div>
<div class="navfooter">
<span class="prev">
<a href="esql-atan2.html">« <code class="literal">ATAN2</code></a>
</span>
<span class="next">
<a href="esql-case.html"><code class="literal">CASE</code> »</a>
</span>
</div>
</div>

                  <!-- end body -->
                </div>

                <div class="col-12 order-3 col-lg-2 order-lg-3 h-almost-full-lg sticky-top-lg" id="right_col">
                  <div id="sticky_content">
                    <!-- The OTP is appended here -->
                    <div class="row">
                      <div class="col-0 col-md-4 col-lg-0" id="bottom_left_col"></div>
                      <div class="col-12 col-md-8 col-lg-12">
                        <div id="rtpcontainer">
                          <div class="mktg-promo" id="most-popular">
                            <p class="aside-heading">Most Popular</p>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-elasticsearch?baymax=default&elektra=docs&storm=top-video">
                                <p class="mb-0">Get Started with Elasticsearch</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-kibana?baymax=default&elektra=docs&storm=top-video">
                                <p class="mb-0">Intro to Kibana</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/introduction-elk-stack?baymax=default&elektra=docs&storm=top-video">
                                <p class="mb-0">ELK for Logs & Metrics</p>
                              </a>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

        </div>


<div id='elastic-footer'></div>
<script src='https://www.elastic.co/elastic-footer.js'></script>
<!-- Footer Section end-->

      </section>
    </div>

<script src="/guide/static/jquery.js"></script>
<script type="text/javascript" src="/guide/static/docs.js"></script>
<script type="text/javascript">
  window.initial_state = {"alternatives":{"console":{"php":{"hasAny":true},"python":{"hasAny":true},"ruby":{"hasAny":true},"go":{"hasAny":true},"js":{"hasAny":true}}}}</script>
  </body>
</html>
