<!DOCTYPE html>
<html lang="en-us">
  <head>
    
<meta charset="UTF-8">
<title>Create a snapshot | Elasticsearch Guide [master] | Elastic</title>
<link rel="home" href="index.html" title="Elasticsearch Guide [master]"/>
<link rel="up" href="snapshot-restore.html" title="Snapshot and restore"/>
<link rel="prev" href="snapshots-register-repository.html" title="Register a snapshot repository"/>
<link rel="next" href="snapshots-restore-snapshot.html" title="Restore a snapshot"/>
<meta name="DC.type" content="Learn/Docs/Elasticsearch/Reference/master"/>
<meta name="DC.subject" content="Elasticsearch"/>
<meta name="DC.identifier" content="master"/>

    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://cdn.optimizely.com/js/18132920325.js"></script>
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/manifest.json">
    <meta name="apple-mobile-web-app-title" content="Elastic">
    <meta name="application-name" content="Elastic">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/mstile-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="naver-site-verification" content="936882c1853b701b3cef3721758d80535413dbfd" />
    <meta name="yandex-verification" content="d8a47e95d0972434" />
    <meta name="localized" content="true" />
    <meta name="st:robots" content="follow,index" />
    <meta property="og:image" content="https://www.elastic.co/static/images/elastic-logo-200.png" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon-precomposed" sizes="64x64" href="/favicon_64x64_16bit.png">
    <link rel="apple-touch-icon-precomposed" sizes="32x32" href="/favicon_32x32.png">
    <link rel="apple-touch-icon-precomposed" sizes="16x16" href="/favicon_16x16.png">
    <!-- Give IE8 a fighting chance -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" type="text/css" href="/guide/static/styles.css" />
  </head>

  <!--© 2015-2021 Elasticsearch B.V. Copying, publishing and/or distributing without written permission is strictly prohibited.-->

  <body>
    <!-- Google Tag Manager -->
    <script>dataLayer = [];</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-58RLH5" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-58RLH5');</script>
    <!-- End Google Tag Manager -->

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-12395217-16"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-12395217-16');
    </script>

    <!--BEGIN QUALTRICS WEBSITE FEEDBACK SNIPPET-->
    <script type='text/javascript'>
      (function(){var g=function(e,h,f,g){
      this.get=function(a){for(var a=a+"=",c=document.cookie.split(";"),b=0,e=c.length;b<e;b++){for(var d=c[b];" "==d.charAt(0);)d=d.substring(1,d.length);if(0==d.indexOf(a))return d.substring(a.length,d.length)}return null};
      this.set=function(a,c){var b="",b=new Date;b.setTime(b.getTime()+6048E5);b="; expires="+b.toGMTString();document.cookie=a+"="+c+b+"; path=/; "};
      this.check=function(){var a=this.get(f);if(a)a=a.split(":");else if(100!=e)"v"==h&&(e=Math.random()>=e/100?0:100),a=[h,e,0],this.set(f,a.join(":"));else return!0;var c=a[1];if(100==c)return!0;switch(a[0]){case "v":return!1;case "r":return c=a[2]%Math.floor(100/c),a[2]++,this.set(f,a.join(":")),!c}return!0};
      this.go=function(){if(this.check()){var a=document.createElement("script");a.type="text/javascript";a.src=g;document.body&&document.body.appendChild(a)}};
      this.start=function(){var a=this;window.addEventListener?window.addEventListener("load",function(){a.go()},!1):window.attachEvent&&window.attachEvent("onload",function(){a.go()})}};
      try{(new g(100,"r","QSI_S_ZN_emkP0oSe9Qrn7kF","https://znemkp0ose9qrn7kf-elastic.siteintercept.qualtrics.com/WRSiteInterceptEngine/?Q_ZID=ZN_emkP0oSe9Qrn7kF")).start()}catch(i){}})();
    </script><div id='ZN_emkP0oSe9Qrn7kF'><!--DO NOT REMOVE-CONTENTS PLACED HERE--></div>
    <!--END WEBSITE FEEDBACK SNIPPET-->

    <div id='elastic-nav' style="display:none;"></div>
    <script src='https://www.elastic.co/elastic-nav.js'></script>

    <!-- Subnav -->
    <div>
      <div>
        <div class="tertiary-nav d-none d-md-block">
          <div class="container">
            <div class="p-t-b-15 d-flex justify-content-between nav-container">
              <div class="breadcrum-wrapper"><span><a href="/guide/" style="font-size: 14px; font-weight: 600; color: #000;">Docs</a></span></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="main-container">
      <section id="content" >
        <div class="content-wrapper">

          <section id="guide" lang="en">
            <div class="container">
              <div class="row">
                <div class="col-xs-12 col-sm-8 col-md-8 guide-section">
                  <!-- start body -->
                  <div class="page_header">
You are looking at preliminary documentation for a future release.
Not what you want? See the
<a href="../current/index.html">current release documentation</a>.
</div>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="index.html">Elasticsearch Guide [master]</a></span>
»
<span class="breadcrumb-link"><a href="snapshot-restore.html">Snapshot and restore</a></span>
»
<span class="breadcrumb-node">Create a snapshot</span>
</div>
<div class="navheader">
<span class="prev">
<a href="snapshots-register-repository.html">« Register a snapshot repository</a>
</span>
<span class="next">
<a href="snapshots-restore-snapshot.html">Restore a snapshot »</a>
</span>
</div>
<div class="chapter">
<div class="titlepage"><div><div>
<h2 class="title"><a id="snapshots-take-snapshot"></a>Create a snapshot<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/snapshot-restore/take-snapshot.asciidoc">edit</a></h2>
</div></div></div>
<p>This guide shows you how to take snapshots of a running cluster. You can later
<a class="xref" href="snapshots-restore-snapshot.html" title="Restore a snapshot">restore a snapshot</a> to recover or transfer its
data.</p>
<p>In this guide, you’ll learn how to:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Automate snapshot creation and retention with snapshot lifecycle management (SLM)
</li>
<li class="listitem">
Manually take a snapshot
</li>
<li class="listitem">
Monitor a snapshot&#8217;s progress
</li>
<li class="listitem">
Delete or cancel a snapshot
</li>
<li class="listitem">
Back up cluster configuration files
</li>
</ul>
</div>
<p>The guide also provides tips for creating dedicated cluster state snapshots.</p>
<h3><a id="create-snapshot-prereqs"></a>Prerequisites<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/snapshot-restore/take-snapshot.asciidoc">edit</a></h3>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>To use Kibana&#8217;s <span class="strong strong"><strong>Snapshot and Restore</strong></span> feature, you must have the following
permissions:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a class="xref" href="security-privileges.html#privileges-list-cluster" title="Cluster privileges">Cluster privileges</a>: <code class="literal">monitor</code>, <code class="literal">manage_slm</code>,
<code class="literal">cluster:admin/snapshot</code>, and <code class="literal">cluster:admin/repository</code>
</li>
<li class="listitem">
<a class="xref" href="security-privileges.html#privileges-list-indices" title="Indices privileges">Index privilege</a>: <code class="literal">all</code> on the <code class="literal">monitor</code> index
</li>
</ul>
</div>
</li>
<li class="listitem">
You can only take a snapshot from a running cluster with an elected
<a class="xref" href="modules-node.html#master-node" title="Master-eligible node">master node</a>.
</li>
<li class="listitem">
A snapshot repository must be <a class="xref" href="snapshots-register-repository.html" title="Register a snapshot repository">registered</a> and
available to the cluster.
</li>
<li class="listitem">
The cluster&#8217;s global metadata must be readable. To include an index in a
snapshot, the index and its metadata must also be readable. Ensure there aren&#8217;t
any <a class="xref" href="modules-cluster.html#cluster-read-only" title="Metadata">cluster blocks</a> or <a class="xref" href="index-modules-blocks.html" title="Index blocks">index
blocks</a> that prevent read access.
</li>
</ul>
</div>
<h3><a id="create-snapshot-considerations"></a>Considerations<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/snapshot-restore/take-snapshot.asciidoc">edit</a></h3>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Each snapshot must have a unique name within its repository. Attempts to
create a snapshot with the same name as an existing snapshot will fail.
</li>
<li class="listitem">
Snapshots are incremental. You can take snapshots frequently with little
impact to your storage overhead. See <a class="xref" href="snapshot-restore.html#how-snapshots-work" title="How snapshots work">How snapshots work</a>.
</li>
<li class="listitem">
Taking a snapshot can temporarily pause shard allocations.
See <a class="xref" href="snapshot-restore.html#snapshots-shard-allocation" title="Snapshots and shard allocation">Snapshots and shard allocation</a>.
</li>
<li class="listitem">
Taking a snapshot doesn&#8217;t block indexing or other requests. However, the
snapshot won&#8217;t include changes made after the snapshot process starts.
</li>
<li class="listitem">
You can take multiple snapshots at the same time. The
<a class="xref" href="snapshot-settings.html#snapshot-max-concurrent-ops"><code class="literal">snapshot.max_concurrent_operations</code></a> cluster
setting limits the maximum number of concurrent snapshot operations.
</li>
<li class="listitem">
<p>If you include a data stream in a snapshot, the snapshot also includes the
stream’s backing indices and metadata.</p>
<p>You can also include only specific backing indices in a snapshot. However, the
snapshot won&#8217;t include the data stream’s metadata or its other backing indices.</p>
</li>
<li class="listitem">
A snapshot can include a data stream but exclude specific backing indices.
When you restore such a data stream, it will contain only backing indices in the
snapshot. If the stream’s original write index is not in the snapshot, the most
recent backing index from the snapshot becomes the stream’s write index.
</li>
</ul>
</div>
<h3><a id="automate-snapshots-slm"></a>Automate snapshots with SLM<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/snapshot-restore/take-snapshot.asciidoc">edit</a></h3>
<p>Snapshot lifecycle management (SLM) is the easiest way to regularly back up a cluster. An
SLM policy automatically takes snapshots on a preset schedule. The policy
can also delete snapshots based on retention rules you define.</p>
<div class="tip admon">
<div class="icon"></div>
<div class="admon_content">
<p>Elasticsearch Service deployments automatically include the <code class="literal">cloud-snapshot-policy</code>
SLM policy. Elasticsearch Service uses this policy to take periodic snapshots of your
cluster. For more information, see the <a href="/guide/en/cloud/current/ec-snapshot-restore.html" class="ulink" target="_top">Elasticsearch Service
snapshot documentation</a>.</p>
</div>
</div>
<h4><a id="slm-security"></a>SLM security<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/snapshot-restore/take-snapshot.asciidoc">edit</a></h4>
<p>The following <a class="xref" href="security-privileges.html#privileges-list-cluster" title="Cluster privileges">cluster privileges</a> control access to
the SLM actions when Elasticsearch security features are enabled:</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">manage_slm</code>
</span>
</dt>
<dd>
Allows a user to perform all SLM actions, including
creating and updating policies and starting and stopping SLM.
</dd>
<dt>
<span class="term">
<code class="literal">read_slm</code>
</span>
</dt>
<dd>
Allows a user to perform all read-only SLM actions, such as getting
policies and checking the SLM status.
</dd>
<dt>
<span class="term">
<code class="literal">cluster:admin/snapshot/*</code>
</span>
</dt>
<dd>
Allows a user to take and delete snapshots of any index, whether or not they
have access to that index.
</dd>
</dl>
</div>
<p>You can create and manage roles to assign these privileges through Kibana
Management.</p>
<p>To grant the privileges necessary to create and manage SLM policies and
snapshots, you can set up a role with the <code class="literal">manage_slm</code> and
<code class="literal">cluster:admin/snapshot/*</code> cluster privileges and full access to the SLM
history indices.</p>
<p>For example, the following request creates an <code class="literal">slm-admin</code> role:</p>
<a id="cb16f1ff85399ddaa418834be580c9de"></a>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST _security/role/slm-admin
{
  "cluster": [ "manage_slm", "cluster:admin/snapshot/*" ],
  "indices": [
    {
      "names": [ ".slm-history-*" ],
      "privileges": [ "all" ]
    }
  ]
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/1544.console"></div>
<p>To grant read-only access to SLM policies and the snapshot history,
you can set up a role with the <code class="literal">read_slm</code> cluster privilege and read access
to the snapshot lifecycle management history indices.</p>
<p>For example, the following request creates a <code class="literal">slm-read-only</code> role:</p>
<a id="658842bf41e0fcb7969937155946a0ff"></a>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST _security/role/slm-read-only
{
  "cluster": [ "read_slm" ],
  "indices": [
    {
      "names": [ ".slm-history-*" ],
      "privileges": [ "read" ]
    }
  ]
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/1545.console"></div>
<h4><a id="create-slm-policy"></a>Create an SLM policy<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/snapshot-restore/take-snapshot.asciidoc">edit</a></h4>
<p>To manage SLM in Kibana, go to the main menu and click <span class="strong strong"><strong>Stack
Management</strong></span> &gt; <span class="strong strong"><strong>Snapshot and Restore</strong></span> &gt; <span class="strong strong"><strong>Policies</strong></span>. To create a policy,
click <span class="strong strong"><strong>Create policy</strong></span>.</p>
<p>You can also manage SLM using the
<a class="xref" href="snapshot-lifecycle-management-api.html" title="Snapshot lifecycle management APIs">SLM APIs</a>. To create a policy, use
the <a class="xref" href="slm-api-put-policy.html" title="Create or update snapshot lifecycle policy API">create SLM policy API</a>.</p>
<p>The following request creates a policy that backs up the cluster state, all data
streams, and all indices daily at 1:30AM UTC.</p>
<a id="d3af2421042a7db5ecbc5d5ff9f64b94"></a>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">PUT _slm/policy/nightly-snapshots
{
  "schedule": "0 30 2 * * ?",       <a id="CO512-1"></a><i class="conum" data-value="1"></i>
  "name": "&lt;nightly-snap-{now/d}&gt;", <a id="CO512-2"></a><i class="conum" data-value="2"></i>
  "repository": "my_repository",    <a id="CO512-3"></a><i class="conum" data-value="3"></i>
  "config": {
    "indices": [ "*" ],             <a id="CO512-4"></a><i class="conum" data-value="4"></i>
    "include_global_state": true    <a id="CO512-5"></a><i class="conum" data-value="5"></i>
  },
  "retention": {                    <a id="CO512-6"></a><i class="conum" data-value="6"></i>
    "expire_after": "30d",
    "min_count": 5,
    "max_count": 50
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/1546.console"></div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO512-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>When to take snapshots, written in <a class="xref" href="trigger-schedule.html#schedule-cron" title="Watcher cron schedule">Cron syntax</a>.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO512-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>Snapshot name. Supports <a class="xref" href="api-conventions.html#api-date-math-index-names" title="Date math support in index and index alias names">date math</a>. To prevent
naming conflicts, the policy also appends a UUID to each snapshot name.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO512-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p><a class="xref" href="snapshots-register-repository.html" title="Register a snapshot repository">Registered snapshot repository</a> used to
store the policy&#8217;s snapshots.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO512-4"><i class="conum" data-value="4"></i></a></p>
</td>
<td align="left" valign="top">
<p>Data streams and indices to include in the policy&#8217;s snapshots. This
configuration includes all data streams and indices, including system
indices.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO512-5"><i class="conum" data-value="5"></i></a></p>
</td>
<td align="left" valign="top">
<p>If <code class="literal">true</code>, the policy&#8217;s snapshots include the cluster state and all system
indices.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO512-6"><i class="conum" data-value="6"></i></a></p>
</td>
<td align="left" valign="top">
<p>Optional retention rules. This configuration keeps snapshots for 30 days,
retaining at least 5 and no more than 50 snapshots regardless of age.</p>
</td>
</tr>
</table>
</div>
<h4><a id="manually-run-slm-policy"></a>Manually run an SLM policy<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/snapshot-restore/take-snapshot.asciidoc">edit</a></h4>
<p>You can manually run an SLM policy to immediately create a snapshot. This
is useful for testing a new policy or taking a snapshot before an upgrade.
Manually running a policy doesn&#8217;t affect its snapshot schedule.</p>
<p>To run a policy in Kibana, go to the <span class="strong strong"><strong>Policies</strong></span> page and click the run icon
under the <span class="strong strong"><strong>Actions</strong></span> column. You can also use the
<a class="xref" href="slm-api-execute-lifecycle.html" title="Execute snapshot lifecycle policy API">execute SLM policy API</a>.</p>
<a id="9b09ad677a0f4331830bed254a8388d1"></a>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST _slm/policy/nightly-snapshots/_execute</pre>
</div>
<div class="console_widget" data-snippet="snippets/1547.console"></div>
<p>The snapshot process runs in the background. To monitor its progress, see
<a class="xref" href="snapshots-take-snapshot.html#monitor-snapshot" title="Monitor a snapshot">Monitor a snapshot</a>.</p>
<h4><a id="slm-retention-task"></a>SLM retention<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/snapshot-restore/take-snapshot.asciidoc">edit</a></h4>
<p>SLM snapshot retention is a cluster-level task that runs separately from
a policy&#8217;s snapshot schedule. To control when the SLM retention task
runs, configure the <a class="xref" href="snapshot-settings.html#slm-retention-schedule"><code class="literal">slm.retention_schedule</code></a> cluster
setting.</p>
<a id="a735081e715d385b4d471eea0f2b57da"></a>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">PUT _cluster/settings
{
  "persistent" : {
    "slm.retention_schedule" : "0 30 1 * * ?"
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/1548.console"></div>
<p>To immediately run the retention task, use the
<a class="xref" href="slm-api-execute-retention.html" title="Execute snapshot retention policy API">execute SLM retention policy API</a>.</p>
<a id="6d48f83c4a36d0544d876d3eff48dcef"></a>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST _slm/_execute_retention</pre>
</div>
<div class="console_widget" data-snippet="snippets/1549.console"></div>
<p>An SLM policy&#8217;s retention rules only apply to snapshots created using the
policy. Other snapshots don&#8217;t count toward the policy&#8217;s retention limits.</p>
<h3><a id="manually-create-snapshot"></a>Manually create a snapshot<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/snapshot-restore/take-snapshot.asciidoc">edit</a></h3>
<p>To take a snapshot without an SLM policy, use the
<a class="xref" href="create-snapshot-api.html" title="Create snapshot API">create snapshot API</a>. The snapshot name supports
<a class="xref" href="api-conventions.html#api-date-math-index-names" title="Date math support in index and index alias names">date math</a>.</p>
<a id="ae0d20c2ebb59278e08a26c9634d90c9"></a>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console"># PUT _snapshot/my_repository/&lt;my_snapshot_{now/d}&gt;
PUT _snapshot/my_repository/%3Cmy_snapshot_%7Bnow%2Fd%7D%3E</pre>
</div>
<div class="console_widget" data-snippet="snippets/1550.console"></div>
<p>Depending on its size, a snapshot can take a while to complete. By default,
the create snapshot API only initiates the snapshot process, which runs in the
background. To block the client until the snapshot finishes, set the
<code class="literal">wait_for_completion</code> query parameter to <code class="literal">true</code>.</p>
<a id="12cb446446211f95f651e196a1f059b4"></a>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">PUT _snapshot/my_repository/my_snapshot?wait_for_completion=true</pre>
</div>
<div class="console_widget" data-snippet="snippets/1551.console"></div>
<p>You can also clone an existing snapshot using <a class="xref" href="clone-snapshot-api.html" title="Clone snapshot API">clone
snapshot API</a>.</p>
<h3><a id="monitor-snapshot"></a>Monitor a snapshot<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/snapshot-restore/take-snapshot.asciidoc">edit</a></h3>
<p>To monitor any currently running snapshots, use the <a class="xref" href="get-snapshot-api.html" title="Get snapshot API">get
snapshot API</a> with the <code class="literal">_current</code> request path parameter.</p>
<a id="b9a8f39ab9b1ed18c6c1db61ac4e6a9e"></a>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET _snapshot/my_repository/_current</pre>
</div>
<div class="console_widget" data-snippet="snippets/1552.console"></div>
<p>To get a complete breakdown of each shard participating in any currently running
snapshots, use the <a class="xref" href="get-snapshot-api.html" title="Get snapshot API">get snapshot status API</a>.</p>
<a id="2105f2d1d81977054a93163a175793ce"></a>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET _snapshot/_status</pre>
</div>
<div class="console_widget" data-snippet="snippets/1553.console"></div>
<h4><a id="check-slm-history"></a>Check SLM history<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/snapshot-restore/take-snapshot.asciidoc">edit</a></h4>
<p>Use the <a class="xref" href="slm-api-get-policy.html" title="Get snapshot lifecycle policy API">get SLM policy API</a> to check when an
SLM policy last successfully started the snapshot process. However,
successfully starting the snapshot process doesn&#8217;t guarantee the snapshot
completed.</p>
<a id="5e87dd38ac3a0fd59ad794005b16d13e"></a>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET _slm/policy/nightly-snapshots</pre>
</div>
<div class="console_widget" data-snippet="snippets/1554.console"></div>
<p>To get more information about a cluster&#8217;s SLM execution history,
including stats for each SLM policy, use the <a class="xref" href="slm-api-get-stats.html" title="Get snapshot lifecycle stats API">get
SLM stats API</a>. The API also returns information about the cluster&#8217;s
snapshot retention task history.</p>
<a id="ce0a1aba713b0448b0c6a504af7b3a08"></a>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET _slm/stats</pre>
</div>
<div class="console_widget" data-snippet="snippets/1555.console"></div>
<h3><a id="delete-snapshot"></a>Delete or cancel a snapshot<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/snapshot-restore/take-snapshot.asciidoc">edit</a></h3>
<p>To delete a snapshot in Kibana, go to the <span class="strong strong"><strong>Snapshots</strong></span> page and click the trash
icon under the <span class="strong strong"><strong>Actions</strong></span> column. You can also use the
<a class="xref" href="delete-snapshot-api.html" title="Delete snapshot API">delete snapshot API</a>.</p>
<a id="bb792e64a4c1f872296073b457aa03c8"></a>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">DELETE _snapshot/my_repository/my_snapshot_2099.05.06</pre>
</div>
<div class="console_widget" data-snippet="snippets/1556.console"></div>
<p>If you delete a snapshot that&#8217;s in progress, Elasticsearch cancels it. The snapshot
process halts and deletes any files created for the snapshot. Deleting a
snapshot doesn&#8217;t delete files used by other snapshots.</p>
<h3><a id="back-up-config-files"></a>Back up configuration files<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/snapshot-restore/take-snapshot.asciidoc">edit</a></h3>
<p>In addition to snapshots, we recommend that you take regular backups of the
files in each node&#8217;s <code class="literal">$ES_PATH_CONF</code> directory using the file backup software of
your choice. Snapshots don&#8217;t back up these files.</p>
<p>Depending on your setup, some of these configuration files may contain sensitive
data, such as passwords or keys. If so, consider encrypting your file backups.</p>
<h3><a id="cluster-state-snapshots"></a>Dedicated cluster state snapshots<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/snapshot-restore/take-snapshot.asciidoc">edit</a></h3>
<p>By default, a snapshot includes all system indices. Some of these system indices
contain sensitive data. For example, the <code class="literal">.security-*</code> system indices may
contain user names and encrypted password hashes.</p>
<p>To better protect this data, consider creating a dedicated repository and
SLM policy for snapshots of the cluster state. This lets you strictly
limit and audit access to the repository.</p>
<p>For example, the following SLM policy only backs up the cluster state
and system indices. The policy stores these snapshots in a dedicated repository.</p>
<a id="80ec12887a3bfa68bfab293a07df71c8"></a>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">PUT _slm/policy/nightly-cluster-state-snapshots
{
  "schedule": "0 30 2 * * ?",
  "name": "&lt;nightly-cluster-state-snap-{now/d}&gt;",
  "repository": "my_secure_repository",
  "config": {
    "include_global_state": true,                 <a id="CO513-1"></a><i class="conum" data-value="1"></i>
    "indices": [ "-*" ]                           <a id="CO513-2"></a><i class="conum" data-value="2"></i>
  },
  "retention": {
    "expire_after": "30d",
    "min_count": 5,
    "max_count": 50
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/1557.console"></div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO513-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Includes the cluster state and system indices.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO513-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>Excludes regular data streams and indices.</p>
</td>
</tr>
</table>
</div>
<p>If you take dedicated snapshots of the cluster state, you&#8217;ll need to exclude the
cluster state and system indices from your other snapshots. For example:</p>
<a id="ab79984629da03951293752e12e7a8b8"></a>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">PUT _slm/policy/nightly-snapshots
{
  "schedule": "0 30 2 * * ?",
  "name": "&lt;nightly-snap-{now/d}&gt;",
  "repository": "my_repository",
  "config": {
    "include_global_state": false,    <a id="CO514-1"></a><i class="conum" data-value="1"></i>
    "indices": [ "*,-.*" ]            <a id="CO514-2"></a><i class="conum" data-value="2"></i>
  },
  "retention": {
    "expire_after": "30d",
    "min_count": 5,
    "max_count": 50
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/1558.console"></div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO514-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Excludes the cluster state.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO514-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>Includes all data streams and indices except system indices and other
indices that begin with a dot (<code class="literal">.</code>).</p>
</td>
</tr>
</table>
</div>
</div>
<div class="navfooter">
<span class="prev">
<a href="snapshots-register-repository.html">« Register a snapshot repository</a>
</span>
<span class="next">
<a href="snapshots-restore-snapshot.html">Restore a snapshot »</a>
</span>
</div>
</div>

                  <!-- end body -->
                </div>
                <div class="col-xs-12 col-sm-4 col-md-4" id="right_col">
                  <div id="rtpcontainer" style="display: block;">
                    <div class="mktg-promo">
                      <h3>Most Popular</h3>
                      <ul class="icons">
                        <li class="icon-elasticsearch-white"><a href="https://www.elastic.co/webinars/getting-started-elasticsearch?baymax=default&elektra=docs&storm=top-video">Get Started with Elasticsearch: Video</a></li>
                        <li class="icon-kibana-white"><a href="https://www.elastic.co/webinars/getting-started-kibana?baymax=default&elektra=docs&storm=top-video">Intro to Kibana: Video</a></li>
                        <li class="icon-logstash-white"><a href="https://www.elastic.co/webinars/introduction-elk-stack?baymax=default&elektra=docs&storm=top-video">ELK for Logs & Metrics: Video</a></li>
                      </ul>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

        </div>


<div id='elastic-footer'></div>
<script src='https://www.elastic.co/elastic-footer.js'></script>
<!-- Footer Section end-->

      </section>
    </div>

<script type="text/javascript">
	var suggestionsUrl = "https://search.elastic.co/suggest";
	var localeUrl = '{"relative_url_prefix":"/","code":"en-us","display_code":"en-us","url":"/guide_template"}';
</script>
<script src="/static/js/swiftype_app_search.umd.min.js"></script>
<script src="/guide/static/jquery.js"></script>
<script type="text/javascript" src="/guide/static/docs.js"></script>
<script type="text/javascript">
  window.initial_state = {"alternatives":{"console":{"php":{"hasAny":true},"csharp":{"hasAny":true},"python":{"hasAny":true},"ruby":{"hasAny":true},"go":{"hasAny":true},"js":{"hasAny":true}}}}</script>
  </body>
</html>
