<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Search Applications example search templates | Enterprise Search documentation [8.8] | Elastic</title>
<meta class="elastic" name="content" content="Search Applications example search templates | Enterprise Search documentation [8.8]">

<link rel="home" href="index.html" title="Enterprise Search documentation [8.8]"/>
<link rel="up" href="search-applications.html" title="Elastic Search Applications"/>
<link rel="prev" href="search-applications-search.html" title="Setting up and searching search applications"/>
<link rel="next" href="server.html" title="Elastic Enterprise Search server"/>
<meta class="elastic" name="product_version" content="8.8"/>
<meta class="elastic" name="product_name" content="Enterprise Search"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Enterprise Search/Guide/8.8"/>
<meta name="DC.subject" content="Enterprise Search"/>
<meta name="DC.identifier" content="8.8"/>
</head>
<body><div class="page_header">
You are looking at preliminary documentation for a future release.
Not what you want? See the
<a href="../current/index.html">current release documentation</a>.
</div>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link">
<div id="related-products" class="dropdown">
<div class="related-products-title"></div>
<div class="dropdown-anchor" tabindex="0">Enterprise Search<span class="dropdown-icon"></span></div>
<div class="dropdown-content">
<ul>
<li class="dropdown-category">Enterprise Search guides</li>
<ul>
<li><a href="/guide/en/enterprise-search/current/index.html" target="_blank">Enterprise Search</a></li>
<li><a href="/guide/en/app-search/current/index.html" target="_blank">App Search</a></li>
<li><a href="/guide/en/workplace-search/current/index.html" target="_blank">Workplace Search</a></li>
</ul>
<li class="dropdown-category">Programming language clients</li>
<ul>
<li><a href="https://www.elastic.co/guide/en/enterprise-search-clients/enterprise-search-node/current/index.html" target="_blank">Node.js client</a></li>
<li><a href="https://www.elastic.co/guide/en/enterprise-search-clients/php/current/index.html" target="_blank">PHP client</a></li>
<li><a href="https://www.elastic.co/guide/en/enterprise-search-clients/python/current/index.html" target="_blank">Python client</a></li>
<li><a href="https://www.elastic.co/guide/en/enterprise-search-clients/ruby/current/index.html" target="_blank">Ruby client</a></li>
</ul>
</ul>
</div>
</div>
</span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="search-applications.html">Elastic Search Applications</a></span>
</div>
<div class="navheader">
<span class="prev">
<a href="search-applications-search.html">« Setting up and searching search applications</a>
</span>
<span class="next">
<a href="server.html">Elastic Enterprise Search server »</a>
</span>
</div>
<div class="chapter">
<div class="titlepage"><div><div>
<h2 class="title"><a id="search-applications-templates"></a>Search Applications example search templates<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/enterprise-search-pubs/edit/8.8/enterprise-search-docs/search-applications-template-examples.asciidoc">edit</a></h2>
</div></div></div>

<h3><a id="search-applications-search-template-prerequisites"></a>Availability and prerequisites<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/enterprise-search-pubs/edit/8.8/enterprise-search-docs/search-applications-template-examples.asciidoc">edit</a></h3>
<p>Search applications were introduced in Elastic version <span class="strong strong"><strong>8.8.0</strong></span>.</p>
<p>Search applications are a tech preview feature.
Tech preview features are subject to change and are not covered by the support SLA of generally available (GA) features.
Elastic plans to promote this feature to GA in a future release.</p>
<p>Search applications are available to all <span class="strong strong"><strong>Elastic Cloud</strong></span> deployments.</p>
<p>Search applications are also available to <span class="strong strong"><strong>self-managed</strong></span> deployments when the <a class="xref" href="license-management.html" title="Elastic subscription">subscription</a> requirements are satisfied.
View the requirements for this feature under the <span class="strong strong"><strong>Elastic Enterprise Search</strong></span> section of the <a href="/subscriptions" class="ulink" target="_blank" rel="noopener">Elastic Stack subscriptions</a> page.</p>
<h3><a id="search-applications-search-templates"></a>Search Applications with templates<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/enterprise-search-pubs/edit/8.8/enterprise-search-docs/search-applications-template-examples.asciidoc">edit</a></h3>
<p><a class="xref" href="search-applications.html" title="Elastic Search Applications">Search applications</a> use templates to perform searches.
Using templates allows us to reduce complexity by exposing only the template parameters, but harness the full power of Elasticsearch&#8217;s query DSL for formulating queries.
Templates are defined when creating a search application, and can be customized for the needs of a search application.</p>
<p>If no template is provided when creating a search application, a minimal search template is applied that implements a simple search use case.
This template can be edited or updated at any time using the <a href="/guide/en/elasticsearch/reference/8.8/put-search-application.html" class="ulink" target="_top">PUT search application</a> API call.</p>
<p>This document provides some sample templates to get you started using <a class="xref" href="search-applications.html" title="Elastic Search Applications">search applications</a> for more advanced cases.
These templates are designed to be easily modified to meet your needs.
Once you&#8217;ve created a search application with a template, you can <a class="xref" href="search-applications-templates.html#search-applications-search-templates" title="Search Applications with templates">search</a> your search application using this template.</p>
<h3><a id="search-applications-templates-default-template"></a>Default template example<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/enterprise-search-pubs/edit/8.8/enterprise-search-docs/search-applications-template-examples.asciidoc">edit</a></h3>
<p>As described in the <a class="xref" href="search-applications-search.html" title="Setting up and searching search applications">Search applications search overview</a>, the default template created for a search application is very minimal:</p>
<div class="pre_wrapper lang-json">
<pre class="programlisting prettyprint lang-json">{
  "template": {
    "script": {
      "source": {
        "query": {
          "query_string": {
            "query": "{{query_string}}",
            "default_field": "{{default_field}}"
          }
        }
      },
      "params": {
        "query_string": "*",
        "default_field": "*"
      }
    }
  }
}</pre>
</div>
<p>This may be useful for initial exploration of search templates, but you&#8217;ll likely want to update this.
* A call to <code class="literal">/_application/search_application/&lt;your_search_application&gt;</code> with no parameters will return all results, in a similar manner to a parameterless call to <code class="literal">/_search</code>.
* Searching with the <code class="literal">query_string</code> and/or <code class="literal">default_field</code> parameters will perform a <a href="/guide/en/elasticsearch/reference/8.8/query-dsl-query-string-query.html" class="ulink" target="_top">query_string</a> query.
* This template does not support additional parameters, including <code class="literal">from</code>, <code class="literal">size</code> or <code class="literal">boost</code>.</p>
<p>Try some of the other examples in this document to experiment with specific use cases, or try creating your own!</p>
<h3><a id="search-applications-templates-bm25-template"></a>Text search example<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/enterprise-search-pubs/edit/8.8/enterprise-search-docs/search-applications-template-examples.asciidoc">edit</a></h3>
<p>The following template supports a multi_match search over specified fields and boosts:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">PUT _application/search_application/my_search_application
{
  "indices": ["my_index1", "my_index2"],
  "template": {
    "script": {
      "lang": "mustache",
      "source": """
      {
        "query": {
          {
            "multi_match": {
              "query": "{{query_string}}",
              "fields": [{{#text_fields}}"{{name}}^{{boost}}"{{^last}},{{/last}}{{/text_fields}}],
              "boost": "{{text_query_boost}}"
            }
          }
        },
        "explain": "{{explain}}",
        "from": "{{from}}",
        "size": "{{size}}"
      }
      """,
      "params": {
        "query_string": "*",
        "text_fields": [
          {"name": "title", "boost": 10, "last": false},
          {"name": "description", "boost": 5, "last": false}
          ],
        "explain": false,
        "from": 0,
        "size": 10
      }
    }
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/22.console"></div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>Currently, Elasticsearch templates created with mustache run into issues when creating comma-delimited lists of arrays.
This is due to the fact that appending values with <code class="literal">,</code> ends with a trailing comma which is invalid JSON.
The above template provides a workaround, defining the last item in the array so we don&#8217;t add a trailing comma.
We plan to improve this experience in the future.</p>
</div>
</div>
<p>A search query using this template might look like this:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST _application/search_application/my_search_application/_search
{
  "params": {
    "size": 5,
    "query_string": "mountain climbing",
    "text_fields": [
          {"name": "title", "boost": 10, "last": false},
          {"name": "description", "boost": 2, "last": false},
          {"name": "state", "boost": 1, "last": true}
     ]
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/23.console"></div>
<p>The <code class="literal">text_fields</code> parameters can be overridden with new/different fields and boosts to experiment with the best configuration for your use case. This template also supports pagination and <code class="literal">explain</code> via parameters.</p>
<h3><a id="search-applications-templates-catchall-template"></a>Text search + ELSER<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/enterprise-search-pubs/edit/8.8/enterprise-search-docs/search-applications-template-examples.asciidoc">edit</a></h3>
<p>The Elastic Learned Sparse EncodeR (<a href="/guide/en/machine-learning/8.8/ml-nlp-elser.html" class="ulink" target="_top">ELSER</a>) improves search relevance by performing text-expansion to return more relevant search results.
This experimental template requires ELSER to be enabled for one or more fields.
See <a href="/guide/en/enterprise-search/8.8/document-enrichment.html" class="ulink" target="_top">https://www.elastic.co/guide/en/enterprise-search/8.8/document-enrichment.html</a> for more information on how to set up machine learning pipelines.
In this case, ELSER is enabled on the <code class="literal">title</code> and <code class="literal">description</code> fields.</p>
<p>This example provides a single template that you can use for various search application scenarios: text search, ELSER, or all of the above.
It also provides a simple default <code class="literal">query_string</code> query if no parameters are specified.</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">PUT _application/search_application/my_search_application
{
  "indices": [
    "my_index1",
    "my_index2"
  ],
  "template": {
    "script": {
      "lang": "mustache",
      "source": """
      {
        "query": {
          "bool": {
            "should": [
              {{#text}}
              {
                "multi_match": {
                  "query": "{{query_string}}",
                  "fields": [{{#text_fields}}"{{name}}^{{boost}}"{{^last}},{{/last}}{{/text_fields}}],
                  "boost": "{{text_query_boost}}"
                }
              },
              {{/text}}
              {{#elser}}
              {{#elser_fields}}
              {
                "text_expansion": {
                  "ml.inference.{{name}}_expanded.predicted_value": {
                    "model_text": "{{query_string}}",
                    "model_id": "elser",
                    "boost": "{{boost}}"
                  }
                }
              },
              {{/elser_fields}}
              { "bool": { "must": [] } },
              {{/elser}}
              {{^text}}
              {{^elser}}
              {
                "query_string": {
                  "query": "{{query_string}}",
                  "default_field": "{{default_field}}",
                  "default_operator": "{{default_operator}}",
                  "boost": "{{text_query_boost}}"
                }
              },
              {{/elser}}
              {{/text}}
              { "bool": { "must": [] } }
              ],
            "minimum_should_match": 1
          }
        },
        "min_score": "{{min_score}}",
        "explain": "{{explain}}",
        "from": "{{from}}",
        "size": "{{size}}"
      }
      """,
      "params": {
        "text": false,
        "elser": false,
        "elser_fields": [
          {"name": "title", "boost": 1},
          {"name": "description", "boost": 1}
        ],
        "text_fields": [
          {"name": "title", "boost": 10, "last": false},
          {"name": "description", "boost": 5, "last": false},
          {"name": "state", "boost": 1, "last": true}
        ],
        "query_string": "*",
        "text_query_boost": 4,
        "default_field": "*",
        "default_operator": "OR",
        "explain": false,
        "from": 0,
        "size": 10,
        "min_score": 0
      }
    }
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/24.console"></div>
<p>A text search query using this template might look like this:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST _application/search_application/my_search_application/_search
{
  "params": {
    "text": true,
    "size": 5,
    "query_string": "mountain climbing",
    "text_fields": [
          {"name": "title", "boost": 10, "last": false},
          {"name": "description", "boost": 5, "last": false},
          {"name": "state", "boost": 1, "last": true}
     ]
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/25.console"></div>
<p>An ELSER search query using this template may look like:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST _application/search_application/my_search_application/_search
{
  "params": {
    "elser": true,
    "query_string": "where is the best mountain climbing?",
    "elser_fields": [
      {"name": "title", "boost": 1},
      {"name": "description", "boost": 1}
    ]
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/26.console"></div>
<p>A combined text search and ELSER search query using this template may look like:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST _application/search_application/my_search_application/_search
{
  "params": {
    "elser": true,
    "text": true,
    "query_string": "where is the best mountain climbing?",
    "elser_fields": [
      {"name": "title", "boost": 1},
      {"name": "description", "boost": 1}
    ],
    "text_query_boost": 4,
    "min_score": 10
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/27.console"></div>
<div class="tip admon">
<div class="icon"></div>
<div class="admon_content">
<p>Text search results and ELSER search results are expected to have significantly different scores in some cases, which makes ranking challenging.
To find the best search result mix for your dataset, we suggest experimenting with the boost values provided in the example template:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">text_query_boost</code> to boost the BM25 query as a whole
</li>
<li class="listitem">
<a href="/guide/en/elasticsearch/reference/8.8/query-dsl-query-string-query.html#_boosting" class="ulink" target="_top"><code class="literal">boost</code></a> fields to boost individual text search fields
</li>
<li class="listitem">
<a href="/guide/en/elasticsearch/reference/8.8/search-search.html#search-api-min-score" class="ulink" target="_top"><code class="literal">min_score</code></a> to omit significantly low confidence results.
</li>
</ul>
</div>
<p>The above boosts should be sufficient for many use cases, but there are cases when adding a <a href="/guide/en/elasticsearch/reference/8.8/filter-search-results.html#rescore" class="ulink" target="_top">rescore</a> query or <a href="/guide/en/elasticsearch/reference/8.8/search-multiple-indices.html#index-boost" class="ulink" target="_top">indices boost</a> to your template may be beneficial.
Remember to update your search application to use the new template using the <a href="/guide/en/elasticsearch/reference/8.8/put-search-application.html" class="ulink" target="_top">put search application command</a>.</p>
</div>
</div>
<p>Finally, a parameterless search using this template would fall back to a default search returning all documents:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST _application/search_application/my_search_application/_search</pre>
</div>
<div class="console_widget" data-snippet="snippets/28.console"></div>
<h3><a id="search-applications-templates-elser-template"></a>ELSER search<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/enterprise-search-pubs/edit/8.8/enterprise-search-docs/search-applications-template-examples.asciidoc">edit</a></h3>
<p>This example supports a streamlined version of ELSER search.</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">PUT _application/search_application/my_search_application
{
  "indices": [
    "my_index1",
    "my_index2"
    ],
    "template": {
      "script": {
        "lang": "mustache",
        "source": """
        {
          "query": {
            "bool": {
              "should": [
                {{#elser_fields}}
                {
                  "text_expansion": {
                    "ml.inference.{{name}}_expanded.predicted_value": {
                      "model_text": "{{query_string}}",
                      "model_id": "&lt;elser_model_id&gt;"
                    }
                  }
                }
                {{^last}},{{/last}}
                {{/elser_fields}}
                ]
            }
          },
          "min_score": "{{min_score}}"
        }
        """,
        "params": {
          "query_string": "*",
          "min_score": "10",
          "elser_fields": [
            {
              "name": "title",
              "last": false
            },
            {
              "name": "description",
              "last": true
            }
            ]
        }
      }
    }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/29.console"></div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>Replace <code class="literal">&lt;elser_model_id&gt;</code> with the model ID of your ELSER deployment.</p>
</div>
</div>
<p>A sample query for this template may look like:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST _application/search_application/my_search_application/_search
  {
    "params": {
      "query_string": "Where is the best place for mountain climbing?"
    }
  }</pre>
</div>
<div class="console_widget" data-snippet="snippets/30.console"></div>
<h3><a id="search-applications-knn-template"></a>kNN search<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/enterprise-search-pubs/edit/8.8/enterprise-search-docs/search-applications-template-examples.asciidoc">edit</a></h3>
<p>This example supports <a href="/guide/en/elasticsearch/reference/8.8/knn-search.html" class="ulink" target="_top">kNN</a> search.</p>
<p>A template supporting exact kNN search may look like:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">PUT _application/search_application/my_search_application
{
  "indices": [
    "my_product_index"
  ],
  "template": {
    "script": {
      "lang": "mustache",
      "source": """
        {
          "query": {
            "script_score": {
              "query": {
                "bool": {
                  "filter": {
                    "range": {
                      "{{field}}": {
                        "{{operator}}": {{value}}
                      }
                    }
                  }
                }
              },
              "script": {
                "source": "cosineSimilarity({{#toJson}}query_vector{{/toJson}}, '{{dense_vector_field}}') + 1.0"
              }
            }
          }
        }
        """,
      "params": {
        "field": "price",
        "operator": "gte",
        "value": 1000,
        "dense_vector_field": "product-vector",
        "query_vector": []
      }
    }
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/31.console"></div>
<p>A search query using this template may look like:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST _application/search_application/my_search_application/_search
{
  "params": {
    "field": "price",
    "operator": "gte",
    "value": 500
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/32.console"></div>
<p>A template supporting approximate kNN search may look like:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">PUT _application/search_application/my_search_application
{
  "indices": [
    "my_product_index"
  ],
  "template": {
    "script": {
      "lang": "mustache",
      "source": """
      {
          "knn": {
            "field": "{{knn_field}}",
            "query_vector": {{#toJson}}query_vector{{/toJson}},
            "k": "{{k}}",
            "num_candidates": {{num_candidates}}
          },
          "fields": {{#toJson}}fields{{/toJson}}
      }
      """,
      "params": {
        "knn_field": "image-vector",
        "query_vector": [],
        "k": 10,
        "num_candidates": 100,
        "fields": ["title", "file-type"]
      }
    }
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/33.console"></div>
<p>A search query using this template may look like:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST _application/search_application/my_search_application/_search
{
  "params": {
    "knn_field": "image-vector",
        "query_vector": [-5, 9, -12],
        "k": 10,
        "num_candidates": 100,
        "fields": ["title", "file-type"]
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/34.console"></div>
</div>
<div class="navfooter">
<span class="prev">
<a href="search-applications-search.html">« Setting up and searching search applications</a>
</span>
<span class="next">
<a href="server.html">Elastic Enterprise Search server »</a>
</span>
</div>
</div>
</body>
</html>
