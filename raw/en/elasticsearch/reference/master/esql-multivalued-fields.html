<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>ES|QL multivalued fields | Elasticsearch Guide [master] | Elastic</title>
<meta class="elastic" name="content" content="ES|QL multivalued fields | Elasticsearch Guide [master]">

<link rel="home" href="index.html" title="Elasticsearch Guide [master]"/>
<link rel="up" href="esql.html" title="ES|QL"/>
<link rel="prev" href="esql-agg-sum.html" title="SUM"/>
<link rel="next" href="esql-metadata-fields.html" title="ES|QL metadata fields"/>
<meta class="elastic" name="product_version" content="master"/>
<meta class="elastic" name="product_name" content="Elasticsearch"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Elasticsearch/Reference/master"/>
<meta name="DC.subject" content="Elasticsearch"/>
<meta name="DC.identifier" content="master"/>
<meta name="robots" content="noindex,nofollow"/>
</head>
<body><div class="page_header">
You are looking at preliminary documentation for a future release.
Not what you want? See the
<a href="../current/index.html">current release documentation</a>.
</div>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elasticsearch Guide [master]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="esql.html">ES|QL</a></span>
</div>
<div class="navheader">
<span class="prev">
<a href="esql-agg-sum.html">« <code class="literal">SUM</code></a>
</span>
<span class="next">
<a href="esql-metadata-fields.html">ES|QL metadata fields »</a>
</span>
</div>
<div class="chapter">
<div class="titlepage"><div><div>
<h2 class="title"><a id="esql-multivalued-fields"></a>ES|QL multivalued fields<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/esql/multivalued-fields.asciidoc">edit</a></h2>
</div></div></div>

<p>ES|QL is fine reading from multivalued fields:</p>
<a id="fec29089fbd819b7d2f2a65ec8780754"></a>
<a id="esql-multivalued-fields-reorders"></a><div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST /mv/_bulk?refresh
{ "index" : {} }
{ "a": 1, "b": [2, 1] }
{ "index" : {} }
{ "a": 2, "b": 3 }

POST /_query
{
  "query": "FROM mv"
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/1566.console"></div>
<p>Multivalued fields come back as a JSON array:</p>
<a id="4e812acbde123f9e68476d04455d5342"></a>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
  "columns": [
    { "name": "a", "type": "long"},
    { "name": "b", "type": "long"}
  ],
  "values": [
    [1, [1, 2]],
    [2,      3]
  ]
}</pre>
</div>
<p>The relative order of values in a multivalued field is undefined. They&#8217;ll frequently be in
ascending order but don&#8217;t rely on that.</p>
<h4><a id="esql-multivalued-fields-dups"></a>Duplicate values<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/esql/multivalued-fields.asciidoc">edit</a></h4>
<p>Some field types, like <a class="xref" href="keyword.html#keyword-field-type" title="Keyword field type"><code class="literal">keyword</code></a> remove duplicate values on write:</p>
<a id="f0136cf5b116ac5005f453562d0cc6c9"></a>
<a id="esql-multivalued-fields-kwdups"></a><div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">PUT /mv
{
  "mappings": {
    "properties": {
      "b": {"type": "keyword"}
    }
  }
}

POST /mv/_bulk?refresh
{ "index" : {} }
{ "a": 1, "b": ["foo", "foo", "bar"] }
{ "index" : {} }
{ "a": 2, "b": ["bar", "bar"] }

POST /_query
{
  "query": "FROM mv"
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/1567.console"></div>
<p>And ES|QL sees that removal:</p>
<a id="11db6cc75fa0cf3cc43b9dee0c492f83"></a>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
  "columns": [
    { "name": "a", "type": "long"},
    { "name": "b", "type": "keyword"}
  ],
  "values": [
    [1, ["bar", "foo"]],
    [2,          "bar"]
  ]
}</pre>
</div>
<p>But other types, like <code class="literal">long</code> don&#8217;t remove duplicates.</p>
<a id="392988edb72cc0c65ec7c5d20830b3d9"></a>
<a id="esql-multivalued-fields-longdups"></a><div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">PUT /mv
{
  "mappings": {
    "properties": {
      "b": {"type": "long"}
    }
  }
}

POST /mv/_bulk?refresh
{ "index" : {} }
{ "a": 1, "b": [2, 2, 1] }
{ "index" : {} }
{ "a": 2, "b": [1, 1] }

POST /_query
{
  "query": "FROM mv"
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/1568.console"></div>
<p>And ES|QL also sees that:</p>
<a id="961caf983a2ea0c8c1f8f1766e3bf653"></a>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
  "columns": [
    { "name": "a", "type": "long"},
    { "name": "b", "type": "long"}
  ],
  "values": [
    [1, [1, 2, 2]],
    [2,    [1, 1]]
  ]
}</pre>
</div>
<p>This is all at the storage layer. If you store duplicate `long`s and then
convert them to strings the duplicates will stay:</p>
<a id="3af39569bf24a802ed7a3648c3e35fc3"></a>
<a id="esql-multivalued-fields-longdups-tostring"></a><div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">PUT /mv
{
  "mappings": {
    "properties": {
      "b": {"type": "long"}
    }
  }
}

POST /mv/_bulk?refresh
{ "index" : {} }
{ "a": 1, "b": [2, 2, 1] }
{ "index" : {} }
{ "a": 2, "b": [1, 1] }

POST /_query
{
  "query": "FROM mv | EVAL b=TO_STRING(b)"
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/1569.console"></div>
<a id="b6bf7546f2ab3bb72622a2f8d2fe0cce"></a>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
  "columns": [
    { "name": "a", "type": "long"},
    { "name": "b", "type": "keyword"}
  ],
  "values": [
    [1, ["1", "2", "2"]],
    [2,      ["1", "1"]]
  ]
}</pre>
</div>
<h4><a id="esql-multivalued-fields-functions"></a>Functions<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/esql/multivalued-fields.asciidoc">edit</a></h4>
<p>Unless otherwise documented functions will return <code class="literal">null</code> when applied to a multivalued
field. This behavior may change in a later version.</p>
<a id="df6875e97595f4aa04fdc1ab36554aea"></a>
<a id="esql-multivalued-fields-mv-into-null"></a><div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST /mv/_bulk?refresh
{ "index" : {} }
{ "a": 1, "b": [2, 1] }
{ "index" : {} }
{ "a": 2, "b": 3 }

POST /_query
{
  "query": "FROM mv | EVAL b + 2, a + b"
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/1570.console"></div>
<a id="d4747b3694547b244906247a15b25199"></a>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
  "columns": [
    { "name": "a",   "type": "long"},
    { "name": "b",   "type": "long"},
    { "name": "b+2", "type": "long"},
    { "name": "a+b", "type": "long"}
  ],
  "values": [
    [1, [1, 2], null, null],
    [2,      3,    5,    5]
  ]
}</pre>
</div>
<p>Work around this limitation by converting the field to single value with one of:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a class="xref" href="esql-mv_avg.html" title="MV_AVG"><code class="literal">MV_AVG</code></a>
</li>
<li class="listitem">
<a class="xref" href="esql-mv_concat.html" title="MV_CONCAT"><code class="literal">MV_CONCAT</code></a>
</li>
<li class="listitem">
<a class="xref" href="esql-mv_count.html" title="MV_COUNT"><code class="literal">MV_COUNT</code></a>
</li>
<li class="listitem">
<a class="xref" href="esql-mv_max.html" title="MV_MAX"><code class="literal">MV_MAX</code></a>
</li>
<li class="listitem">
<a class="xref" href="esql-mv_median.html" title="MV_MEDIAN"><code class="literal">MV_MEDIAN</code></a>
</li>
<li class="listitem">
<a class="xref" href="esql-mv_min.html" title="MV_MIN"><code class="literal">MV_MIN</code></a>
</li>
<li class="listitem">
<a class="xref" href="esql-mv_sum.html" title="MV_SUM"><code class="literal">MV_SUM</code></a>
</li>
</ul>
</div>
<a id="912b1410f46e13d1c2cc067b3322b115"></a>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST /_query
{
  "query": "FROM mv | EVAL b=MV_MIN(b) | EVAL b + 2, a + b"
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/1571.console"></div>
<a id="8c1ff884f83f09b3655816a532cb3cf1"></a>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
  "columns": [
    { "name": "a",   "type": "long"},
    { "name": "b",   "type": "long"},
    { "name": "b+2", "type": "long"},
    { "name": "a+b", "type": "long"}
  ],
  "values": [
    [1, 1, 3, 2],
    [2, 3, 5, 5]
  ]
}</pre>
</div>
</div>
<div class="navfooter">
<span class="prev">
<a href="esql-agg-sum.html">« <code class="literal">SUM</code></a>
</span>
<span class="next">
<a href="esql-metadata-fields.html">ES|QL metadata fields »</a>
</span>
</div>
</div>
</body>
</html>
