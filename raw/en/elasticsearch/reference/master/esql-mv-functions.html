<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>ES|QL multivalue functions | Elasticsearch Guide [master] | Elastic</title>
<meta class="elastic" name="content" content="ES|QL multivalue functions | Elasticsearch Guide [master]">

<link rel="home" href="index.html" title="Elasticsearch Guide [master]"/>
<link rel="up" href="esql-functions-operators.html" title="ES|QL functions and operators"/>
<link rel="prev" href="esql-conditional-functions-and-expressions.html" title="ES|QL conditional functions and expressions"/>
<link rel="next" href="esql-operators.html" title="ES|QL operators"/>
<meta class="elastic" name="product_version" content="master"/>
<meta class="elastic" name="product_name" content="Elasticsearch"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Elasticsearch/Reference/master"/>
<meta name="DC.subject" content="Elasticsearch"/>
<meta name="DC.identifier" content="master"/>
<meta name="robots" content="noindex,nofollow"/>
</head>
<body><div class="page_header">
You are looking at preliminary documentation for a future release.
Not what you want? See the
<a href="../current/index.html">current release documentation</a>.
</div>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elasticsearch Guide [master]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="esql.html">ES|QL</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="esql-functions-operators.html">ES|QL functions and operators</a></span>
</div>
<div class="navheader">
<span class="prev">
<a href="esql-conditional-functions-and-expressions.html">« ES|QL conditional functions and expressions</a>
</span>
<span class="next">
<a href="esql-operators.html">ES|QL operators »</a>
</span>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="esql-mv-functions"></a>ES|QL multivalue functions<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/esql/functions/mv-functions.asciidoc">edit</a></h2>
</div></div></div>

<p>ES|QL supports these multivalue functions:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a class="xref" href="esql-mv-functions.html#esql-mv_avg" title="MV_AVG"><code class="literal">MV_AVG</code></a>
</li>
<li class="listitem">
<a class="xref" href="esql-mv-functions.html#esql-mv_concat" title="MV_CONCAT"><code class="literal">MV_CONCAT</code></a>
</li>
<li class="listitem">
<a class="xref" href="esql-mv-functions.html#esql-mv_count" title="MV_COUNT"><code class="literal">MV_COUNT</code></a>
</li>
<li class="listitem">
<a class="xref" href="esql-mv-functions.html#esql-mv_dedupe" title="MV_DEDUPE"><code class="literal">MV_DEDUPE</code></a>
</li>
<li class="listitem">
<a class="xref" href="esql-mv-functions.html#esql-mv_max" title="MV_MAX"><code class="literal">MV_MAX</code></a>
</li>
<li class="listitem">
<a class="xref" href="esql-mv-functions.html#esql-mv_median" title="MV_MEDIAN"><code class="literal">MV_MEDIAN</code></a>
</li>
<li class="listitem">
<a class="xref" href="esql-mv-functions.html#esql-mv_min" title="MV_MIN"><code class="literal">MV_MIN</code></a>
</li>
<li class="listitem">
<a class="xref" href="esql-mv-functions.html#esql-mv_sum" title="MV_SUM"><code class="literal">MV_SUM</code></a>
</li>
</ul>
</div>
<h3><a id="esql-mv_avg"></a><code class="literal">MV_AVG</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/esql/functions/mv_avg.asciidoc">edit</a></h3>
<p>Converts a multivalued field into a single valued field containing the average
of all of the values. For example:</p>
<div class="pre_wrapper lang-esql merge styled">
<pre class="programlisting prettyprint lang-esql merge styled">ROW a=[3, 5, 1, 6]
| EVAL avg_a = MV_AVG(a)</pre>
</div>
<div class="informaltable">
<table border="1" cellpadding="4px" class="monospaced styled">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">a:integer</th>
<th align="left" valign="top">avg_a:double</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p>[3, 5, 1, 6]</p></td>
<td align="left" valign="top"><p>3.75</p></td>
</tr>
</tbody>
</table>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>The output type is always a <code class="literal">double</code> and the input type can be any number.</p>
</div>
</div>
<h3><a id="esql-mv_concat"></a><code class="literal">MV_CONCAT</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/esql/functions/mv_concat.asciidoc">edit</a></h3>
<p>Converts a multivalued string field into a single valued field containing the
concatenation of all values separated by a delimiter:</p>
<div class="pre_wrapper lang-esql merge styled">
<pre class="programlisting prettyprint lang-esql merge styled">ROW a=["foo", "zoo", "bar"]
| EVAL j = MV_CONCAT(a, ", ")</pre>
</div>
<div class="informaltable">
<table border="1" cellpadding="4px" class="monospaced styled">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">a:keyword</th>
<th align="left" valign="top">j:keyword</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p>["foo", "zoo", "bar"]</p></td>
<td align="left" valign="top"><p>"foo, zoo, bar"</p></td>
</tr>
</tbody>
</table>
</div>
<p>If you want to concat non-string fields call <a class="xref" href="esql-type-conversion-functions.html#esql-to_string" title="TO_STRING"><code class="literal">TO_STRING</code></a> on them first:</p>
<div class="pre_wrapper lang-esql merge styled">
<pre class="programlisting prettyprint lang-esql merge styled">ROW a=[10, 9, 8]
| EVAL j = MV_CONCAT(TO_STRING(a), ", ")</pre>
</div>
<div class="informaltable">
<table border="1" cellpadding="4px" class="monospaced styled">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">a:integer</th>
<th align="left" valign="top">j:keyword</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p>[10, 9, 8]</p></td>
<td align="left" valign="top"><p>"10, 9, 8"</p></td>
</tr>
</tbody>
</table>
</div>
<h3><a id="esql-mv_count"></a><code class="literal">MV_COUNT</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/esql/functions/mv_count.asciidoc">edit</a></h3>
<p>Converts a multivalued field into a single valued field containing a count of the number
of values:</p>
<div class="pre_wrapper lang-esql merge styled">
<pre class="programlisting prettyprint lang-esql merge styled">ROW a=["foo", "zoo", "bar"]
| EVAL count_a = MV_COUNT(a)</pre>
</div>
<div class="informaltable">
<table border="1" cellpadding="4px" class="monospaced styled">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">a:keyword</th>
<th align="left" valign="top">count_a:integer</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p>["foo", "zoo", "bar"]</p></td>
<td align="left" valign="top"><p>3</p></td>
</tr>
</tbody>
</table>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>This function accepts all types and always returns an <code class="literal">integer</code>.</p>
</div>
</div>
<h3><a id="esql-mv_dedupe"></a><code class="literal">MV_DEDUPE</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/esql/functions/mv_dedupe.asciidoc">edit</a></h3>
<p>Removes duplicates from a multivalued field. For example:</p>
<div class="pre_wrapper lang-esql merge styled">
<pre class="programlisting prettyprint lang-esql merge styled">ROW a=["foo", "foo", "bar", "foo"]
| EVAL dedupe_a = MV_DEDUPE(a)</pre>
</div>
<div class="informaltable">
<table border="1" cellpadding="4px" class="monospaced styled">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">a:keyword</th>
<th align="left" valign="top">dedupe_a:keyword</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p>["foo", "foo", "bar", "foo"]</p></td>
<td align="left" valign="top"><p>["foo", "bar"]</p></td>
</tr>
</tbody>
</table>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p><code class="literal">MV_DEDUPE</code> may, but won&#8217;t always, sort the values in the field.</p>
</div>
</div>
<h3><a id="esql-mv_max"></a><code class="literal">MV_MAX</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/esql/functions/mv_max.asciidoc">edit</a></h3>
<p>Converts a multivalued field into a single valued field containing the maximum value. For example:</p>
<div class="pre_wrapper lang-esql merge styled">
<pre class="programlisting prettyprint lang-esql merge styled">ROW a=[3, 5, 1]
| EVAL max_a = MV_MAX(a)</pre>
</div>
<div class="informaltable">
<table border="1" cellpadding="4px" class="monospaced styled">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">a:integer</th>
<th align="left" valign="top">max_a:integer</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p>[3, 5, 1]</p></td>
<td align="left" valign="top"><p>5</p></td>
</tr>
</tbody>
</table>
</div>
<p>It can be used by any field type, including <code class="literal">keyword</code> fields. In that case picks the
last string, comparing their utf-8 representation byte by byte:</p>
<div class="pre_wrapper lang-esql merge styled">
<pre class="programlisting prettyprint lang-esql merge styled">ROW a=["foo", "zoo", "bar"]
| EVAL max_a = MV_MAX(a)</pre>
</div>
<div class="informaltable">
<table border="1" cellpadding="4px" class="monospaced styled">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">a:keyword</th>
<th align="left" valign="top">max_a:keyword</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p>["foo", "zoo", "bar"]</p></td>
<td align="left" valign="top"><p>"zoo"</p></td>
</tr>
</tbody>
</table>
</div>
<h3><a id="esql-mv_median"></a><code class="literal">MV_MEDIAN</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/esql/functions/mv_median.asciidoc">edit</a></h3>
<p>Converts a multivalued field into a single valued field containing the median value. For example:</p>
<div class="pre_wrapper lang-esql merge styled">
<pre class="programlisting prettyprint lang-esql merge styled">ROW a=[3, 5, 1]
| EVAL median_a = MV_MEDIAN(a)</pre>
</div>
<div class="informaltable">
<table border="1" cellpadding="4px" class="monospaced styled">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">a:integer</th>
<th align="left" valign="top">median_a:integer</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p>[3, 5, 1]</p></td>
<td align="left" valign="top"><p>3</p></td>
</tr>
</tbody>
</table>
</div>
<p>It can be used by any numeric field type and returns a value of the same type. If the
row has an even number of values for a column the result will be the average of the
middle two entries. If the field is not floating point then the average rounds <span class="strong strong"><strong>down</strong></span>:</p>
<div class="pre_wrapper lang-esql merge styled">
<pre class="programlisting prettyprint lang-esql merge styled">ROW a=[3, 7, 1, 6]
| EVAL median_a = MV_MEDIAN(a)</pre>
</div>
<div class="informaltable">
<table border="1" cellpadding="4px" class="monospaced styled">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">a:integer</th>
<th align="left" valign="top">median_a:integer</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p>[3, 7, 1, 6]</p></td>
<td align="left" valign="top"><p>4</p></td>
</tr>
</tbody>
</table>
</div>
<h3><a id="esql-mv_min"></a><code class="literal">MV_MIN</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/esql/functions/mv_min.asciidoc">edit</a></h3>
<p>Converts a multivalued field into a single valued field containing the minimum value. For example:</p>
<div class="pre_wrapper lang-esql merge styled">
<pre class="programlisting prettyprint lang-esql merge styled">ROW a=[2, 1]
| EVAL min_a = MV_MIN(a)</pre>
</div>
<div class="informaltable">
<table border="1" cellpadding="4px" class="monospaced styled">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">a:integer</th>
<th align="left" valign="top">min_a:integer</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p>[2, 1]</p></td>
<td align="left" valign="top"><p>1</p></td>
</tr>
</tbody>
</table>
</div>
<p>It can be used by any field type, including <code class="literal">keyword</code> fields. In that case picks the
first string, comparing their utf-8 representation byte by byte:</p>
<div class="pre_wrapper lang-esql merge styled">
<pre class="programlisting prettyprint lang-esql merge styled">ROW a=["foo", "bar"]
| EVAL min_a = MV_MIN(a)</pre>
</div>
<div class="informaltable">
<table border="1" cellpadding="4px" class="monospaced styled">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">a:keyword</th>
<th align="left" valign="top">min_a:keyword</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p>["foo", "bar"]</p></td>
<td align="left" valign="top"><p>"bar"</p></td>
</tr>
</tbody>
</table>
</div>
<h3><a id="esql-mv_sum"></a><code class="literal">MV_SUM</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/esql/functions/mv_sum.asciidoc">edit</a></h3>
<p>Converts a multivalued field into a single valued field containing the sum
of all of the values. For example:</p>
<div class="pre_wrapper lang-esql merge styled">
<pre class="programlisting prettyprint lang-esql merge styled">ROW a=[3, 5, 6]
| EVAL sum_a = MV_SUM(a)</pre>
</div>
<div class="informaltable">
<table border="1" cellpadding="4px" class="monospaced styled">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">a:integer</th>
<th align="left" valign="top">sum_a:integer</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p>[3, 5, 6]</p></td>
<td align="left" valign="top"><p>14</p></td>
</tr>
</tbody>
</table>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>The input type can be any number and the output type is the same as the input type.</p>
</div>
</div>
</div>
<div class="navfooter">
<span class="prev">
<a href="esql-conditional-functions-and-expressions.html">« ES|QL conditional functions and expressions</a>
</span>
<span class="next">
<a href="esql-operators.html">ES|QL operators »</a>
</span>
</div>
</div>
</body>
</html>
