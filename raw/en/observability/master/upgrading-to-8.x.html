<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Upgrade to version 8.12.0 | Elastic Observability [master] | Elastic</title>
<meta class="elastic" name="content" content="Upgrade to version 8.12.0 | Elastic Observability [master]">

<link rel="home" href="index.html" title="Elastic Observability [master]"/>
<link rel="up" href="upgrade.html" title="Upgrade"/>
<link rel="prev" href="apm-breaking.html" title="Breaking Changes"/>
<link rel="next" href="upgrade-to-apm-integration.html" title="Switch to the Elastic APM integration"/>
<meta class="elastic" name="product_version" content="master"/>
<meta class="elastic" name="product_name" content="Observability"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Observability/Guide/master"/>
<meta name="DC.subject" content="Observability"/>
<meta name="DC.identifier" content="master"/>
<meta name="robots" content="noindex,nofollow"/>
</head>
<body><div class="page_header">
You are looking at preliminary documentation for a future release.
Not what you want? See the
<a href="../current/index.html">current release documentation</a>.
</div>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elastic Observability [master]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="apm.html">Application performance monitoring (APM)</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="upgrade.html">Upgrade</a></span>
</div>
<div class="navheader">
<span class="prev">
<a href="apm-breaking.html">« Breaking Changes</a>
</span>
<span class="next">
<a href="upgrade-to-apm-integration.html">Switch to the Elastic APM integration »</a>
</span>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="upgrading-to-8.x"></a>Upgrade to version 8.12.0<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/apm-server/upgrading-to-8.x.asciidoc">edit</a></h3>
</div></div></div>
<p>This guide explains the upgrade process for version 8.12.0.
For a detailed look at what&#8217;s new, see:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a href="/guide/en/observability/master/whats-new.html" class="ulink" target="_top">What&#8217;s new in Observability</a>
</li>
<li class="listitem">
<a href="/guide/en/kibana/master/whats-new.html" class="ulink" target="_top">What&#8217;s new in Kibana</a>
</li>
<li class="listitem">
<a href="/guide/en/elasticsearch/reference/master/release-highlights.html" class="ulink" target="_top">Elasticsearch release highlights</a>
</li>
</ul>
</div>
<h4><a id="_notable_apm_changes"></a>Notable APM changes<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/apm-server/upgrading-to-8.x.asciidoc">edit</a></h4>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
All index management has been removed from APM Server;
Fleet is now entirely responsible for setting up index templates, index lifecycle polices,
and index pipelines.
</li>
<li class="listitem">
APM Server now only writes to well-defined data streams;
writing to classic indices is no longer supported.
</li>
<li class="listitem">
APM Server has a new Elasticsearch output implementation with defaults that should be sufficient for
most use cases.
</li>
</ul>
</div>
<p>As a result of the above changes,
a number of index management and index tuning configuration variables have been removed.
See the APM <a class="xref" href="release-notes.html" title="Release notes">release notes</a>, <a class="xref" href="apm-breaking.html" title="Breaking Changes">breaking changes</a> for full details.</p>
<h4><a id="_find_your_upgrade_guide"></a>Find your upgrade guide<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/apm-server/upgrading-to-8.x.asciidoc">edit</a></h4>
<p>Starting in version 7.14, there are two ways to run Elastic APM.
Determine which method you&#8217;re using, then use the links below to find the correct upgrading guide.</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<span class="strong strong"><strong>Standalone</strong></span>: Users in this mode run and configure the APM Server binary.
This mode has been deprecated and will be removed in a future release.
</li>
<li class="listitem">
<span class="strong strong"><strong>Fleet and the APM integration</strong></span>: Users in this mode run and configure Fleet and the Elastic APM integration.
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Self-installation (non-Elastic Cloud users) upgrade guides</strong></span></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a class="xref" href="upgrading-to-8.x.html#upgrade-8.0-self-standalone" title="Upgrade a self-installation of APM Server standalone to 8.12.0">Self-installation standalone</a>
</li>
<li class="listitem">
<a class="xref" href="upgrading-to-8.x.html#upgrade-8.0-self-integration" title="Upgrade a self-installation of the APM integration to 8.12.0">Self-installation APM integration</a>
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Elastic Cloud upgrade guides</strong></span></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a class="xref" href="upgrading-to-8.x.html#upgrade-8.0-cloud-standalone" title="Upgrade Elastic Cloud APM Server standalone to 8.12.0">Elastic Cloud standalone</a>
</li>
<li class="listitem">
<a class="xref" href="upgrading-to-8.x.html#upgrade-8.0-cloud-integration" title="Upgrade Elastic Cloud with the APM integration to 8.0">Elastic Cloud APM integration</a>
</li>
</ul>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="upgrade-8.0-self-standalone"></a>Upgrade a self-installation of APM Server standalone to 8.12.0<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/apm-server/upgrading-to-8.x.asciidoc">edit</a></h4>
</div></div></div>

<p>This upgrade guide is for the standalone method of running APM Server.
Only use this guide if both of the following are true:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
You have a self-installation of the Elastic Stack, i.e. you&#8217;re not using Elastic Cloud.
</li>
<li class="listitem">
You&#8217;re running the APM Server binary, i.e. you haven&#8217;t switched to the Elastic APM integration.
</li>
</ul>
</div>
<h5><a id="_prerequisites_3"></a>Prerequisites<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/apm-server/upgrading-to-8.x.asciidoc">edit</a></h5>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>Prior to upgrading to version 8.12.0, Elasticsearch, Kibana,
and APM Server must be upgraded to version 7.17.</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
To upgrade Elasticsearch and Kibana,
see the <a href="/guide/en/elastic-stack/7.17/upgrading-elastic-stack.html" class="ulink" target="_top">Elastic Stack Installation and Upgrade Guide</a>
</li>
<li class="listitem">
To upgrade APM Server to version 7.17, see
<a href="/guide/en/apm/guide/7.17/upgrading-to-717.html" class="ulink" target="_top">upgrade to version 7.17</a>.
</li>
</ul>
</div>
</li>
<li class="listitem">
Review the APM <a class="xref" href="release-notes.html" title="Release notes">release notes</a>, <a class="xref" href="apm-breaking.html" title="Breaking Changes">breaking changes</a>,
and Observability <a href="/guide/en/observability/master/whats-new.html" class="ulink" target="_top">What&#8217;s new</a> content.
</li>
</ol>
</div>
<h5><a id="_upgrade_steps"></a>Upgrade steps<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/apm-server/upgrading-to-8.x.asciidoc">edit</a></h5>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p><span class="strong strong"><strong>Upgrade the Elastic Stack to version 8.12.0</strong></span></p>
<p>The Elastic Stack (Elasticsearch and Kibana) must be upgraded before APM Server.
See the <a href="/guide/en/elastic-stack/master/upgrading-elastic-stack.html" class="ulink" target="_top">Elastic Stack Installation and Upgrade Guide</a> for guidance.</p>
</li>
<li class="listitem">
<p><span class="strong strong"><strong>Install the APM integration via the Fleet UI</strong></span></p>
<p>Starting in version 8.0.0, Fleet uses the APM integration to set up and manage APM index templates,
ILM policies, and ingest pipelines. APM Server will only send data to Elasticsearch <em>after</em> the APM integration has been installed.</p>
<details open>
<summary class="title"><span class="strong strong"><strong>If you have an internet connection</strong></span></summary>
<div class="content">
<p>An internet connection is required to install the APM integration via the Fleet UI in Kibana.</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Open Kibana and select <span class="strong strong"><strong>Add integrations</strong></span> &gt; <span class="strong strong"><strong>Elastic APM</strong></span>.
</li>
<li class="listitem">
Click <span class="strong strong"><strong>APM integration</strong></span>.
</li>
<li class="listitem">
Click <span class="strong strong"><strong>Add Elastic APM</strong></span>.
</li>
<li class="listitem">
Click <span class="strong strong"><strong>Save and continue</strong></span>.
</li>
<li class="listitem">
Click <span class="strong strong"><strong>Add Elastic Agent later</strong></span>. You do not need to run an Elastic Agent to complete the setup.
</li>
</ol>
</div>
</div>
</details>
<details>
<summary class="title"><span class="strong strong"><strong>If you don&#8217;t have an internet connection</strong></span></summary>
<div class="content">
<p>If your environment has network traffic restrictions, there are other ways to install the APM integration.
See <a href="/guide/en/fleet/master/air-gapped.html" class="ulink" target="_top">Air-gapped environments</a> for more information.</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
Option 1: Update <code class="literal">kibana.yml</code>
</span>
</dt>
<dd>
<p>Update <code class="literal">kibana.yml</code> to include the following, then restart Kibana.</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">xpack.fleet.packages:
- name: apm
  version: latest</pre>
</div>
<p>See <a href="/guide/en/kibana/master/settings.html" class="ulink" target="_top">Configure Kibana</a> to learn more about how to edit the Kibana configuration file.</p>
</dd>
<dt>
<span class="term">
Option 2: Use the Fleet API
</span>
</dt>
<dd>
<p>Use the Fleet API to install the APM integration. To be successful, this needs to be run against the Kibana
API, not the Elasticsearch API.</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">POST kbn:/api/fleet/epm/packages/apm/8.12.0
{ "force": true }</pre>
</div>
<p>See <a href="/guide/en/kibana/master/api.html" class="ulink" target="_top">Kibana API</a> to learn more about how to use the Kibana APIs.</p>
</dd>
</dl>
</div>
</div>
</details>
</li>
<li class="listitem">
<p><span class="strong strong"><strong>Install the 8.12.0 APM Server release</strong></span></p>
<p>See <a class="xref" href="_apm_server_binary.html#installing" title="Step 1: Install">install</a> to find the command that works with your system.</p>
<div class="warning admon">
<div class="icon"></div>
<div class="admon_content">
<p>If you install version 8.12.0 of APM Server before installing the APM integration, you will see error logs similar to the following. You must go back and install the APM integration before data can be ingested into Elasticsearch.</p>
<div class="pre_wrapper lang-json">
<pre class="programlisting prettyprint lang-json">...
{"log.level":"error","@timestamp":"2022-01-19T10:45:34.923+0800","log.logger":"beater","log.origin":{"file.name":"beater/waitready.go","file.line":62},"message":"precondition 'apm integration installed' failed: error querying Elasticsearch for integration index templates: unexpected HTTP status: 404 Not Found ({\"error\":{\"root_cause\":[{\"type\":\"resource_not_found_exception\",\"reason\":\"index template matching [traces-apm.sampled] not found\"}],\"type\":\"resource_not_found_exception\",\"reason\":\"index template matching [traces-apm.sampled] not found\"},\"status\":404}): to remediate, please install the apm integration: https://ela.st/apm-integration-quickstart","service.name":"apm-server","ecs.version":"1.6.0"}
{"log.level":"error","@timestamp":"2022-01-19T10:45:37.461+0800","log.logger":"beater","log.origin":{"file.name":"beater/waitready.go","file.line":62},"message":"precondition 'apm integration installed' failed: error querying Elasticsearch for integration index templates: unexpected HTTP status: 404 Not Found ({\"error\":{\"root_cause\":[{\"type\":\"resource_not_found_exception\",\"reason\":\"index template matching [logs-apm.error] not found\"}],\"type\":\"resource_not_found_exception\",\"reason\":\"index template matching [logs-apm.error] not found\"},\"status\":404}): to remediate, please install the apm integration: https://ela.st/apm-integration-quickstart","service.name":"apm-server","ecs.version":"1.6.0"}
...</pre>
</div>
</div>
</div>
</li>
<li class="listitem">
<p><span class="strong strong"><strong>Review your configuration file</strong></span></p>
<p>Some settings have been removed or changed. You may need to update your <code class="literal">apm-server.yml</code> configuration
file prior to starting the APM Server.
See <a class="xref" href="directory-layout.html" title="Installation layout">Installation layout</a> for help in locating this file,
and <a class="xref" href="configuring-howto-apm-server.html" title="Configure">Configure</a> for a list of all available configuration options.</p>
</li>
<li class="listitem">
<p><span class="strong strong"><strong>Start the APM Server</strong></span></p>
<p>To start the APM Server, run:</p>
<div class="pre_wrapper lang-bash">
<pre class="programlisting prettyprint lang-bash">./apm-server -e</pre>
</div>
<p>Additional details are available in <a class="xref" href="_apm_server_binary.html#apm-server-starting" title="Step 3: Start">start the APM Server</a>.</p>
</li>
<li class="listitem">
<p><span class="strong strong"><strong>(Optional) Upgrade to the APM integration</strong></span></p>
<p>Got time for one more upgrade?
See <a class="xref" href="upgrade-to-apm-integration.html" title="Switch to the Elastic APM integration">Switch to the Elastic APM integration</a>.</p>
</li>
</ol>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="upgrade-8.0-self-integration"></a>Upgrade a self-installation of the APM integration to 8.12.0<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/apm-server/upgrading-to-8.x.asciidoc">edit</a></h4>
</div></div></div>

<p>This upgrade guide is for the Elastic APM integration.
Only use this guide if both of the following are true:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
You have a self-installation of the Elastic Stack, i.e. you&#8217;re not using Elastic Cloud.
</li>
<li class="listitem">
You have already switched to and are running Fleet and the Elastic APM integration.
</li>
</ul>
</div>
<h5><a id="_prerequisites_4"></a>Prerequisites<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/apm-server/upgrading-to-8.x.asciidoc">edit</a></h5>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Prior to upgrading to version 8.12.0, Elasticsearch, and Kibana
must be upgraded to version 7.17. To upgrade Elasticsearch and Kibana,
see the <a href="/guide/en/elastic-stack/7.17/upgrading-elastic-stack.html" class="ulink" target="_top">Elastic Stack Installation and Upgrade Guide</a>
</li>
<li class="listitem">
Review the APM <a class="xref" href="release-notes.html" title="Release notes">release notes</a>, <a class="xref" href="apm-breaking.html" title="Breaking Changes">breaking changes</a>,
and Observability <a href="/guide/en/observability/master/whats-new.html" class="ulink" target="_top">What&#8217;s new</a> content.
</li>
</ol>
</div>
<h5><a id="_upgrade_steps_2"></a>Upgrade steps<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/apm-server/upgrading-to-8.x.asciidoc">edit</a></h5>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>Upgrade the Elastic Stack to version 8.12.0.</p>
<p>The Elastic Stack (Elasticsearch and Kibana) must be upgraded before Elastic Agent.
See the <a href="/guide/en/elastic-stack/master/upgrading-elastic-stack.html" class="ulink" target="_top">Elastic Stack Installation and Upgrade Guide</a> for guidance.</p>
</li>
<li class="listitem">
<p>Upgrade Elastic Agent to version 8.12.0.
As a part of this process, the APM integration will automatically upgrade to version 8.12.0.</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
In Fleet, select <span class="strong strong"><strong>Agents</strong></span>.
</li>
<li class="listitem">
Under <span class="strong strong"><strong>Agents</strong></span>, click <span class="strong strong"><strong>Upgrade available</strong></span> to see a list of agents that you can upgrade.
</li>
<li class="listitem">
Choose <span class="strong strong"><strong>Upgrade agent</strong></span> from the <span class="strong strong"><strong>Actions</strong></span> menu next to the agent you want to upgrade.
The <span class="strong strong"><strong>Upgrade agent</strong></span> option is grayed out when an upgrade is unavailable, or
the Kibana version is lower than the agent version.
</li>
</ol>
</div>
<p>For more details, or for bulk upgrade instructions, see
<a href="/guide/en/fleet/master/upgrade-elastic-agent.html" class="ulink" target="_top">Upgrade Elastic Agent</a></p>
</li>
</ol>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="upgrade-8.0-cloud-standalone"></a>Upgrade Elastic Cloud APM Server standalone to 8.12.0<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/apm-server/upgrading-to-8.x.asciidoc">edit</a></h4>
</div></div></div>

<p>This upgrade guide is for the standalone method of running APM Server.
Only use this guide if both of the following are true:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
You&#8217;re using Elastic Cloud.
</li>
<li class="listitem">
You&#8217;re using the APM Server binary, i.e. you haven&#8217;t switched to the Elastic APM integration.
</li>
</ul>
</div>
<p>Follow these steps to upgrade:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Review the APM <a class="xref" href="release-notes.html" title="Release notes">release notes</a>, <a class="xref" href="apm-breaking.html" title="Breaking Changes">breaking changes</a>,
and Observability <a href="/guide/en/observability/master/whats-new.html" class="ulink" target="_top">What&#8217;s new</a> content.
</li>
<li class="listitem">
Upgrade Elastic Cloud to 8.12.0,
See <a href="/guide/en/cloud/current/ec-upgrade-deployment.html" class="ulink" target="_top">Upgrade versions</a> for instructions.
</li>
<li class="listitem">
(Optional) Upgrade to the APM integration.
Got time for one more upgrade?
See <a class="xref" href="upgrade-to-apm-integration.html" title="Switch to the Elastic APM integration">Switch to the Elastic APM integration</a>.
</li>
</ol>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="upgrade-8.0-cloud-integration"></a>Upgrade Elastic Cloud with the APM integration to 8.0<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/apm-server/upgrading-to-8.x.asciidoc">edit</a></h4>
</div></div></div>

<p>This upgrade guide is for the Elastic APM integration.
Only use this guide if both of the following are true:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
You&#8217;re using Elastic Cloud.
</li>
<li class="listitem">
You have already switched to and are running Fleet and the Elastic APM integration.
</li>
</ul>
</div>
<p>Follow these steps to upgrade:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Review the APM <a class="xref" href="release-notes.html" title="Release notes">release notes</a>, <a class="xref" href="apm-breaking.html" title="Breaking Changes">breaking changes</a>,
and Observability <a href="/guide/en/observability/master/whats-new.html" class="ulink" target="_top">What&#8217;s new</a> content.
</li>
<li class="listitem">
Upgrade your Elastic Cloud instance to 8.12.0.
See <a href="/guide/en/cloud/current/ec-upgrade-deployment.html" class="ulink" target="_top">Upgrade versions</a> for details.
The APM integration will automatically be upgraded to version 8.12.0 as a part of this process.
</li>
</ol>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>Elastic Cloud Enterprise users require additional TLS setup.
See <a href="/guide/en/cloud-enterprise/current/ece-manage-apm-settings.html" class="ulink" target="_top">Add APM user settings</a> for more information.</p>
</div>
</div>
</div>

</div>
<div class="navfooter">
<span class="prev">
<a href="apm-breaking.html">« Breaking Changes</a>
</span>
<span class="next">
<a href="upgrade-to-apm-integration.html">Switch to the Elastic APM integration »</a>
</span>
</div>
</div>
</body>
</html>
