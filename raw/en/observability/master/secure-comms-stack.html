<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Secure communication with the Elastic Stack | Elastic Observability [master] | Elastic</title>
<meta class="elastic" name="content" content="Secure communication with the Elastic Stack | Elastic Observability [master]">

<link rel="home" href="index.html" title="Elastic Observability [master]"/>
<link rel="up" href="securing-apm-server.html" title="Secure communication with the Elastic Stack"/>
<link rel="prev" href="secure-agent-communication.html" title="Secure communication with APM agents"/>
<link rel="next" href="monitor-apm.html" title="Monitor APM Server"/>
<meta class="elastic" name="product_version" content="master"/>
<meta class="elastic" name="product_name" content="Observability"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Observability/Guide/master"/>
<meta name="DC.subject" content="Observability"/>
<meta name="DC.identifier" content="master"/>
<meta name="robots" content="noindex,nofollow"/>
</head>
<body><div class="page_header">
You are looking at preliminary documentation for a future release.
Not what you want? See the
<a href="../current/index.html">current release documentation</a>.
</div>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elastic Observability [master]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="apm.html">Application performance monitoring (APM)</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="securing-apm-server.html">Secure communication with the Elastic Stack</a></span>
</div>
<div class="navheader">
<span class="prev">
<a href="secure-agent-communication.html">« Secure communication with APM agents</a>
</span>
<span class="next">
<a href="monitor-apm.html">Monitor APM Server »</a>
</span>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="secure-comms-stack"></a>Secure communication with the Elastic Stack<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/apm-server/feature-roles.asciidoc">edit</a></h3>
</div></div></div>

<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>This documentation only applies to the APM Server binary.</p>
</div>
</div>
<p>Use role-based access control or API keys to grant APM Server users access to secured resources.</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a class="xref" href="secure-comms-stack.html#feature-roles" title="Feature roles">Feature roles</a>
</li>
<li class="listitem">
<a class="xref" href="secure-comms-stack.html#beats-api-keys" title="Grant access using API keys">Grant access using API keys</a>.
</li>
</ul>
</div>
<p>After privileged users have been created, use authentication to connect to a secured Elastic cluster.</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a class="xref" href="configuring-output.html#securing-communication-elasticsearch" title="Secure communication with Elasticsearch">Secure communication with Elasticsearch</a>
</li>
<li class="listitem">
<a class="xref" href="configuring-output.html#configuring-ssl-logstash" title="Secure communication with Logstash">Secure communication with Logstash</a>
</li>
</ul>
</div>
<p>For secure communication between APM Server and APM Agents, see <a class="xref" href="secure-agent-communication.html" title="Secure communication with APM agents">With APM agents</a>.</p>
<p>A reference of all available <a class="xref" href="configuration-ssl-landing.html" title="SSL/TLS settings">SSL configuration settings</a> is also available.</p>
<h5><a id="security-overview"></a>Security Overview<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/apm-server/feature-roles.asciidoc">edit</a></h5>
<p>APM Server exposes an HTTP endpoint, and as with anything that opens ports on your servers,
you should be careful about who can connect to it.
Firewall rules are recommended to ensure only authorized systems can connect.</p>
<h5><a id="feature-roles"></a>Feature roles<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/apm-server/feature-roles.asciidoc">edit</a></h5>
<p>You can use role-based access control to grant users access to secured
resources. The roles that you set up depend on your organization&#8217;s security
requirements and the minimum privileges required to use specific features.</p>
<p>Typically, you need to create the following separate roles:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a class="xref" href="secure-comms-stack.html#privileges-to-publish-events" title="Grant privileges and roles needed for writing events">Writer role</a>: To publish events collected by APM Server.
</li>
<li class="listitem">
<a class="xref" href="secure-comms-stack.html#privileges-to-publish-monitoring" title="Grant privileges and roles needed for monitoring">Monitoring role</a>: One for sending monitoring
information, and another for viewing it.
</li>
<li class="listitem">
<a class="xref" href="secure-comms-stack.html#privileges-api-key" title="Grant privileges and roles needed for API key management">API key role</a>: To create and manage API keys.
</li>
<li class="listitem">
<a class="xref" href="secure-comms-stack.html#privileges-agent-central-config" title="Grant privileges and roles needed for APM Agent central configuration">Central configuration management role</a>: To view
APM Agent central configurations.
</li>
<li class="listitem">
<a class="xref" href="secure-comms-stack.html#privileges-rum-source-mapping" title="APM Server RUM source mapping">RUM source mapping role</a>: To read RUM source maps.
</li>
</ul>
</div>
<p>Elasticsearch security features provides <a href="/guide/en/elasticsearch/reference/master/built-in-roles.html" class="ulink" target="_top">built-in roles</a> that grant a
subset of the privileges needed by APM users.
When possible, assign users the built-in roles to minimize the affect of future changes on your security strategy.
If no built-in role is available, you can assign users the privileges needed to accomplish a specific task.
In general, there are three types of privileges you&#8217;ll work with:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<span class="strong strong"><strong>Elasticsearch cluster privileges</strong></span>: Manage the actions a user can perform against your cluster.
</li>
<li class="listitem">
<span class="strong strong"><strong>Elasticsearch index privileges</strong></span>: Control access to the data in specific indices your cluster.
</li>
<li class="listitem">
<span class="strong strong"><strong>Kibana space privileges</strong></span>: Grant users write or read access to features and apps within Kibana.
</li>
</ul>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="privileges-to-publish-events"></a>Grant privileges and roles needed for writing events<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/apm-server/feature-roles.asciidoc">edit</a></h4>
</div></div></div>

<p>APM users that publish events to Elasticsearch need privileges to write to APM data streams.</p>
<h6><a id="_general_writer_role"></a>General writer role<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/apm-server/feature-roles.asciidoc">edit</a></h6>
<p>To grant an APM user the required privileges for writing events to Elasticsearch:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>Create a <span class="strong strong"><strong>general writer role</strong></span>, called something like <code class="literal">apm_writer</code>,
that has the following privileges:</p>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Type</th>
<th align="left" valign="top">Privilege</th>
<th align="left" valign="top">Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p>Index</p></td>
<td align="left" valign="top"><p><code class="literal">auto_configure</code> on <code class="literal">traces-apm*</code>, <code class="literal">logs-apm*</code>, and <code class="literal">metrics-apm*</code> indices</p></td>
<td align="left" valign="top"><p>Permits auto-creation of indices and data streams</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>Index</p></td>
<td align="left" valign="top"><p><code class="literal">create_doc</code> on <code class="literal">traces-apm*</code>, <code class="literal">logs-apm*</code>, and <code class="literal">metrics-apm*</code> indices</p></td>
<td align="left" valign="top"><p>Write events into Elasticsearch</p></td>
</tr>
</tbody>
</table>
</div>
</li>
<li class="listitem">
Assign the <span class="strong strong"><strong>general writer role</strong></span> to users who need to publish APM data.
</li>
<li class="listitem">
If <a class="xref" href="configuration-rum.html" title="Configure Real User Monitoring (RUM)">real user monitoring</a> is enabled, create a separate <a class="xref" href="secure-comms-stack.html#privileges-rum-source-mapping" title="APM Server RUM source mapping">RUM source mapping role</a>.
</li>
</ol>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="privileges-to-publish-monitoring"></a>Grant privileges and roles needed for monitoring<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/apm-server/feature-roles.asciidoc">edit</a></h4>
</div></div></div>

<p>Elasticsearch security features provides built-in users and roles for publishing and viewing monitoring data.
The privileges and roles needed to publish monitoring data
depend on the method used to collect that data.</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p><a class="xref" href="secure-comms-stack.html#privileges-to-publish-monitoring-write" title="Publish monitoring data">Publish monitoring data</a></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a class="xref" href="secure-comms-stack.html#privileges-to-publish-monitoring-internal" title="Internal collection">Internal collection</a>
</li>
<li class="listitem">
<a class="xref" href="secure-comms-stack.html#privileges-to-publish-monitoring-metricbeat" title="Metricbeat collection">Metricbeat collection</a>
</li>
</ul>
</div>
</li>
<li class="listitem">
<a class="xref" href="secure-comms-stack.html#privileges-to-publish-monitoring-view" title="View monitoring data">View monitoring data</a>
</li>
</ul>
</div>
<h6><a id="privileges-to-publish-monitoring-write"></a>Publish monitoring data<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/apm-server/feature-roles.asciidoc">edit</a></h6>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p><span class="strong strong"><strong>Elastic Cloud users:</strong></span> This section does not apply to our
<a href="/cloud/elasticsearch-service" class="ulink" target="_top">hosted Elasticsearch Service</a>.
Monitoring on Elastic Cloud is enabled by clicking the <span class="strong strong"><strong>Enable</strong></span> button in the <span class="strong strong"><strong>Monitoring</strong></span> panel.</p>
</div>
</div>
<h7><a id="privileges-to-publish-monitoring-internal"></a>Internal collection<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/apm-server/feature-roles.asciidoc">edit</a></h7>
<p>If you&#8217;re using <a class="xref" href="monitoring.html#monitoring-internal-collection" title="Use internal collection to send monitoring data">internal collection</a> to
collect metrics about APM Server, security features provides
the <code class="literal">apm_system</code> <a href="/guide/en/elasticsearch/reference/master/built-in-users.html" class="ulink" target="_top">built-in user</a> and
<code class="literal">apm_system</code> <a href="/guide/en/elasticsearch/reference/master/built-in-roles.html" class="ulink" target="_top">built-in role</a> to send
monitoring information. You can use the built-in user, if it&#8217;s available in your
environment, or create a user who has the built-in role assigned,
or create a user and manually assign the privileges needed to send monitoring
information.</p>
<p>If you use the built-in <code class="literal">apm_system</code> user,
make sure you set the password before using it.</p>
<p>If you don&#8217;t use the <code class="literal">apm_system</code> user:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>Create a <span class="strong strong"><strong>monitoring role</strong></span>, called something like
<code class="literal">apm_monitoring_writer</code>, that has the following privileges:</p>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Type</th>
<th align="left" valign="top">Privilege</th>
<th align="left" valign="top">Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p>Index</p></td>
<td align="left" valign="top"><p><code class="literal">create_index</code> on <code class="literal">.monitoring-beats-*</code> indices</p></td>
<td align="left" valign="top"><p>Create monitoring indices in Elasticsearch</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>Index</p></td>
<td align="left" valign="top"><p><code class="literal">create_doc</code> on <code class="literal">.monitoring-beats-*</code> indices</p></td>
<td align="left" valign="top"><p>Write monitoring events into Elasticsearch</p></td>
</tr>
</tbody>
</table>
</div>
</li>
<li class="listitem">
Assign the <span class="strong strong"><strong>monitoring role</strong></span> to users who need to write monitoring data to Elasticsearch.
</li>
</ol>
</div>
<h7><a id="privileges-to-publish-monitoring-metricbeat"></a>Metricbeat collection<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/apm-server/feature-roles.asciidoc">edit</a></h7>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>When using Metricbeat to collect metrics,
no roles or users need to be created with APM Server.
See <a class="xref" href="monitoring-local-collection.html#monitoring-metricbeat-collection" title="Use Metricbeat to send monitoring data">Use Metricbeat collection</a>
for complete details on setting up Metricbeat collection.</p>
</div>
</div>
<p>If you&#8217;re <a class="xref" href="monitoring-local-collection.html#monitoring-metricbeat-collection" title="Use Metricbeat to send monitoring data">using Metricbeat</a> to collect
metrics about APM Server, security features provides the <code class="literal">remote_monitoring_user</code>
<a href="/guide/en/elasticsearch/reference/master/built-in-users.html" class="ulink" target="_top">built-in user</a>, and the <code class="literal">remote_monitoring_collector</code>
and <code class="literal">remote_monitoring_agent</code> <a href="/guide/en/elasticsearch/reference/master/built-in-roles.html" class="ulink" target="_top">built-in roles</a> for
collecting and sending monitoring information. You can use the built-in user, if
it&#8217;s available in your environment, or create a user who has the privileges
needed to collect and send monitoring information.</p>
<p>If you use the built-in <code class="literal">remote_monitoring_user</code> user,
make sure you set the password before using it.</p>
<p>If you don&#8217;t use the <code class="literal">remote_monitoring_user</code> user:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>Create a <span class="strong strong"><strong>monitoring user</strong></span> on the production cluster who will collect and send monitoring
information. Assign the following roles to the <span class="strong strong"><strong>monitoring user</strong></span>:</p>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Role</th>
<th align="left" valign="top">Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p><code class="literal">remote_monitoring_collector</code></p></td>
<td align="left" valign="top"><p>Collect monitoring metrics from APM Server</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">remote_monitoring_agent</code></p></td>
<td align="left" valign="top"><p>Send monitoring data to the monitoring cluster</p></td>
</tr>
</tbody>
</table>
</div>
</li>
</ol>
</div>
<h6><a id="privileges-to-publish-monitoring-view"></a>View monitoring data<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/apm-server/feature-roles.asciidoc">edit</a></h6>
<p>To grant users the required privileges for viewing monitoring data:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>Create a <span class="strong strong"><strong>monitoring role</strong></span>, called something like
<code class="literal">apm_monitoring_viewer</code>, that has the following privileges:</p>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Type</th>
<th align="left" valign="top">Privilege</th>
<th align="left" valign="top">Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p>Spaces</p></td>
<td align="left" valign="top"><p><code class="literal">Read</code> on Stack monitoring</p></td>
<td align="left" valign="top"><p>Read-only access to the Stack Monitoring feature in Kibana.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>Spaces</p></td>
<td align="left" valign="top"><p><code class="literal">Read</code> on Dashboards</p></td>
<td align="left" valign="top"><p>Read-only access to the Dashboards feature in Kibana.</p></td>
</tr>
</tbody>
</table>
</div>
</li>
<li class="listitem">
<p>Assign the <span class="strong strong"><strong>monitoring role</strong></span>, along with the following built-in roles, to users who
need to view monitoring data for APM Server:</p>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Role</th>
<th align="left" valign="top">Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p><code class="literal">monitoring_user</code></p></td>
<td align="left" valign="top"><p>Grants access to monitoring indices for APM Server</p></td>
</tr>
</tbody>
</table>
</div>
</li>
</ol>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="privileges-api-key"></a>Grant privileges and roles needed for API key management<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/apm-server/feature-roles.asciidoc">edit</a></h4>
</div></div></div>

<p>You can configure <a class="xref" href="secure-agent-communication.html#api-key" title="API keys">API keys</a> to authorize requests to APM Server.
To create an APM Server user with the required privileges for creating and managing API keys:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>Create an <span class="strong strong"><strong>API key role</strong></span>, called something like <code class="literal">apm_api_key</code>,
that has the following <code class="literal">cluster</code> level privileges:</p>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Privilege</th>
<th align="left" valign="top">Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p><code class="literal">manage_own_api_key</code></p></td>
<td align="left" valign="top"><p>Allow APM Server to create, retrieve, and invalidate API keys</p></td>
</tr>
</tbody>
</table>
</div>
</li>
<li class="listitem">
<p>Depending on what the <span class="strong strong"><strong>API key role</strong></span> will be used for,
also assign the appropriate <code class="literal">apm</code> application-level privileges:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
To <span class="strong strong"><strong>receive Agent configuration</strong></span>, assign <code class="literal">config_agent:read</code>.
</li>
<li class="listitem">
To <span class="strong strong"><strong>ingest agent data</strong></span>, assign <code class="literal">event:write</code>.
</li>
<li class="listitem">
To <span class="strong strong"><strong>upload source maps</strong></span>, assign <code class="literal">sourcemap:write</code>.
</li>
</ul>
</div>
</li>
<li class="listitem">
Assign the <span class="strong strong"><strong>API key role</strong></span> to users that need to create and manage API keys.
Users with this role can only create API keys that have the same or lower access rights.
</li>
</ol>
</div>
<h5><a id="privileges-api-key-example"></a>Example API key role<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/apm-server/feature-roles.asciidoc">edit</a></h5>
<p>The following example assigns the required cluster privileges,
and the ingest agent data <code class="literal">apm</code> API key application privileges to a role named <code class="literal">apm_api_key</code>:</p>
<div class="pre_wrapper lang-kibana">
<pre class="programlisting prettyprint lang-kibana">PUT _security/role/apm_api_key <a id="CO45-1"></a><i class="conum" data-value="1"></i>
{
  "cluster": [
    "manage_own_api_key" <a id="CO45-2"></a><i class="conum" data-value="2"></i>
  ],
  "applications": [
    {
      "application": "apm",
      "privileges": [
        "event:write" <a id="CO45-3"></a><i class="conum" data-value="3"></i>
      ],
      "resources": [
        "*"
      ]
    }
  ]
}</pre>
</div>
<div class="kibana_widget" data-snippet="snippets/17.kibana"></div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO45-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p><code class="literal">apm_api_key</code> is the name of the role we&#8217;re assigning these privileges to. Any name can be used.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO45-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>Required cluster privileges.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO45-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p>Required for API keys that will be used to ingest agent events.</p>
</td>
</tr>
</table>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="privileges-agent-central-config"></a>Grant privileges and roles needed for APM Agent central configuration<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/apm-server/feature-roles.asciidoc">edit</a></h4>
</div></div></div>

<div class="section">
<div class="titlepage"><div><div>
<h5 class="title"><a id="privileges-agent-central-config-server"></a>APM Server agent central configuration management<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/apm-server/feature-roles.asciidoc">edit</a></h5>
</div></div></div>
<p>APM Server acts as a proxy between your APM agents and the APM app.
The APM app communicates any changed settings to APM Server so that your agents only need to poll the Server
to determine which central configuration settings have changed.</p>
<p>To grant an APM Server user with the required privileges for managing central configuration in Elasticsearch without Kibana,
assign the user the following privileges:</p>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Type</th>
<th align="left" valign="top">Privilege</th>
<th align="left" valign="top">Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p>Index</p></td>
<td align="left" valign="top"><p><code class="literal">read</code> on <code class="literal">.apm-agent-configuration</code> index</p></td>
<td align="left" valign="top"><p>Allow APM Server to manage central configurations in Elasticsearch</p></td>
</tr>
</tbody>
</table>
</div>
<p>The above privileges should be sufficient for APM agent central configuration to work properly
as long as APM Server communicates with Elasticsearch successfully.
If it fails, it may fallback to read agent central configuration via Kibana if configured,
which requires the following privileges:</p>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Type</th>
<th align="left" valign="top">Privilege</th>
<th align="left" valign="top">Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p>Spaces</p></td>
<td align="left" valign="top"><p><code class="literal">Read</code> on APM app</p></td>
<td align="left" valign="top"><p>Allow APM Server to manage central configurations via the APM app</p></td>
</tr>
</tbody>
</table>
</div>
<div class="tip admon">
<div class="icon"></div>
<div class="admon_content">
<p>Looking for privileges and roles needed to use central configuration from the APM app or APM app API?
See <a href="/guide/en/kibana/master/apm-app-central-config-user.html" class="ulink" target="_top">APM app central configuration user</a>.</p>
</div>
</div>
</div>

</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="privileges-rum-source-map"></a>Grant privileges and roles needed for reading source maps<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/apm-server/feature-roles.asciidoc">edit</a></h4>
</div></div></div>

<div class="section">
<div class="titlepage"><div><div>
<h5 class="title"><a id="privileges-rum-source-mapping"></a>APM Server RUM source mapping<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/apm-server/feature-roles.asciidoc">edit</a></h5>
</div></div></div>
<p>If <a class="xref" href="configuration-rum.html" title="Configure Real User Monitoring (RUM)">real user monitoring</a> is enabled, additional privileges are required to read source maps.</p>
<p>To grant an APM Server user with the required privileges for reading RUM source maps from Elasticsearch directly without Kibana,
assign the user the following privileges:</p>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Type</th>
<th align="left" valign="top">Privilege</th>
<th align="left" valign="top">Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p>Index</p></td>
<td align="left" valign="top"><p><code class="literal">read</code> on <code class="literal">.apm-source-map</code> index</p></td>
<td align="left" valign="top"><p>Allow APM Server to read RUM source maps from Elasticsearch</p></td>
</tr>
</tbody>
</table>
</div>
<p>The above privileges should be sufficient for RUM source mapping to work properly
as long as APM Server communicates with Elasticsearch successfully.
If it fails, it may fallback to read source maps via Kibana if configured,
which requires additional Kibana privileges.
See <a href="/guide/en/kibana/master/rum-sourcemap-api.html" class="ulink" target="_top">RUM source map API</a> for more details.</p>
</div>

</div>

<div class="section xpack">
<div class="titlepage"><div><div>
<h4 class="title"><a id="beats-api-keys"></a>Grant access using API keys<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/apm-server/access-api-keys.asciidoc">edit</a></h4>
</div></div></div>
<p>Instead of using usernames and passwords, you can use API keys to grant
access to Elasticsearch resources. You can set API keys to expire at a certain time,
and you can explicitly invalidate them. Any user with the <code class="literal">manage_api_key</code>
or <code class="literal">manage_own_api_key</code> cluster privilege can create API keys.</p>
<p>APM Server instances typically send both collected data and monitoring
information to Elasticsearch. If you are sending both to the same cluster, you can use the same
API key. For different clusters, you need to use an API key per cluster.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>For security reasons, we recommend using a unique API key per APM Server instance.
You can create as many API keys per user as necessary.</p>
</div>
</div>
<h6><a id="beats-api-key-publish"></a>Create an API key for writing events<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/apm-server/access-api-keys.asciidoc">edit</a></h6>
<p>In Kibana, navigate to <span class="strong strong"><strong>Stack Management</strong></span> &gt; <span class="strong strong"><strong>API keys</strong></span> and click <span class="strong strong"><strong>Create API key</strong></span>.</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/server-api-key-create.png" alt="API key creation">
</div>
</div>
<p>Enter a name for your API key and select <span class="strong strong"><strong>Restrict privileges</strong></span>.
In the role descriptors box, assign the appropriate privileges to the new API key. For example:</p>
<div class="pre_wrapper lang-json">
<pre class="programlisting prettyprint lang-json">{
    "apm_writer": {
        "index": [
            {
                "names": ["apm-*"],
                "privileges": ["create_index", "create_doc"]
            }
        ]
    },
    "apm_sourcemap": {
        "index": [
            {
                "names": [".apm-source-map"],
                "privileges": ["read"]
            }
        ]
    },
    "apm_agentcfg": {
        "index": [
            {
                "names": [".apm-agent-configuration"],
                "privileges": ["read"]
            }
        ]
    }
}</pre>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>This example only provides privileges for <span class="strong strong"><strong>writing data</strong></span>.
See <a class="xref" href="secure-comms-stack.html#feature-roles" title="Feature roles">Feature roles</a> for additional privileges and information.</p>
</div>
</div>
<p>To set an expiration date for the API key, select <span class="strong strong"><strong>Expire after time</strong></span>
and input the lifetime of the API key in days.</p>
<p>Click <span class="strong strong"><strong>Create API key</strong></span>. In the dropdown, switch to <span class="strong strong"><strong>Beats</strong></span> and copy the API key.</p>
<p>You can now use this API key in your <code class="literal">apm-server.yml</code> configuration file:</p>
<div class="pre_wrapper lang-yml">
<pre class="programlisting prettyprint lang-yml">output.elasticsearch:
  api_key: TiNAGG4BaaMdaH1tRfuU:KnR6yE41RrSowb0kQ0HWoA <a id="CO46-1"></a><i class="conum" data-value="1"></i></pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO46-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Format is <code class="literal">id:api_key</code> (as shown in the Beats dropdown)</p>
</td>
</tr>
</table>
</div>
<h6><a id="beats-api-key-monitor"></a>Create an API key for monitoring<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/apm-server/access-api-keys.asciidoc">edit</a></h6>
<p>In Kibana, navigate to <span class="strong strong"><strong>Stack Management</strong></span> &gt; <span class="strong strong"><strong>API keys</strong></span> and click <span class="strong strong"><strong>Create API key</strong></span>.</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/server-api-key-create.png" alt="API key creation">
</div>
</div>
<p>Enter a name for your API key and select <span class="strong strong"><strong>Restrict privileges</strong></span>.
In the role descriptors box, assign the appropriate privileges to the new API key.
For example:</p>
<div class="pre_wrapper lang-json">
<pre class="programlisting prettyprint lang-json">{
    "apm_monitoring": {
        "index": [
            {
                "names": [".monitoring-beats-*"],
                "privileges": ["create_index", "create_doc"]
            }
      ]
    }
}</pre>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>This example only provides privileges for <span class="strong strong"><strong>publishing monitoring data</strong></span>.
See <a class="xref" href="secure-comms-stack.html#feature-roles" title="Feature roles">Feature roles</a> for additional privileges and information.</p>
</div>
</div>
<p>To set an expiration date for the API key, select <span class="strong strong"><strong>Expire after time</strong></span>
and input the lifetime of the API key in days.</p>
<p>Click <span class="strong strong"><strong>Create API key</strong></span>. In the dropdown, switch to <span class="strong strong"><strong>Beats</strong></span> and copy the API key.</p>
<p>You can now use this API key in your <code class="literal">apm-server.yml</code> configuration file like this:</p>
<div class="pre_wrapper lang-yml">
<pre class="programlisting prettyprint lang-yml">monitoring.elasticsearch:
  api_key: TiNAGG4BaaMdaH1tRfuU:KnR6yE41RrSowb0kQ0HWoA <a id="CO47-1"></a><i class="conum" data-value="1"></i></pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO47-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Format is <code class="literal">id:api_key</code> (as shown in the Beats dropdown)</p>
</td>
</tr>
</table>
</div>
<h6><a id="beats-api-key-es"></a>Create an API key with Elasticsearch APIs<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/apm-server/access-api-keys.asciidoc">edit</a></h6>
<p>You can also use Elasticsearch&#8217;s <a href="/guide/en/elasticsearch/reference/master/security-api-create-api-key.html" class="ulink" target="_top">Create API key API</a> to create a new API key.
For example:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST /_security/api_key
{
  "name": "apm_host001", <a id="CO48-1"></a><i class="conum" data-value="1"></i>
  "role_descriptors": {
    "apm_writer": { <a id="CO48-2"></a><i class="conum" data-value="2"></i>
      "index": [
        {
          "names": ["apm-*"],
          "privileges": ["create_index", "create_doc"]
        }
      ]
    },
    "apm_sourcemap": {
      "index": [
        {
          "names": [".apm-source-map"],
          "privileges": ["read"]
        }
      ]
    },
    "apm_agentcfg": {
      "index": [
        {
          "names": [".apm-agent-configuration"],
          "privileges": ["read"]
        }
      ]
    }
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/18.console"></div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO48-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Name of the API key</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO48-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>Granted privileges, see <a class="xref" href="secure-comms-stack.html#feature-roles" title="Feature roles">Feature roles</a></p>
</td>
</tr>
</table>
</div>
<p>See the <a href="/guide/en/elasticsearch/reference/master/security-api-create-api-key.html" class="ulink" target="_top">Create API key</a> reference for more information.</p>
<h6><a id="learn-more-api-keys"></a>Learn more about API keys<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/apm-server/access-api-keys.asciidoc">edit</a></h6>
<p>See the Elasticsearch API key documentation for more information:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a href="/guide/en/elasticsearch/reference/master/security-api-create-api-key.html" class="ulink" target="_top">Create API key</a>
</li>
<li class="listitem">
<a href="/guide/en/elasticsearch/reference/master/security-api-get-api-key.html" class="ulink" target="_top">Get API key information</a>
</li>
<li class="listitem">
<a href="/guide/en/elasticsearch/reference/master/security-api-invalidate-api-key.html" class="ulink" target="_top">Invalidate API key</a>
</li>
</ul>
</div>
</div>

</div>
<div class="navfooter">
<span class="prev">
<a href="secure-agent-communication.html">« Secure communication with APM agents</a>
</span>
<span class="next">
<a href="monitor-apm.html">Monitor APM Server »</a>
</span>
</div>
</div>
</body>
</html>
